PostId,PostCreationDate,OwnerUserId,OwnerCreationDate,ReputationAtPostCreation,OwnerUndeletedAnswerCountAtPostTime,Title,BodyMarkdown,Tag1,Tag2,Tag3,Tag4,Tag5,PostClosedDate,OpenStatus,OpenStatusInt,BodyLength,TitleLength,TitleConcatWithBody,NumberOfTags
4437655,12/14/2010 09:30:44,11432,09/16/2008 07:56:30,5687,312,How to tell NHibernate from producing two references on child table to parent table?,"
Aside from making this...

    public virtual Person Owner { get; set; }

...to:

    public virtual Person Person { get; set; }


How can I prevent NHibernate from producing the extraneous Person_id in its DDL creation?

    create table contact (contact_id int4 not null, number text, type text, owner_ref int4, Person_id int4, primary key (contact_id));
    create table person (person_id int4 not null, person_name text not null, birthdate timestamp not null, primary key (person_id));
    alter table contact add constraint FK38B7242018FA494F foreign key (owner_ref) references person;
    alter table contact add constraint FK38B724202B329A0D foreign key (Person_id) references person;
    create sequence contact_contact_id_seq;
    create sequence hibernate_sequence


I don't know what should go here:

    // ,ConventionBuilder.HasMany.Always(x => x.Key.Column(x.EntityType.Name.ToPostgresNamingConvention() + ""_id""))         


I tried this just to make sure that it's feasible to prevent extraneous reference

    ,ConventionBuilder.HasMany.Always(x => x.Key.Column(""owner_ref""))   
    
    
Here's NHibernate DDL Creation when I add that ConventionBuilder

    create table contact (contact_id int4 not null, number text, type text, owner_ref int4, primary key (contact_id));
    create table person (person_id int4 not null, person_name text not null, birthdate timestamp not null, primary key (person_id));
    alter table contact add constraint FK38B7242018FA494F foreign key (owner_ref) references person;
    create sequence contact_contact_id_seq;
    create sequence hibernate_sequence


It prevent duplicate references, it's possible, but what I still doesn't know is how to change the KeyColumn's name of the collection(IList&lt;Contact&gt;) of Person in ConventionBuilder

Another way is to just change the KeyColumn in ClassMap directly, prevents duplicate reference in contact table...

    HasMany(x => x.Contacts).Inverse().KeyColumn(""owner_ref"");

...but it's better if I can make it automatic on ConventionBuilder.

    
How can I tell NHibernate from producing two references? Here's the complete code:

    
    using System;
    
    using System.Collections.Generic;
    using System.Text.RegularExpressions;
    
    using NHibernate;
    using NHibernate.Dialect;
    
    using FluentNHibernate.Cfg;
    using FluentNHibernate.Cfg.Db;
    using FluentNHibernate.Conventions;
    using FluentNHibernate.Conventions.Helpers;
    using FluentNHibernate.Mapping;
    

    
    
    namespace ConventionBuilderForPg
    {
        class MainClass
        {
            public static void Main (string[] args)
            {
                
                
                string sx = PgNHibernateHelper.Helper.GetDDL<MainClass>("""");
                
                Console.WriteLine(""Copy this: \n\n{0}"", sx);
                
                Console.ReadLine();
    
            }
        }
        
        public class Person
        {
            public virtual int PersonId { get; set; }
            
            public virtual string PersonName { get; set; }
            public virtual DateTime Birthdate { get; set; }     
                        
            public virtual IList<Contact> Contacts { get; set; }
        }
        
    
        public class Contact
        {
            public virtual Person Owner { get; set; }
                            
            public virtual int ContactId { get; set; }      
            public virtual string Number { get; set; }      
            public virtual string Type { get; set; }
        }
        
        
        
        
        
        public class PersonMap : ClassMap<Person>
        {
            public PersonMap()
            {       
        
                Id(x => x.PersonId);
                Map(x => x.PersonName).Not.Nullable();
                Map(x => x.Birthdate).Not.Nullable();                   
                HasMany(x => x.Contacts).Inverse(); 
            }
        }
        
    
        
        public class ContactMap : ClassMap<Contact>
        {
            public ContactMap()
            {                   
                References(x => x.Owner);
                Id(x => x.ContactId).GeneratedBy.Sequence(""contact_contact_id_seq"");
                Map(x => x.Number);
                Map(x => x.Type);                           
            }
            
        }
        
    
    }
    
    
    
    
    namespace PgNHibernateHelper
    {
        public static class Helper
        {
            static ISessionFactory _sf = null;
            public static ISessionFactory GetSessionFactory<T>(string connectionString)
            {
                // Building SessionFactory is costly, should be done only once, making the backing variable static would prevent creating multiple factory
                if (_sf != null) return _sf;
    
                
                _sf = Fluently.Configure()
                    .Database(PostgreSQLConfiguration.Standard.ConnectionString(connectionString))              
                    .Mappings(m => m.FluentMappings.AddFromAssemblyOf<T>())
                    .BuildSessionFactory();
    
                return _sf;
                
                
            }
    
    
            
            public static string GetDDL<T>(string postgresPassword)
            {
                
                var cb = new IConvention[]
                {
                    ConventionBuilder.Property.Always
                    (
                     x => 
                        {                       
                            if (x.Property.PropertyType == typeof(string))
                                x.CustomSqlType(""text"");
                        }
                     )
                
                    ,ConventionBuilder.Class.Always( x => x.Table( x.EntityType.Name.ToPostgresNamingConvention() ) ) 
                    
                    ,ConventionBuilder.Property.Always( x => x.Column(x.Name.ToPostgresNamingConvention() ) )
                    
                    ,ConventionBuilder.Id.Always( x => x.Column(x.Name.ToPostgresNamingConvention()) )      
                    
                    // I don't know what should go here
                    // ,ConventionBuilder.HasMany.Always(x => x.Key.Column(x.EntityType.Name.ToPostgresNamingConvention() + ""_id""))         
                                    
                    ,ConventionBuilder.Reference.Always(x => x.Column( x.Name.ToPostgresNamingConvention().ToLower() + ""_ref"" ) )   
                    
                    
                        
                };
                
                return
                    string.Join("";"" + Environment.NewLine,
                        Fluently.Configure()
                        .Database(PostgreSQLConfiguration.Standard.ConnectionString(""Server=localhost;Database=postgres;User ID=postgres;Password="" + postgresPassword + "";""))                                              
                        .Mappings(m => m.FluentMappings.AddFromAssemblyOf<T>()
                                           .Conventions.Add( cb )
                                          )
                        .BuildConfiguration()
                        .GenerateSchemaCreationScript(new PostgreSQLDialect())
                                );                                       
            }
            
            
            private static string ToPostgresNamingConvention(this string s)
            {
                var r = new Regex(@""
                    (?<=[A-Z])(?=[A-Z][a-z]) |
                    (?<=[^A-Z])(?=[A-Z]) |
                    (?<=[A-Za-z])(?=[^A-Za-z])"", RegexOptions.IgnorePatternWhitespace);
                
                return r.Replace(s, ""_"").ToLower();
            }       
        }//SessionFactoryBuilder
    }
    
",nhibernate,design-patterns,,,,,open,0,2954,14,"How to tell NHibernate from producing two references on child table to parent table? 
Aside from making this...

    public virtual Person Owner { get; set; }

...to:

    public virtual Person Person { get; set; }


How can I prevent NHibernate from producing the extraneous Person_id in its DDL creation?

    create table contact (contact_id int4 not null, number text, type text, owner_ref int4, Person_id int4, primary key (contact_id));
    create table person (person_id int4 not null, person_name text not null, birthdate timestamp not null, primary key (person_id));
    alter table contact add constraint FK38B7242018FA494F foreign key (owner_ref) references person;
    alter table contact add constraint FK38B724202B329A0D foreign key (Person_id) references person;
    create sequence contact_contact_id_seq;
    create sequence hibernate_sequence


I don't know what should go here:

    // ,ConventionBuilder.HasMany.Always(x => x.Key.Column(x.EntityType.Name.ToPostgresNamingConvention() + ""_id""))         


I tried this just to make sure that it's feasible to prevent extraneous reference

    ,ConventionBuilder.HasMany.Always(x => x.Key.Column(""owner_ref""))   
    
    
Here's NHibernate DDL Creation when I add that ConventionBuilder

    create table contact (contact_id int4 not null, number text, type text, owner_ref int4, primary key (contact_id));
    create table person (person_id int4 not null, person_name text not null, birthdate timestamp not null, primary key (person_id));
    alter table contact add constraint FK38B7242018FA494F foreign key (owner_ref) references person;
    create sequence contact_contact_id_seq;
    create sequence hibernate_sequence


It prevent duplicate references, it's possible, but what I still doesn't know is how to change the KeyColumn's name of the collection(IList&lt;Contact&gt;) of Person in ConventionBuilder

Another way is to just change the KeyColumn in ClassMap directly, prevents duplicate reference in contact table...

    HasMany(x => x.Contacts).Inverse().KeyColumn(""owner_ref"");

...but it's better if I can make it automatic on ConventionBuilder.

    
How can I tell NHibernate from producing two references? Here's the complete code:

    
    using System;
    
    using System.Collections.Generic;
    using System.Text.RegularExpressions;
    
    using NHibernate;
    using NHibernate.Dialect;
    
    using FluentNHibernate.Cfg;
    using FluentNHibernate.Cfg.Db;
    using FluentNHibernate.Conventions;
    using FluentNHibernate.Conventions.Helpers;
    using FluentNHibernate.Mapping;
    

    
    
    namespace ConventionBuilderForPg
    {
        class MainClass
        {
            public static void Main (string[] args)
            {
                
                
                string sx = PgNHibernateHelper.Helper.GetDDL<MainClass>("""");
                
                Console.WriteLine(""Copy this: \n\n{0}"", sx);
                
                Console.ReadLine();
    
            }
        }
        
        public class Person
        {
            public virtual int PersonId { get; set; }
            
            public virtual string PersonName { get; set; }
            public virtual DateTime Birthdate { get; set; }     
                        
            public virtual IList<Contact> Contacts { get; set; }
        }
        
    
        public class Contact
        {
            public virtual Person Owner { get; set; }
                            
            public virtual int ContactId { get; set; }      
            public virtual string Number { get; set; }      
            public virtual string Type { get; set; }
        }
        
        
        
        
        
        public class PersonMap : ClassMap<Person>
        {
            public PersonMap()
            {       
        
                Id(x => x.PersonId);
                Map(x => x.PersonName).Not.Nullable();
                Map(x => x.Birthdate).Not.Nullable();                   
                HasMany(x => x.Contacts).Inverse(); 
            }
        }
        
    
        
        public class ContactMap : ClassMap<Contact>
        {
            public ContactMap()
            {                   
                References(x => x.Owner);
                Id(x => x.ContactId).GeneratedBy.Sequence(""contact_contact_id_seq"");
                Map(x => x.Number);
                Map(x => x.Type);                           
            }
            
        }
        
    
    }
    
    
    
    
    namespace PgNHibernateHelper
    {
        public static class Helper
        {
            static ISessionFactory _sf = null;
            public static ISessionFactory GetSessionFactory<T>(string connectionString)
            {
                // Building SessionFactory is costly, should be done only once, making the backing variable static would prevent creating multiple factory
                if (_sf != null) return _sf;
    
                
                _sf = Fluently.Configure()
                    .Database(PostgreSQLConfiguration.Standard.ConnectionString(connectionString))              
                    .Mappings(m => m.FluentMappings.AddFromAssemblyOf<T>())
                    .BuildSessionFactory();
    
                return _sf;
                
                
            }
    
    
            
            public static string GetDDL<T>(string postgresPassword)
            {
                
                var cb = new IConvention[]
                {
                    ConventionBuilder.Property.Always
                    (
                     x => 
                        {                       
                            if (x.Property.PropertyType == typeof(string))
                                x.CustomSqlType(""text"");
                        }
                     )
                
                    ,ConventionBuilder.Class.Always( x => x.Table( x.EntityType.Name.ToPostgresNamingConvention() ) ) 
                    
                    ,ConventionBuilder.Property.Always( x => x.Column(x.Name.ToPostgresNamingConvention() ) )
                    
                    ,ConventionBuilder.Id.Always( x => x.Column(x.Name.ToPostgresNamingConvention()) )      
                    
                    // I don't know what should go here
                    // ,ConventionBuilder.HasMany.Always(x => x.Key.Column(x.EntityType.Name.ToPostgresNamingConvention() + ""_id""))         
                                    
                    ,ConventionBuilder.Reference.Always(x => x.Column( x.Name.ToPostgresNamingConvention().ToLower() + ""_ref"" ) )   
                    
                    
                        
                };
                
                return
                    string.Join("";"" + Environment.NewLine,
                        Fluently.Configure()
                        .Database(PostgreSQLConfiguration.Standard.ConnectionString(""Server=localhost;Database=postgres;User ID=postgres;Password="" + postgresPassword + "";""))                                              
                        .Mappings(m => m.FluentMappings.AddFromAssemblyOf<T>()
                                           .Conventions.Add( cb )
                                          )
                        .BuildConfiguration()
                        .GenerateSchemaCreationScript(new PostgreSQLDialect())
                                );                                       
            }
            
            
            private static string ToPostgresNamingConvention(this string s)
            {
                var r = new Regex(@""
                    (?<=[A-Z])(?=[A-Z][a-z]) |
                    (?<=[^A-Z])(?=[A-Z]) |
                    (?<=[A-Za-z])(?=[^A-Za-z])"", RegexOptions.IgnorePatternWhitespace);
                
                return r.Replace(s, ""_"").ToLower();
            }       
        }//SessionFactoryBuilder
    }
    
",2
2182097,02/02/2010 05:40:41,260892,01/28/2010 11:14:32,1,0,Are Nhibernate Helper Kits available for VS2008?,"Can anyone help me out by providing some information on Nhibernate Helper Kits for VS2008 and which all are open source and which all are not. 
Can also anyone share some links that give information on using NHibernate with ASP.NET MVC",nhibernate,helper,kit,mvc,,,open,0,41,7,"Are Nhibernate Helper Kits available for VS2008? Can anyone help me out by providing some information on Nhibernate Helper Kits for VS2008 and which all are open source and which all are not. 
Can also anyone share some links that give information on using NHibernate with ASP.NET MVC",4
9805875,03/21/2012 13:43:59,1278850,03/19/2012 14:59:52,4,0,Session menager problems,Looking for some good tutorial that will help me build my SessionMenager for web application with will allow me to use Load/Evict options on my session instance can anyone help me to find one cuz i was looking in web for 5h atlast and no good tutorials...,nhibernate,,,,,03/21/2012 21:23:28,not a real question,1,47,3,Session menager problems Looking for some good tutorial that will help me build my SessionMenager for web application with will allow me to use Load/Evict options on my session instance can anyone help me to find one cuz i was looking in web for 5h atlast and no good tutorials...,1
3734627,09/17/2010 10:40:51,281180,02/25/2010 12:00:19,432,8,NHibernate loading error message,"I am having the error message with MappingNHibernateException:

> {""Could not compile the mapping document: Infrastructure.DataAccess.Mappings.Post.hbm.xml""}
 
>     Could not find the dialect in the configuration



What is wrong?",nhibernate,,,,,,open,0,30,4,"NHibernate loading error message I am having the error message with MappingNHibernateException:

> {""Could not compile the mapping document: Infrastructure.DataAccess.Mappings.Post.hbm.xml""}
 
>     Could not find the dialect in the configuration



What is wrong?",1
4919636,02/07/2011 09:21:13,167670,09/03/2009 05:56:09,1341,79,Can first level cache be used with ICriteria or other APIs?,"In `NHibernate` you can easily benefit from first level cache when using `Load` or `Get` methods. But what about `ICriteria`, `HQL`, `Linq-to-NHibernate` and `QueryOver`? Do they use first level cache too?",nhibernate,caching,icriteria,first-level-cache,,,open,0,31,11,"Can first level cache be used with ICriteria or other APIs? In `NHibernate` you can easily benefit from first level cache when using `Load` or `Get` methods. But what about `ICriteria`, `HQL`, `Linq-to-NHibernate` and `QueryOver`? Do they use first level cache too?",4
4891294,02/03/2011 20:23:35,592951,01/27/2011 21:52:19,3,0,NHibernate and making a abstract entity base class,"I saw in some nhibernate examples that a abstract base entity class is used, which has overridden Equals , GetHashCode , to handle transient entities , proxy object (in lazy loading scenario .. I guess) . 

Is it really necessary to implement such abstract base entity class to derive all my entities ?
",nhibernate,,,,,,open,0,53,8,"NHibernate and making a abstract entity base class I saw in some nhibernate examples that a abstract base entity class is used, which has overridden Equals , GetHashCode , to handle transient entities , proxy object (in lazy loading scenario .. I guess) . 

Is it really necessary to implement such abstract base entity class to derive all my entities ?
",1
8589013,12/21/2011 11:22:37,1109668,12/21/2011 10:42:18,1,0,Mapping class hierarchy through fluent nhibernate by using 2 strategies,"I want to combine table-per-class and table-per-hierarchy strategies using fluent nhibernate or nhibernate itself(I mean hbm files), but I don't know how. I prefer fluent over hbm but if it's impossible, then hbm is also fine. I tested this by introducing Entity as ClassMap and all other as SubClassMap in fluent but then in hbm files generated by fluent, Entity was a class and all other were joined-classes which is not what I want. I will describe the problem in more detail below.

Class hierarchy:

        public class Entity
    {
        public int ID { get; set; }
        public string Name { get; set; }
    }

    public class Person : Entity
    {
        public string Phone { get; set; }
    }

    public class SystemUser : Person
    {
        public string Password { get; set; }
    }

I want to have one table for entity and one for person and all kinds of it(all its subclasses).I mean I want to use table-per-class strategy for Entity and table-per-hierarchy strategy for Person and SystemUser classes. Database structure is something like this:

    EntityTable(ID(PK),Name)
    PersonTable(EntityID(PK,FK),Phone,Password)    

any help appreciated.",nhibernate,inheritance,hierarchy,fluent,class-hierarchy,,open,0,245,10,"Mapping class hierarchy through fluent nhibernate by using 2 strategies I want to combine table-per-class and table-per-hierarchy strategies using fluent nhibernate or nhibernate itself(I mean hbm files), but I don't know how. I prefer fluent over hbm but if it's impossible, then hbm is also fine. I tested this by introducing Entity as ClassMap and all other as SubClassMap in fluent but then in hbm files generated by fluent, Entity was a class and all other were joined-classes which is not what I want. I will describe the problem in more detail below.

Class hierarchy:

        public class Entity
    {
        public int ID { get; set; }
        public string Name { get; set; }
    }

    public class Person : Entity
    {
        public string Phone { get; set; }
    }

    public class SystemUser : Person
    {
        public string Password { get; set; }
    }

I want to have one table for entity and one for person and all kinds of it(all its subclasses).I mean I want to use table-per-class strategy for Entity and table-per-hierarchy strategy for Person and SystemUser classes. Database structure is something like this:

    EntityTable(ID(PK),Name)
    PersonTable(EntityID(PK,FK),Phone,Password)    

any help appreciated.",5
1986472,12/31/2009 18:08:29,159072,06/02/2009 18:25:22,1273,20,NHibernate simple one-to-many mapping using NHibernate.Mapping.Attributes.,"Can anyone provide me with a web-link which describes attribute-based simple one-to-many mapping very clearly?

For example (A company can have only one country of origin. But there are many Companies in a Country):

    class Company
    {
    }
    
    class Country
    {
        IList<Company> Items;
    }",nhibernate,,,,,,open,0,72,6,"NHibernate simple one-to-many mapping using NHibernate.Mapping.Attributes. Can anyone provide me with a web-link which describes attribute-based simple one-to-many mapping very clearly?

For example (A company can have only one country of origin. But there are many Companies in a Country):

    class Company
    {
    }
    
    class Country
    {
        IList<Company> Items;
    }",1
4855149,01/31/2011 19:31:58,107455,05/15/2009 03:13:52,1827,126,NHibernate: System.Argument Exception : An item with the same key has already been added,"I'm getting a sporadic error that is difficult to reproduce.  My first guess is that somehow I have a leaking nhibernate session, however when I ran the [nhibernate profiler][1], I didn't see much out of the ordinary.

 - MVC 2.0
 - Fluent version 1.1.0.685
 - NHibernate version 2.1.2.4000


> Exception: System.ArgumentException :
> An item with the same key has already
> been added.
> 
> Stack Trace: at
> System.Collections.Generic.Dictionary`2.Insert(TKey
> key, TValue value, Boolean add) at 
> NHibernate.Util.ThreadSafeDictionary`2.Add(TKey
> key, TValue value) at 
> NHibernate.SqlTypes.SqlTypeFactory.GetTypeWithLen[T](Int32
> length, TypeWithLenCreateDelegate
> createDelegate) at 
> NHibernate.Type.EnumStringType..ctor(Type
> enumClass, Int32 length)

I am using a repository model.  Here's my repository class.

    public sealed class Repository<T> : IRepository<T> where T : CoreObjectBase
    {
        #region IRepository<T> Members

        private ISession Session
        {
            get
            {
                return new SessionHelper().GetSession();
            }
        }

        public IQueryable<T> GetAll()
        {
            return (from entity in Session.Linq<T>() select entity);
        }

        public T GetById(int id)
        {
            return Session.Get<T>(id);
        }

        public void Save(params T[] entities)
        {
            using (ITransaction tx = Session.BeginTransaction())
            {
                for (int x = 0; x < entities.Count(); x++)
                {
                    var entity = entities[x];

                    entity.Validate();

                    Session.SaveOrUpdate(entities[x]);

                    if (x == entities.Count() - 1 || (x != 0 && x % 20 == 0)) //20 is the batch size
                    {
                        Session.Flush();
                        Session.Clear();
                    }
                }
                tx.Commit();
            }
        }

        public void SaveWithDependence<K>(T entity, K dependant) where K : CoreObjectBase
        {
            entity.Validate();
            dependant.Validate();

            using (ITransaction tx = Session.BeginTransaction())
            {
                Session.SaveOrUpdate(entity);
                Session.SaveOrUpdate(dependant);
                tx.Commit();
            }
        }

        public void Save(T entity)
        {
            entity.Validate();

            using (ITransaction tx = Session.BeginTransaction())
            {
                Session.SaveOrUpdate(entity);
                tx.Commit();
            }
        }

        public void Delete(T entity)
        {
            using (ITransaction tx = Session.BeginTransaction())
            {
                Session.Delete(entity);
                tx.Commit();
            }
        }

        public T GetOne(QueryBase<T> query)
        {
            var result = query.SatisfyingElementFrom(Session.Linq<T>());

            return result;

            //return query.SatisfyingElementFrom(Session.Linq<T>());
        }

        public IQueryable<T> GetList(QueryBase<T> query)
        {
            return query.SatisfyingElementsFrom(Session.Linq<T>());
        }

        /// <summary>
        /// remove the sepcific object from level 1 cache so it can be refreshed from the database
        /// </summary>
        /// <param name=""entity""></param>
        public void Evict(T entity)
        {
            Session.Evict(entity);
        }
        #endregion
    }


And here is my session helper, adapted from [this][2].

    public sealed class SessionHelper
    {
        private static ISessionFactory _sessionFactory;
        private static ISession _currentSession;

        public ISession GetSession()
        {
            ISessionFactory factory = getSessionFactory();
            ISession session = getExistingOrNewSession(factory);
            return session;
        }

        private ISessionFactory getSessionFactory()
        {
            if (_sessionFactory == null)
            {
                _sessionFactory = BuildSessionFactory();
            }

            return _sessionFactory;
        }

        private ISessionFactory BuildSessionFactory()
        {
            return Fluently.Configure().Database(
                FluentNHibernate.Cfg.Db.MsSqlConfiguration.MsSql2005
                    .ConnectionString(c => c
                        .FromConnectionStringWithKey(""MyDatabase""))
                        .AdoNetBatchSize(20))
                    .Mappings(m => m.FluentMappings.AddFromAssemblyOf<SessionHelper>())
                    .BuildSessionFactory();
        }

        private ISession getExistingOrNewSession(ISessionFactory factory)
        {
            if (HttpContext.Current != null)
            {
                ISession session = GetExistingWebSession();
                if (session == null)
                {
                    session = openSessionAndAddToContext(factory);
                }
                else if (!session.IsOpen)
                {
                    session = openSessionAndAddToContext(factory);
                }

                return session;
            }

            if (_currentSession == null)
            {
                _currentSession = factory.OpenSession();
            }
            else if (!_currentSession.IsOpen)
            {
                _currentSession = factory.OpenSession();
            }

            return _currentSession;
        }

        public ISession GetExistingWebSession()
        {
            return HttpContext.Current.Items[GetType().FullName] as ISession;
        }

        private ISession openSessionAndAddToContext(ISessionFactory factory)
        {
            ISession session = factory.OpenSession();
            HttpContext.Current.Items.Remove(GetType().FullName);
            HttpContext.Current.Items.Add(GetType().FullName, session);
            return session;
        }
    }

Any ideas or suggestions to avoid this issue?


  [1]: http://nhprof.com/
  [2]: http://code.google.com/p/dot-net-reference-app/source/browse/trunk/src/Infrastructure/Impl/HybridSessionBuilder.cs",nhibernate,session,fluent-nhibernate,,,,open,0,2072,14,"NHibernate: System.Argument Exception : An item with the same key has already been added I'm getting a sporadic error that is difficult to reproduce.  My first guess is that somehow I have a leaking nhibernate session, however when I ran the [nhibernate profiler][1], I didn't see much out of the ordinary.

 - MVC 2.0
 - Fluent version 1.1.0.685
 - NHibernate version 2.1.2.4000


> Exception: System.ArgumentException :
> An item with the same key has already
> been added.
> 
> Stack Trace: at
> System.Collections.Generic.Dictionary`2.Insert(TKey
> key, TValue value, Boolean add) at 
> NHibernate.Util.ThreadSafeDictionary`2.Add(TKey
> key, TValue value) at 
> NHibernate.SqlTypes.SqlTypeFactory.GetTypeWithLen[T](Int32
> length, TypeWithLenCreateDelegate
> createDelegate) at 
> NHibernate.Type.EnumStringType..ctor(Type
> enumClass, Int32 length)

I am using a repository model.  Here's my repository class.

    public sealed class Repository<T> : IRepository<T> where T : CoreObjectBase
    {
        #region IRepository<T> Members

        private ISession Session
        {
            get
            {
                return new SessionHelper().GetSession();
            }
        }

        public IQueryable<T> GetAll()
        {
            return (from entity in Session.Linq<T>() select entity);
        }

        public T GetById(int id)
        {
            return Session.Get<T>(id);
        }

        public void Save(params T[] entities)
        {
            using (ITransaction tx = Session.BeginTransaction())
            {
                for (int x = 0; x < entities.Count(); x++)
                {
                    var entity = entities[x];

                    entity.Validate();

                    Session.SaveOrUpdate(entities[x]);

                    if (x == entities.Count() - 1 || (x != 0 && x % 20 == 0)) //20 is the batch size
                    {
                        Session.Flush();
                        Session.Clear();
                    }
                }
                tx.Commit();
            }
        }

        public void SaveWithDependence<K>(T entity, K dependant) where K : CoreObjectBase
        {
            entity.Validate();
            dependant.Validate();

            using (ITransaction tx = Session.BeginTransaction())
            {
                Session.SaveOrUpdate(entity);
                Session.SaveOrUpdate(dependant);
                tx.Commit();
            }
        }

        public void Save(T entity)
        {
            entity.Validate();

            using (ITransaction tx = Session.BeginTransaction())
            {
                Session.SaveOrUpdate(entity);
                tx.Commit();
            }
        }

        public void Delete(T entity)
        {
            using (ITransaction tx = Session.BeginTransaction())
            {
                Session.Delete(entity);
                tx.Commit();
            }
        }

        public T GetOne(QueryBase<T> query)
        {
            var result = query.SatisfyingElementFrom(Session.Linq<T>());

            return result;

            //return query.SatisfyingElementFrom(Session.Linq<T>());
        }

        public IQueryable<T> GetList(QueryBase<T> query)
        {
            return query.SatisfyingElementsFrom(Session.Linq<T>());
        }

        /// <summary>
        /// remove the sepcific object from level 1 cache so it can be refreshed from the database
        /// </summary>
        /// <param name=""entity""></param>
        public void Evict(T entity)
        {
            Session.Evict(entity);
        }
        #endregion
    }


And here is my session helper, adapted from [this][2].

    public sealed class SessionHelper
    {
        private static ISessionFactory _sessionFactory;
        private static ISession _currentSession;

        public ISession GetSession()
        {
            ISessionFactory factory = getSessionFactory();
            ISession session = getExistingOrNewSession(factory);
            return session;
        }

        private ISessionFactory getSessionFactory()
        {
            if (_sessionFactory == null)
            {
                _sessionFactory = BuildSessionFactory();
            }

            return _sessionFactory;
        }

        private ISessionFactory BuildSessionFactory()
        {
            return Fluently.Configure().Database(
                FluentNHibernate.Cfg.Db.MsSqlConfiguration.MsSql2005
                    .ConnectionString(c => c
                        .FromConnectionStringWithKey(""MyDatabase""))
                        .AdoNetBatchSize(20))
                    .Mappings(m => m.FluentMappings.AddFromAssemblyOf<SessionHelper>())
                    .BuildSessionFactory();
        }

        private ISession getExistingOrNewSession(ISessionFactory factory)
        {
            if (HttpContext.Current != null)
            {
                ISession session = GetExistingWebSession();
                if (session == null)
                {
                    session = openSessionAndAddToContext(factory);
                }
                else if (!session.IsOpen)
                {
                    session = openSessionAndAddToContext(factory);
                }

                return session;
            }

            if (_currentSession == null)
            {
                _currentSession = factory.OpenSession();
            }
            else if (!_currentSession.IsOpen)
            {
                _currentSession = factory.OpenSession();
            }

            return _currentSession;
        }

        public ISession GetExistingWebSession()
        {
            return HttpContext.Current.Items[GetType().FullName] as ISession;
        }

        private ISession openSessionAndAddToContext(ISessionFactory factory)
        {
            ISession session = factory.OpenSession();
            HttpContext.Current.Items.Remove(GetType().FullName);
            HttpContext.Current.Items.Add(GetType().FullName, session);
            return session;
        }
    }

Any ideas or suggestions to avoid this issue?


  [1]: http://nhprof.com/
  [2]: http://code.google.com/p/dot-net-reference-app/source/browse/trunk/src/Infrastructure/Impl/HybridSessionBuilder.cs",3
8359787,12/02/2011 16:54:44,920291,08/30/2011 18:23:49,18,0,NHibernate how to set a string type query-param for a named query,"I am calling a stored procedure through NHibernate. Everything is working except that it does not return any values when I try to set the stored procedure input parameter through code.<br/>

So for a stored procedure whose signature is like<br/>
<pre>
dbo.sp_MySp @search_option char(10),  ......<br/>
</pre>

This works
----------

mapping<br/>

        <sql-query name=""sp_MySp"">
          exec dbo.sp_MySp @search_option='ab', ...
        </sql-query>

code
<pre>
var query = Session.GetNamedQuery(""sp_MySp"");<br/>
var results = query.List();<br/>
</pre>

This does not work
------------------

Mapping<br/>

    <sql-query name=""sp_MySp"">
            <query-param name=""search_option"" type=""String""/>
             exec dbo.sp_MySp @search_option=:search_option, ---
    </sql-query>

code<br/>
<pre>
var query = Session.GetNamedQuery(""sp_MySp"");<br/>
query.SetParameter(""search_option"", ""ab"");<br/>
var results = query.List();<br/>
</pre>

Can someone point out what I am missing here....


",nhibernate,stored-procedures,parameters,mapping,varchar,,open,0,137,12,"NHibernate how to set a string type query-param for a named query I am calling a stored procedure through NHibernate. Everything is working except that it does not return any values when I try to set the stored procedure input parameter through code.<br/>

So for a stored procedure whose signature is like<br/>
<pre>
dbo.sp_MySp @search_option char(10),  ......<br/>
</pre>

This works
----------

mapping<br/>

        <sql-query name=""sp_MySp"">
          exec dbo.sp_MySp @search_option='ab', ...
        </sql-query>

code
<pre>
var query = Session.GetNamedQuery(""sp_MySp"");<br/>
var results = query.List();<br/>
</pre>

This does not work
------------------

Mapping<br/>

    <sql-query name=""sp_MySp"">
            <query-param name=""search_option"" type=""String""/>
             exec dbo.sp_MySp @search_option=:search_option, ---
    </sql-query>

code<br/>
<pre>
var query = Session.GetNamedQuery(""sp_MySp"");<br/>
query.SetParameter(""search_option"", ""ab"");<br/>
var results = query.List();<br/>
</pre>

Can someone point out what I am missing here....


",5
4573424,01/01/2011 07:06:13,480322,10/19/2010 09:58:36,32,0,nhibernate3 weaknesses,"from the moment we've migrated  to nhibernate3 ,around 30% percent of queries can not execute anymore,while there were not any problem with the previous version. does anybody have such problems? ",nhibernate,,,,,01/02/2011 01:37:45,not a real question,1,32,2,"nhibernate3 weaknesses from the moment we've migrated  to nhibernate3 ,around 30% percent of queries can not execute anymore,while there were not any problem with the previous version. does anybody have such problems? ",1
2950801,06/01/2010 14:52:53,231216,12/14/2009 11:59:17,198,15,NHibernate - is property lazy loading possible?,"I've got some binary data that I store and was going to separate this out into a separate table so it could be lazy loaded.

However, i then came across this post by Ayende ([http://ayende.com/Blog/archive/2010/01/27/nhibernate-new-feature-lazy-properties.aspx][1]) which suggests that property lazy loading is now possible.

I have added the lazy=""true"" attribute to my property mapping but the field is still loaded from the database (I am using a simple text field to test).

My query:

                    return _session.CreateQuery(""from Product"")
                    .SetMaxResults(1)
                    .UniqueResult<Product>();

Mapping:

    <property name=""Description"" type=""string"" column=""FullDescription"" lazy=""true""/>

Has anyone been able to get this working? Personally I prefer this approach than having to add another table to my database.


  [1]: http://ayende.com/Blog/archive/2010/01/27/nhibernate-new-feature-lazy-properties.aspx",nhibernate,lazy-loading,,,,,open,0,165,7,"NHibernate - is property lazy loading possible? I've got some binary data that I store and was going to separate this out into a separate table so it could be lazy loaded.

However, i then came across this post by Ayende ([http://ayende.com/Blog/archive/2010/01/27/nhibernate-new-feature-lazy-properties.aspx][1]) which suggests that property lazy loading is now possible.

I have added the lazy=""true"" attribute to my property mapping but the field is still loaded from the database (I am using a simple text field to test).

My query:

                    return _session.CreateQuery(""from Product"")
                    .SetMaxResults(1)
                    .UniqueResult<Product>();

Mapping:

    <property name=""Description"" type=""string"" column=""FullDescription"" lazy=""true""/>

Has anyone been able to get this working? Personally I prefer this approach than having to add another table to my database.


  [1]: http://ayende.com/Blog/archive/2010/01/27/nhibernate-new-feature-lazy-properties.aspx",2
1762370,11/19/2009 10:37:20,187030,10/09/2009 09:02:42,1,0,NHibernate search specific subclass,"Is it possible to filter on a particular joined-subclass in NHibernate?

For example, I have the following classes:

    Pet { Name }
    Cat: Pet { Paws }
    Budgie: Pet { Wings }
    Person { Pets }

I want to create an NHibernate search to give me Persons with Cats with 4 paws.

I can only seem to be able to restrict on a Pet's attributes (Name)...
",nhibernate,criteria,joined-subclass,,,,open,0,75,4,"NHibernate search specific subclass Is it possible to filter on a particular joined-subclass in NHibernate?

For example, I have the following classes:

    Pet { Name }
    Cat: Pet { Paws }
    Budgie: Pet { Wings }
    Person { Pets }

I want to create an NHibernate search to give me Persons with Cats with 4 paws.

I can only seem to be able to restrict on a Pet's attributes (Name)...
",3
6697291,07/14/2011 17:14:12,665335,03/18/2011 01:05:50,203,3,Good NHibernate tutorial recommendation help,"I am looking for a good NHibernate tutorial, websites or books.

Thanks!",nhibernate,tutorials,recommendation,,,07/19/2011 12:19:59,not constructive,1,11,5,"Good NHibernate tutorial recommendation help I am looking for a good NHibernate tutorial, websites or books.

Thanks!",3
1279926,08/14/2009 20:07:18,156702,08/14/2009 20:07:18,1,0,NHibernate first level cache and Transaction Management between TransactionScope and NHibernate ITransaction,"My development group is about to release a version of an internal framework that uses NHibernate (and Spring.NET) for persistence. Developers currently using our internal framework use ADO.NET for persistence, so going forward they will use a combination of ADO.NET and NHibernate. During testing of the NHibernate, we found out that the NHibernate first level cache wasn't working as expected when we define a transaction with System.Transactions.TransactionScope.

Goal:
1) Get NHibernate first level cache working within TransactionScope 'using' block.

    - Use TransactionScope using block to manage all transactions.
    - Somehow need to manage NHibernate ITransaction along with TransactionScope ambient transaction (System.Transactions.Transaction.Current).

Assumptions:
1) Developers can use one or both of two repository implementations:

    A) An application will access multiple databases using ADO.NET.
    B) An application will use NHibernate to only access one database (one session factory).
    C) Tables mapped to NHibernate may reside in the same database as tables accessed by ADO.NET.

2) Existing application code uses TransactionScope 'using' block to handle distributed transactions; this will not change.
3) We are unable to use Spring [Transaction] attribute or TransactionTemplate to manage transactions at this time because we cannot force developers to modify existing code (current directive).

Problem:
In order to get NHibernate first level cache to work, we need to get the connection from the NHibernate session. And, to get the connection from the NHibernate session, we must be within an NHibernate transaction because we have specified the NHibernateTransactionManager as our Spring.NET IPlatformTransactionManager. So, we need to find a way to kick off a transaction without using [Transaction] or TransactionTemplate.

We are using the following to get the connection from the NHibernate session (A and B are the same behind the scenes?):
A) ConnectionUtils.GetConnection(dbProvider)
B) SessionFactory.GetCurrentSession().Connection

In order to kick off an NHibernate transaction when developers call 'using (new TransactionScope())' we intercept the creation of TransactionScope as follows:

Code:

    using (TransactionScope transaction = DatabaseHelper.GetTransactionScope())
    {
         ...
    }

DatabaseHelper is a public, static class that developers use for database access helper methods. DatabaseHelper.GetTransactionScope() gets the TransactionScope object from the following factory class:

NHibernateTransactionScopeFactory : TransactionScopeFactory (abstract class derived from ITransactionScopeFactory)


Code:

    /// <summary>
    /// An interface for obtaining a <see cref=""TransactionScope""/>.
    /// </summary>
    public interface ITransactionScopeFactory
    {
        /// <summary>
        /// Get a transaction scope.
        /// </summary>
        /// <param name=""transactionOptions"">The options to use when creating the <see cref=""TransactionScope""/> object.</param>
        /// <returns>A <see cref=""TransactionScope""/> object.</returns>
        TransactionScope CreateTransactionScope(TransactionOptions transactionOptions);

        /// <summary>
        /// Transaction management object.  Used to help Spring.NET manage transactions
        /// between NHibernate's ITransaction and <see cref=""TransactionScope""/>.
        /// </summary>
        IPlatformTransactionManager TransactionManager { get; set; }
    }

The NHibernateTransactionScopeFactory is injected with the defined IPlatformTransactionManager. The NHibernateTransactionScopeFactory calls TransactionManager.GetTransaction() in the NHibernateTransactionScopeFactory.CreateTransactionScope() method in order to kick off the NHibernate transaction and bind the NHibernate session to thread local storage. The NHibernateTransactionScopeFactory stores the ITransactionStatus object returned from the TransactionManager.GetTransaction() method in thread local storage. The NHibernateTransactionScopeFactory subscribes to the Transaction.Current.TransactionCompleted event in order to call TransactionManager.Commit() or TransactionManager.Rollback() using the ITransactionStatus object that was returned from the GetTransaction() method.

Code for NHibernateTransactionScopeFactory.CreateTransactionScope() method:

    bool newTransaction = null == Transaction.Current;
    
    if (newTransaction)
    {
        longSession = SessionFactoryUtils.GetNewSession(sessionFactory, null);
        longSession.FlushMode = FlushMode.Auto;
        
        IPlatformTransactionManager transactionManager = (IPlatformTransactionManager)SpringHelper.GetObjec t(""transactionManager"");
        ITransactionDefinition def = new DefaultTransactionDefinition();
        transactionStatus = transactionManager.GetTransaction(new DefaultTransactionDefinition());
    }
    
    TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, transactionOptions);
    
    if (newTransaction)
    {
        Transaction.Current.TransactionCompleted += new TransactionCompletedEventHandler(Current_Transacti onCompleted);
    }

The Current_TransactionCompleted method checks the status of the Transaction and commits or rollsback the NHibernate transaction appropriately.

Another thing we had to do was, for all subsequent Database operations within the scope of the outer TransactionScope, get the connection from the session and enlist all the commands in the NHibernate transaction.

We are running into an issue when we have events though.
Here is the scenario:

Our test has a Parent object with two Child objects. Both the Parent and Child object have OnSave events that set the auditing information (Created and Modified User and date information) in the objects.

Here is the sequence of events:

- Start NHibernate session and Transaction
- Start TransactionScope
- Call Parent.Save
- Parent.OnSave event fires. This starts a TransactionScope, which enlists in the ambient NHibernate transaction.
- NHibernate cascades the save to Child.Save
- Child.Save event fires. This starts a TransactionScope, which enlists in the ambient NHibernate transaction.
- Parent and child objects are saved.

- TransactionScope.Completed even fires
- Commit the NHibernate transaction
- This causes a session.Flush()
- This cascades the save operation for the Child collection.
- Child.Save event fires. This starts a TransactionScope. By this time, the NHibernate transaction is still active, but out Transaction.Current is null. So, when this TransactionScope completes, it tries to commit the NHibernate transaction again, which results in the following exception:

Spring.Transaction.IllegalTransactionStateExceptio n: Transaction is already completed - do not call commit or rollback more than once per transaction.

For testing purposes, we tried to commit the NHibernate transaction explicitly from the test instead of firing it from the TransactionScope.Completed event and things work fine.
So, this leaves us with two issues:

- Can we trap a 'BeforeCompleted' event for System.Transaction?
- Can we stop NHibernate from firing the Save for the collection during the Commit?

Are there any other things we could try. Also, I would like to know if this approach is valid and see if we are overlooking any other issues.

Any help is appreciated.",nhibernate,transactions,transactionscope,spring.net,,11/11/2011 11:37:38,too localized,1,1051,12,"NHibernate first level cache and Transaction Management between TransactionScope and NHibernate ITransaction My development group is about to release a version of an internal framework that uses NHibernate (and Spring.NET) for persistence. Developers currently using our internal framework use ADO.NET for persistence, so going forward they will use a combination of ADO.NET and NHibernate. During testing of the NHibernate, we found out that the NHibernate first level cache wasn't working as expected when we define a transaction with System.Transactions.TransactionScope.

Goal:
1) Get NHibernate first level cache working within TransactionScope 'using' block.

    - Use TransactionScope using block to manage all transactions.
    - Somehow need to manage NHibernate ITransaction along with TransactionScope ambient transaction (System.Transactions.Transaction.Current).

Assumptions:
1) Developers can use one or both of two repository implementations:

    A) An application will access multiple databases using ADO.NET.
    B) An application will use NHibernate to only access one database (one session factory).
    C) Tables mapped to NHibernate may reside in the same database as tables accessed by ADO.NET.

2) Existing application code uses TransactionScope 'using' block to handle distributed transactions; this will not change.
3) We are unable to use Spring [Transaction] attribute or TransactionTemplate to manage transactions at this time because we cannot force developers to modify existing code (current directive).

Problem:
In order to get NHibernate first level cache to work, we need to get the connection from the NHibernate session. And, to get the connection from the NHibernate session, we must be within an NHibernate transaction because we have specified the NHibernateTransactionManager as our Spring.NET IPlatformTransactionManager. So, we need to find a way to kick off a transaction without using [Transaction] or TransactionTemplate.

We are using the following to get the connection from the NHibernate session (A and B are the same behind the scenes?):
A) ConnectionUtils.GetConnection(dbProvider)
B) SessionFactory.GetCurrentSession().Connection

In order to kick off an NHibernate transaction when developers call 'using (new TransactionScope())' we intercept the creation of TransactionScope as follows:

Code:

    using (TransactionScope transaction = DatabaseHelper.GetTransactionScope())
    {
         ...
    }

DatabaseHelper is a public, static class that developers use for database access helper methods. DatabaseHelper.GetTransactionScope() gets the TransactionScope object from the following factory class:

NHibernateTransactionScopeFactory : TransactionScopeFactory (abstract class derived from ITransactionScopeFactory)


Code:

    /// <summary>
    /// An interface for obtaining a <see cref=""TransactionScope""/>.
    /// </summary>
    public interface ITransactionScopeFactory
    {
        /// <summary>
        /// Get a transaction scope.
        /// </summary>
        /// <param name=""transactionOptions"">The options to use when creating the <see cref=""TransactionScope""/> object.</param>
        /// <returns>A <see cref=""TransactionScope""/> object.</returns>
        TransactionScope CreateTransactionScope(TransactionOptions transactionOptions);

        /// <summary>
        /// Transaction management object.  Used to help Spring.NET manage transactions
        /// between NHibernate's ITransaction and <see cref=""TransactionScope""/>.
        /// </summary>
        IPlatformTransactionManager TransactionManager { get; set; }
    }

The NHibernateTransactionScopeFactory is injected with the defined IPlatformTransactionManager. The NHibernateTransactionScopeFactory calls TransactionManager.GetTransaction() in the NHibernateTransactionScopeFactory.CreateTransactionScope() method in order to kick off the NHibernate transaction and bind the NHibernate session to thread local storage. The NHibernateTransactionScopeFactory stores the ITransactionStatus object returned from the TransactionManager.GetTransaction() method in thread local storage. The NHibernateTransactionScopeFactory subscribes to the Transaction.Current.TransactionCompleted event in order to call TransactionManager.Commit() or TransactionManager.Rollback() using the ITransactionStatus object that was returned from the GetTransaction() method.

Code for NHibernateTransactionScopeFactory.CreateTransactionScope() method:

    bool newTransaction = null == Transaction.Current;
    
    if (newTransaction)
    {
        longSession = SessionFactoryUtils.GetNewSession(sessionFactory, null);
        longSession.FlushMode = FlushMode.Auto;
        
        IPlatformTransactionManager transactionManager = (IPlatformTransactionManager)SpringHelper.GetObjec t(""transactionManager"");
        ITransactionDefinition def = new DefaultTransactionDefinition();
        transactionStatus = transactionManager.GetTransaction(new DefaultTransactionDefinition());
    }
    
    TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, transactionOptions);
    
    if (newTransaction)
    {
        Transaction.Current.TransactionCompleted += new TransactionCompletedEventHandler(Current_Transacti onCompleted);
    }

The Current_TransactionCompleted method checks the status of the Transaction and commits or rollsback the NHibernate transaction appropriately.

Another thing we had to do was, for all subsequent Database operations within the scope of the outer TransactionScope, get the connection from the session and enlist all the commands in the NHibernate transaction.

We are running into an issue when we have events though.
Here is the scenario:

Our test has a Parent object with two Child objects. Both the Parent and Child object have OnSave events that set the auditing information (Created and Modified User and date information) in the objects.

Here is the sequence of events:

- Start NHibernate session and Transaction
- Start TransactionScope
- Call Parent.Save
- Parent.OnSave event fires. This starts a TransactionScope, which enlists in the ambient NHibernate transaction.
- NHibernate cascades the save to Child.Save
- Child.Save event fires. This starts a TransactionScope, which enlists in the ambient NHibernate transaction.
- Parent and child objects are saved.

- TransactionScope.Completed even fires
- Commit the NHibernate transaction
- This causes a session.Flush()
- This cascades the save operation for the Child collection.
- Child.Save event fires. This starts a TransactionScope. By this time, the NHibernate transaction is still active, but out Transaction.Current is null. So, when this TransactionScope completes, it tries to commit the NHibernate transaction again, which results in the following exception:

Spring.Transaction.IllegalTransactionStateExceptio n: Transaction is already completed - do not call commit or rollback more than once per transaction.

For testing purposes, we tried to commit the NHibernate transaction explicitly from the test instead of firing it from the TransactionScope.Completed event and things work fine.
So, this leaves us with two issues:

- Can we trap a 'BeforeCompleted' event for System.Transaction?
- Can we stop NHibernate from firing the Save for the collection during the Commit?

Are there any other things we could try. Also, I would like to know if this approach is valid and see if we are overlooking any other issues.

Any help is appreciated.",4
7753547,10/13/2011 11:40:34,357844,07/22/2009 18:48:19,260,0,Looking for reasons to still continue with Nhibernate?,"I am using Nhibernate with Fluent Nhibernate in my projects. But there are lot's of ORM tools available now. Like Microsoft has Entity Framework. I am looking for reasons to still continue with Nhibernate? (Pros & Cons of using Nhibernate)

Thanks in advance to participate in this discussion.",nhibernate,orm,,,,10/13/2011 16:11:20,not constructive,1,47,8,"Looking for reasons to still continue with Nhibernate? I am using Nhibernate with Fluent Nhibernate in my projects. But there are lot's of ORM tools available now. Like Microsoft has Entity Framework. I am looking for reasons to still continue with Nhibernate? (Pros & Cons of using Nhibernate)

Thanks in advance to participate in this discussion.",2
5824929,04/28/2011 20:58:00,36475,11/11/2008 08:29:59,78,3,nHibernate 3 QueryOver with compound from clause,"Does anybody know a way to do compound from clauses - that are possible with Linq to objects - with nHibernate 3 QueryOver syntax. I know its possible with Linq To nHibernate, but I'm still trying to get my head around the queryover apis.

Here is the example taken from the msdn for Linq to objects:

    var scoreQuery = from student in students
                     from score in student.Scores
                     where score > 90
                     select new { Last = student.LastName, score };

Taken from [MSDN][1]


  [1]: http://msdn.microsoft.com/en-us/library/bb383978.aspx",nhibernate,linq-to-nhibernate,queryover,nhibernate3,,,open,0,146,7,"nHibernate 3 QueryOver with compound from clause Does anybody know a way to do compound from clauses - that are possible with Linq to objects - with nHibernate 3 QueryOver syntax. I know its possible with Linq To nHibernate, but I'm still trying to get my head around the queryover apis.

Here is the example taken from the msdn for Linq to objects:

    var scoreQuery = from student in students
                     from score in student.Scores
                     where score > 90
                     select new { Last = student.LastName, score };

Taken from [MSDN][1]


  [1]: http://msdn.microsoft.com/en-us/library/bb383978.aspx",4
3534698,08/20/2010 20:34:40,134363,07/07/2009 16:16:36,250,9,Is it better to create proxies for table with multi-faceted domains or use inheritance?,"I'm using NHibernate and Dynamic Proxy. I have one table (Customer) with generic fields: charField1, charField2, etc. One record in this table may represent company A while another record may represent company B. However, a different domain model will exist for company A's data than company B's data because they require different information. Likewise, Company A will make use of a different business logic layer than Company B.

Because of this, CompanyA's record would have different associations with different tables than Company B.

I have been reading about the use of proxies and their capabilities in NHibernate and it seems like this could be useful for my scenario; however, **would it be better to simply inherit from BaseCompanyTable?**

If I use a proxy, I'm imagining creating interfaces that simply have the appropriate mappings to other tables/domains based on the company's mapping type and that is what the interceptor would handle. My ViewModel would then query only that company information and have the interfaces to deal with. When it saves, the business logic would validate it, post it, the interceptor would only save the BaseCompanyTable.",nhibernate,proxy,iinterceptor,,,,open,0,181,14,"Is it better to create proxies for table with multi-faceted domains or use inheritance? I'm using NHibernate and Dynamic Proxy. I have one table (Customer) with generic fields: charField1, charField2, etc. One record in this table may represent company A while another record may represent company B. However, a different domain model will exist for company A's data than company B's data because they require different information. Likewise, Company A will make use of a different business logic layer than Company B.

Because of this, CompanyA's record would have different associations with different tables than Company B.

I have been reading about the use of proxies and their capabilities in NHibernate and it seems like this could be useful for my scenario; however, **would it be better to simply inherit from BaseCompanyTable?**

If I use a proxy, I'm imagining creating interfaces that simply have the appropriate mappings to other tables/domains based on the company's mapping type and that is what the interceptor would handle. My ViewModel would then query only that company information and have the interfaces to deal with. When it saves, the business logic would validate it, post it, the interceptor would only save the BaseCompanyTable.",3
5715897,04/19/2011 11:51:19,271106,02/11/2010 13:42:22,1363,97,NHibernate Joined-Subclass Get Problem,"I have the following mapped classes:

		<class name=""Company"" table=""Company"">
			<id name=""ID"" column=""CompanyID"">
			  <generator class=""native""/>
			</id>
			<joined-subclass name=""CompanyAccounting"" table=""company_accounting"" lazy=""true"">
			  <key column=""CompanyID""/>
			</joined-subclass>
			<joined-subclass name=""CompanyCarbon"" table=""company_carbon"" lazy=""true"">
			  <key column=""CompanyID"" />
			</joined-subclass>
		</class>

Now the following test fails:

            var company = CompanyAdapter.Get<Company>(_session, 32);
            Assert.IsNotNull(company);

            var client = CompanyAdapter.Get<CompanyClient>(_session, 32);
            Assert.IsNotNull(client);

But the following succeeds:

            var client = CompanyAdapter.Get<CompanyClient>(_session, 32);
            Assert.IsNotNull(client);

            var company = CompanyAdapter.Get<Company>(_session, 32);
            Assert.IsNotNull(company);

The reason the first test fails is because NHibernate retrieve Company as CompanyAccounting, as Company(32) is both an accounting company and a client, and when i call Session.Get<CompanyClient> after it has retrieved company as CompanyAccounting it doesn't go back to the database and check if there is an entry for CompanyClient, it assumes Company can only be on subclass, is there anyway of making it specify that it can inherit from all of the subclasses?",nhibernate,query,inheritance,nhibernate-mapping,,,open,0,219,4,"NHibernate Joined-Subclass Get Problem I have the following mapped classes:

		<class name=""Company"" table=""Company"">
			<id name=""ID"" column=""CompanyID"">
			  <generator class=""native""/>
			</id>
			<joined-subclass name=""CompanyAccounting"" table=""company_accounting"" lazy=""true"">
			  <key column=""CompanyID""/>
			</joined-subclass>
			<joined-subclass name=""CompanyCarbon"" table=""company_carbon"" lazy=""true"">
			  <key column=""CompanyID"" />
			</joined-subclass>
		</class>

Now the following test fails:

            var company = CompanyAdapter.Get<Company>(_session, 32);
            Assert.IsNotNull(company);

            var client = CompanyAdapter.Get<CompanyClient>(_session, 32);
            Assert.IsNotNull(client);

But the following succeeds:

            var client = CompanyAdapter.Get<CompanyClient>(_session, 32);
            Assert.IsNotNull(client);

            var company = CompanyAdapter.Get<Company>(_session, 32);
            Assert.IsNotNull(company);

The reason the first test fails is because NHibernate retrieve Company as CompanyAccounting, as Company(32) is both an accounting company and a client, and when i call Session.Get<CompanyClient> after it has retrieved company as CompanyAccounting it doesn't go back to the database and check if there is an entry for CompanyClient, it assumes Company can only be on subclass, is there anyway of making it specify that it can inherit from all of the subclasses?",4
2133393,01/25/2010 15:42:00,75224,09/29/2008 14:28:16,316,18,Is update with nested select atomic operation?,"I need to select first (let's say) 10000 rows in database and return them. There may be more clients that do this operation at one time. So I came up with this query:

    update v set v.batch_Id = :batchId 
    	from tblRedir v 
    	inner join (
    		select top 10000 id 
    			from tblRedir
    			where batch_Id is null 
    			order by Date asc
    	) v2 on v.id=v2.id

so it is a operation that consists from update and nested select. Both the queries work on the same table (tblRedir). The idea is that the rows are first marked by a unique batchId and then returned via

    select * from tblRedir where batch_id = :batchId

(the batchid is a unique identifier (e.g. timestamp or guid) for each this update)

*My question:*

I thought that the operation *update with nested select* is atomic - that means that every client receives his own set of data that is unique (no other client received a subset of his data).

However it looks that I'm wrong - in some cases there are clients that receive no data, because probably they first **both** execute the select and **then both** execute the update (so the first client has no marked rows).

So is this operation atomic or not?


----------


I work with Sql server 2005. The query is run via NHibernate like this

    session.CreateSQLQuery('update....')",nhibernate,sql,sql-server,concurrency,,,open,0,248,7,"Is update with nested select atomic operation? I need to select first (let's say) 10000 rows in database and return them. There may be more clients that do this operation at one time. So I came up with this query:

    update v set v.batch_Id = :batchId 
    	from tblRedir v 
    	inner join (
    		select top 10000 id 
    			from tblRedir
    			where batch_Id is null 
    			order by Date asc
    	) v2 on v.id=v2.id

so it is a operation that consists from update and nested select. Both the queries work on the same table (tblRedir). The idea is that the rows are first marked by a unique batchId and then returned via

    select * from tblRedir where batch_id = :batchId

(the batchid is a unique identifier (e.g. timestamp or guid) for each this update)

*My question:*

I thought that the operation *update with nested select* is atomic - that means that every client receives his own set of data that is unique (no other client received a subset of his data).

However it looks that I'm wrong - in some cases there are clients that receive no data, because probably they first **both** execute the select and **then both** execute the update (so the first client has no marked rows).

So is this operation atomic or not?


----------


I work with Sql server 2005. The query is run via NHibernate like this

    session.CreateSQLQuery('update....')",4
6755965,07/20/2011 01:17:00,853062,07/20/2011 01:17:00,1,0,Override SaveOrUpdate Method in NHibernate?,"Can someone tell me how to override SaveOrUpdate Method in NHibernate?
I need to use the dll that will provide me a connection object and a function to execute database query. Now I need NHibernate to connect using that connection object and execute all the query through that function.
Please kindly let me know how to achieve that.",nhibernate,,,,,,open,0,56,5,"Override SaveOrUpdate Method in NHibernate? Can someone tell me how to override SaveOrUpdate Method in NHibernate?
I need to use the dll that will provide me a connection object and a function to execute database query. Now I need NHibernate to connect using that connection object and execute all the query through that function.
Please kindly let me know how to achieve that.",1
4961433,02/10/2011 19:02:39,552422,12/23/2010 13:47:10,118,9,Executing tests,"Guys, I'm new on all of this. And I'm doing a project using Repository Pattern and other things...

I'm following this tutorial: 
Http://blog.bobcravens.com201006the-repository-pattern-with-linq-to-fluent-nhibernate-and-mysql

The point is.... How can I test this method...

    [TestMethod]
    public void Add_100_Trucks_With_1000_Location_Points_Each()
    {
        NHibernateHelper helper = new NHibernateHelper(_connectionString);
    
        for (int i = 0; i < 100; i++)
        {
            // Notice the unit of work we are using is to commit
            //    one truck's data at a time.
            UnitOfWork unitOfWork = new UnitOfWork(helper.SessionFactory);
    
            Repository<Truck> repository = new Repository<Truck>(unitOfWork.Session);
    
            Truck truck = CreateTruck(string.Format(""Truck {0}"", i + 1), 1000);
            repository.Add(truck);
    
            unitOfWork.Commit();
        }
    }
    
    private static Truck CreateTruck(string name, int numberOfLocations)
    {
        Truck truck = new Truck
                          {
                            Name = name,
                            PlateNumber = string.Format(""ABC-{0}"", name),
                            Type = string.Format(""Type {0}"", name)
                          };
        Driver driver = new Driver
                            {
                                FirstName = ""Bob"",
                                LastName = ""Cravens""
                            };
        truck.AddDriver(driver);
    
        for (int j = 0; j < numberOfLocations; j++)
        {
            Location location = new Location
                                    {
                                        Timestamp = DateTime.Now.AddMinutes(5*j),
                                        Latitude = 10.0f + j,
                                        Longitude = -10.0f - j
                                    };
            truck.AddLocation(location);
        }
        return truck;
    }

I just don't know what to do with this.

Could someone helpe me?

Thks guys.
",nhibernate,visual-studio-2010,asp.net-mvc-3,,,,open,0,838,2,"Executing tests Guys, I'm new on all of this. And I'm doing a project using Repository Pattern and other things...

I'm following this tutorial: 
Http://blog.bobcravens.com201006the-repository-pattern-with-linq-to-fluent-nhibernate-and-mysql

The point is.... How can I test this method...

    [TestMethod]
    public void Add_100_Trucks_With_1000_Location_Points_Each()
    {
        NHibernateHelper helper = new NHibernateHelper(_connectionString);
    
        for (int i = 0; i < 100; i++)
        {
            // Notice the unit of work we are using is to commit
            //    one truck's data at a time.
            UnitOfWork unitOfWork = new UnitOfWork(helper.SessionFactory);
    
            Repository<Truck> repository = new Repository<Truck>(unitOfWork.Session);
    
            Truck truck = CreateTruck(string.Format(""Truck {0}"", i + 1), 1000);
            repository.Add(truck);
    
            unitOfWork.Commit();
        }
    }
    
    private static Truck CreateTruck(string name, int numberOfLocations)
    {
        Truck truck = new Truck
                          {
                            Name = name,
                            PlateNumber = string.Format(""ABC-{0}"", name),
                            Type = string.Format(""Type {0}"", name)
                          };
        Driver driver = new Driver
                            {
                                FirstName = ""Bob"",
                                LastName = ""Cravens""
                            };
        truck.AddDriver(driver);
    
        for (int j = 0; j < numberOfLocations; j++)
        {
            Location location = new Location
                                    {
                                        Timestamp = DateTime.Now.AddMinutes(5*j),
                                        Latitude = 10.0f + j,
                                        Longitude = -10.0f - j
                                    };
            truck.AddLocation(location);
        }
        return truck;
    }

I just don't know what to do with this.

Could someone helpe me?

Thks guys.
",3
4147320,11/10/2010 17:40:25,305684,03/31/2010 04:27:13,92,0,Do i need to study Spring with hibernate books to get job?,"Isn't it enough if i just read spring & Hibernate separately and combine when the situation demands..

In other words: Why there are books with the title like `Spring with hibernate` etc..

The book i am reading for `Pro spring 2.5` has a chapter dedicated for `working with hibernate`. Is that enough or should i purchase and study another book which talks about spring integration with hibernate.


NOTE: 

 1. I am learning hibernate from Java
    Persistence with hibernate (Which is
    a bit boring)
 2. Planning to learn spring from Pro
    Spring 2.5 [tried spring in action
    but it is kind of like easy but not
    in depth]

I hope i made my point clear..",nhibernate,spring,career-development,,,11/10/2010 20:51:03,not a real question,1,126,12,"Do i need to study Spring with hibernate books to get job? Isn't it enough if i just read spring & Hibernate separately and combine when the situation demands..

In other words: Why there are books with the title like `Spring with hibernate` etc..

The book i am reading for `Pro spring 2.5` has a chapter dedicated for `working with hibernate`. Is that enough or should i purchase and study another book which talks about spring integration with hibernate.


NOTE: 

 1. I am learning hibernate from Java
    Persistence with hibernate (Which is
    a bit boring)
 2. Planning to learn spring from Pro
    Spring 2.5 [tried spring in action
    but it is kind of like easy but not
    in depth]

I hope i made my point clear..",3
6343922,06/14/2011 13:05:59,36383,11/11/2008 00:08:22,432,15,Fluent NHibernate HasMany not inserting parent id,"I cannot figure out why NHibernate is inserting a child entity without the foreign key. Here are my classes

    public class Order {
        public Order() {
            this.Notes = new List<OrderNote>();
        }

        public virtual int OrderId {get; private set;}
        public virtual IList<OrderNote> Notes {get; private set;}
    }

    public class OrderNote {
        public OrderNote(string noteBy, string note) {
            this.OrderNoteId = Guid.NewGuid();
            this.NoteBy = noteBy;
            this.Note = note;
        }

        public virtual Guid OrderNoteId {get; private set;}
        public virtual string NoteBy {get; private set;}
        public virtual string Note {get; private set;
    }

Here are my Fluent NHibernate mapping files

    public class OrderClassMap : ClassMap<Order> {
        public OrderClassMap() {
            Id(x => x.OrderId).GeneratedBy.Native();
            HasMany(x => x.Notes).Inverse.KeyColumn(""OrderId"").Cascase.AllDeleteOrphan();
        }
    }

    public class OrderNoteClassMap : ClassMap<OrderNote> {
        public OrderNoteClassMap() {
            Id(x => x.OrderNoteId).GeneratedBy.Assigned();
            Map(x => x.NoteBy);
            Map(x => x.Note);
        }
    }

When I add a note to the order's notes collection and save the order, the order note gets inserted into the database without the foreign key.

    Order order = session.Query<Order>().Where(o => (o.OrderId == orderId)).Single();
    order.Notes.Add(new OrderNote(""Name"", ""This is a note""));
    session.SaveOrUpdate(order);

The insert statement that gets generated is this:

    INSERT INTO OrderNotes(OrderNoteId, NoteBy, Note)

It should be:

    INSERT INTO OrderNotes(OrderNoteId, NoteBy, Note, OrderId)

Why is this happening? What am I doing wrong?",nhibernate,fluent-nhibernate,,,,,open,0,428,7,"Fluent NHibernate HasMany not inserting parent id I cannot figure out why NHibernate is inserting a child entity without the foreign key. Here are my classes

    public class Order {
        public Order() {
            this.Notes = new List<OrderNote>();
        }

        public virtual int OrderId {get; private set;}
        public virtual IList<OrderNote> Notes {get; private set;}
    }

    public class OrderNote {
        public OrderNote(string noteBy, string note) {
            this.OrderNoteId = Guid.NewGuid();
            this.NoteBy = noteBy;
            this.Note = note;
        }

        public virtual Guid OrderNoteId {get; private set;}
        public virtual string NoteBy {get; private set;}
        public virtual string Note {get; private set;
    }

Here are my Fluent NHibernate mapping files

    public class OrderClassMap : ClassMap<Order> {
        public OrderClassMap() {
            Id(x => x.OrderId).GeneratedBy.Native();
            HasMany(x => x.Notes).Inverse.KeyColumn(""OrderId"").Cascase.AllDeleteOrphan();
        }
    }

    public class OrderNoteClassMap : ClassMap<OrderNote> {
        public OrderNoteClassMap() {
            Id(x => x.OrderNoteId).GeneratedBy.Assigned();
            Map(x => x.NoteBy);
            Map(x => x.Note);
        }
    }

When I add a note to the order's notes collection and save the order, the order note gets inserted into the database without the foreign key.

    Order order = session.Query<Order>().Where(o => (o.OrderId == orderId)).Single();
    order.Notes.Add(new OrderNote(""Name"", ""This is a note""));
    session.SaveOrUpdate(order);

The insert statement that gets generated is this:

    INSERT INTO OrderNotes(OrderNoteId, NoteBy, Note)

It should be:

    INSERT INTO OrderNotes(OrderNoteId, NoteBy, Note, OrderId)

Why is this happening? What am I doing wrong?",2
3350582,07/28/2010 07:02:06,44269,12/08/2008 11:34:34,7460,235,How do I strongly type criteria when using NHibernate's CreateCriteria method?,"I'm currently using NHibernate, for the first time, with Fluent NHibernate. I've gotten everything setup nicely, however now I've come to actual doing some data retrieval, it seems to have fallen short.

I was expecting NHibernate, to allow me to do something like:

    session.CreateCriteria<TblDocket>()
        .Add(Restrictions.Eq(x=> x.DocketNumber, ""10101""));

However, this doesn't appear to be the case and I seem to have to write:

    session.CreateCriteria<TblDocket>()
        .Add(Restrictions.Eq(""DocketNumber"", ""10101""));

That'll be wonderful when I rename any properties! I've always though hard coded strings in code is bad, especially when the strings relate to property names.

Is there any way I can strongly type these restrictions? I had a look at [this][1] blog post, but it seems quite messy, is there a nicer solution?


  [1]: http://jeffhandley.com/archive/2010/04/10/memberof.aspx?utm_source=feedburner&utm_medium=feed&utm_campaign=Feed%3A+JeffHandley+%28Jeff+Handley%29",nhibernate,fluent-nhibernate,c#4.0,strong-typing,,,open,0,138,11,"How do I strongly type criteria when using NHibernate's CreateCriteria method? I'm currently using NHibernate, for the first time, with Fluent NHibernate. I've gotten everything setup nicely, however now I've come to actual doing some data retrieval, it seems to have fallen short.

I was expecting NHibernate, to allow me to do something like:

    session.CreateCriteria<TblDocket>()
        .Add(Restrictions.Eq(x=> x.DocketNumber, ""10101""));

However, this doesn't appear to be the case and I seem to have to write:

    session.CreateCriteria<TblDocket>()
        .Add(Restrictions.Eq(""DocketNumber"", ""10101""));

That'll be wonderful when I rename any properties! I've always though hard coded strings in code is bad, especially when the strings relate to property names.

Is there any way I can strongly type these restrictions? I had a look at [this][1] blog post, but it seems quite messy, is there a nicer solution?


  [1]: http://jeffhandley.com/archive/2010/04/10/memberof.aspx?utm_source=feedburner&utm_medium=feed&utm_campaign=Feed%3A+JeffHandley+%28Jeff+Handley%29",4
815854,05/02/2009 23:07:05,84274,03/29/2009 14:27:00,6,1,Can NHibernate create tables from existing classes automatically?,"I'm very new at this, but I need to create new tables from existing classes without creating them by hand. Can this be done using a tool or command line?",nhibernate,c#,,,,,open,0,30,8,"Can NHibernate create tables from existing classes automatically? I'm very new at this, but I need to create new tables from existing classes without creating them by hand. Can this be done using a tool or command line?",2
11533587,07/18/2012 02:42:58,1533434,07/18/2012 02:38:35,1,0,Join table twice with NHibernate,"I have 2 tables:
Account: AccountID, Name
Message: FromAccountID, ToAccountID, Contents

How do i join two tables to get name of the sender and receiver with Nhibernate",nhibernate,join,criteria,,,07/20/2012 19:55:48,not a real question,1,24,5,"Join table twice with NHibernate I have 2 tables:
Account: AccountID, Name
Message: FromAccountID, ToAccountID, Contents

How do i join two tables to get name of the sender and receiver with Nhibernate",3
1230256,08/04/2009 22:37:07,67653,02/18/2009 00:45:06,598,32,Does NHibernate support mapping an abstract class to disparate tables using composite ids?,"I have a complex, 3NF database being provided to me for a particular project.  I would like to avoid using a class-per-table domain design.  Rather, I would like to model my domain objects after how they are used from a conceptual business perspective.

The rub is how to properly persist this information.  I know I can go the ADO route, but I'd like to take a stab at using NHibernate, having used it successfully on other projects with more flexible data stores.

So, I need to know if NHibernate will support the following scenario:

I have a conceptual object known as a ProjectStatus, which is comprised of a handful of date stamps for various activities along with some notes about the status.  All of the data that comprises the ProjectStatus comes from 2 or more tables.  There is no ProjectStatus table.

I know I can do a union-subclass in my NH mapping to get this to work, but...

One of the tables that holds the bulk of the information I need has a composite id (two PK fields that together make up the identity signature).  I know NH supports composite ids as well, but how would I go about mapping my the union on the composite key?  Do I need to specify a composite key underneath the union-subclass section?

The dba has refused to budge on her near-neurotic 3NF data model, so I'm stuck on that front.  If I have to drop to ADO for ease/speed of development, so be it, but I'm hoping NH will rise above...

",nhibernate,domain-driven-design,orm,,,,open,0,260,13,"Does NHibernate support mapping an abstract class to disparate tables using composite ids? I have a complex, 3NF database being provided to me for a particular project.  I would like to avoid using a class-per-table domain design.  Rather, I would like to model my domain objects after how they are used from a conceptual business perspective.

The rub is how to properly persist this information.  I know I can go the ADO route, but I'd like to take a stab at using NHibernate, having used it successfully on other projects with more flexible data stores.

So, I need to know if NHibernate will support the following scenario:

I have a conceptual object known as a ProjectStatus, which is comprised of a handful of date stamps for various activities along with some notes about the status.  All of the data that comprises the ProjectStatus comes from 2 or more tables.  There is no ProjectStatus table.

I know I can do a union-subclass in my NH mapping to get this to work, but...

One of the tables that holds the bulk of the information I need has a composite id (two PK fields that together make up the identity signature).  I know NH supports composite ids as well, but how would I go about mapping my the union on the composite key?  Do I need to specify a composite key underneath the union-subclass section?

The dba has refused to budge on her near-neurotic 3NF data model, so I'm stuck on that front.  If I have to drop to ADO for ease/speed of development, so be it, but I'm hoping NH will rise above...

",3
4096780,11/04/2010 12:47:24,306894,04/01/2010 13:06:21,391,38,is nhibernate 3.0 ready for production,"I was just looking on nhforge and saw the most recent release of nhibernate 3.0 is the alpha 1 release.  Is that the most recent available binaries, or did I miss them?

Also, is nhiberante 3.0 solid enough to use in a production environment.  Is anyone currently using 3.0 for development?

I am beginning to develop a new project and was wondering if I should stick to 2.12 or if it safe to move onto 3.0.

Thank for any thoughts.",nhibernate,,,,,,open,0,79,6,"is nhibernate 3.0 ready for production I was just looking on nhforge and saw the most recent release of nhibernate 3.0 is the alpha 1 release.  Is that the most recent available binaries, or did I miss them?

Also, is nhiberante 3.0 solid enough to use in a production environment.  Is anyone currently using 3.0 for development?

I am beginning to develop a new project and was wondering if I should stick to 2.12 or if it safe to move onto 3.0.

Thank for any thoughts.",1
1833879,12/02/2009 16:02:38,5744,09/11/2008 08:15:22,3887,118,Advanced search with distances using NHibernate and SQL Server Geography,"I've got an existing advanced search method in a repository that checks a `FormCollection` for the existence of search criteria, and if present, adds a criterion to the search e.g.

    public IList<Residence> GetForAdvancedSearch(FormCollection collection)
    {
      var criteria = Session.CreateCriteria(typeof(Residence))
        .SetResultTransformer(new DistinctRootEntityResultTransformer());

      if (collection[""MinBedrooms""] != null)
      {
        criteria
          .Add(Restrictions.Ge(""Bedrooms"", int.Parse(collection[""MinBedrooms""])));
      }
  
      // ... many criteria omitted for brevity

      return criteria.List<Residence>();
    }

I've also got a basic distance search to find how far each residence is from the search criteria. The HBM for the query is 

    <sql-query name=""Residence .Nearest"">
      <return alias=""residence"" class=""Residences.Domain.Residence, Residences""/>
      <return-scalar column=""Distance"" type=""float""/>
      SELECT R.*, dbo.GetDistance(:point, R.Coordinate) AS Distance
      FROM Residence R
      WHERE Distance < 10
      ORDER BY Distance
    </sql-query>

I had to define a function to calculate the distance, as there was no way to get NHibernate to escape the colons in the geography function:

 CREATE FUNCTION dbo.GetDistance
 (
  @firstPoint nvarchar(100), 
  @secondPoint GEOMETRY
 )
 RETURNS float
 AS
 BEGIN
  RETURN GEOGRAPHY::STGeomFromText(
  @firstPoint, 4326).STDistance(@secondPoint.STAsText()) / 1609.344
 END

And the repository calls the named query thus:

    return Session.GetNamedQuery(""Walk.Nearest"")
 .SetString(""point"", String.Format(""POINT({0} {1})"", latitude, longitude))
 .List();

So my question is; how do I combine the two (or start from scratch), so I can filter the advanced search results to include only residences within 10 miles of the search location? ",nhibernate,geography,sql-server-2008,,,,open,0,312,10,"Advanced search with distances using NHibernate and SQL Server Geography I've got an existing advanced search method in a repository that checks a `FormCollection` for the existence of search criteria, and if present, adds a criterion to the search e.g.

    public IList<Residence> GetForAdvancedSearch(FormCollection collection)
    {
      var criteria = Session.CreateCriteria(typeof(Residence))
        .SetResultTransformer(new DistinctRootEntityResultTransformer());

      if (collection[""MinBedrooms""] != null)
      {
        criteria
          .Add(Restrictions.Ge(""Bedrooms"", int.Parse(collection[""MinBedrooms""])));
      }
  
      // ... many criteria omitted for brevity

      return criteria.List<Residence>();
    }

I've also got a basic distance search to find how far each residence is from the search criteria. The HBM for the query is 

    <sql-query name=""Residence .Nearest"">
      <return alias=""residence"" class=""Residences.Domain.Residence, Residences""/>
      <return-scalar column=""Distance"" type=""float""/>
      SELECT R.*, dbo.GetDistance(:point, R.Coordinate) AS Distance
      FROM Residence R
      WHERE Distance < 10
      ORDER BY Distance
    </sql-query>

I had to define a function to calculate the distance, as there was no way to get NHibernate to escape the colons in the geography function:

 CREATE FUNCTION dbo.GetDistance
 (
  @firstPoint nvarchar(100), 
  @secondPoint GEOMETRY
 )
 RETURNS float
 AS
 BEGIN
  RETURN GEOGRAPHY::STGeomFromText(
  @firstPoint, 4326).STDistance(@secondPoint.STAsText()) / 1609.344
 END

And the repository calls the named query thus:

    return Session.GetNamedQuery(""Walk.Nearest"")
 .SetString(""point"", String.Format(""POINT({0} {1})"", latitude, longitude))
 .List();

So my question is; how do I combine the two (or start from scratch), so I can filter the advanced search results to include only residences within 10 miles of the search location? ",3
6181491,05/30/2011 23:07:41,44973,12/10/2008 12:48:50,948,7,NHibernate Fluent Mapping,"Can you complete the missing entity mapping below... 

    [User Entity]
    User [int Id, string Name, string Surname, Book Books]

    [User Map]
    Table(""[Candidate]"");
    Id(x => x.Id);
    Map(x => x.Name);
    Map(x => x.Surname);


    ----------


    [Book Entity]
    Book [int Id, string Name, DateTime PublishedDate]

    [Book Map]


    ----------


    [UserBooks Entity]
    UserBooks [int Id, int UserId, int BookId]

    [UserBooks Map]


    ----------


",nhibernate,fluent-nhibernate,relational-database,fluent,,05/31/2011 14:19:58,not a real question,1,105,3,"NHibernate Fluent Mapping Can you complete the missing entity mapping below... 

    [User Entity]
    User [int Id, string Name, string Surname, Book Books]

    [User Map]
    Table(""[Candidate]"");
    Id(x => x.Id);
    Map(x => x.Name);
    Map(x => x.Surname);


    ----------


    [Book Entity]
    Book [int Id, string Name, DateTime PublishedDate]

    [Book Map]


    ----------


    [UserBooks Entity]
    UserBooks [int Id, int UserId, int BookId]

    [UserBooks Map]


    ----------


",4
6407566,06/20/2011 06:28:30,578059,01/17/2011 04:37:39,15,2,Configure Memcache with Castle ActiveRecord?,Anyone know how to configure an ActiveRecord/nhibernate application to use Memcache as the 2nd level cache?,nhibernate,castle-activerecord,,,,,open,0,16,5,Configure Memcache with Castle ActiveRecord? Anyone know how to configure an ActiveRecord/nhibernate application to use Memcache as the 2nd level cache?,2
8267915,11/25/2011 10:44:47,762321,05/20/2011 07:44:16,18,0,NHibernate narrowing proxy warning,"We are building an ASP.NET MVC application utilizing NH for data access. Using NH Profiler I see a lot of warnings like ""WARN: Narrowing proxy to Domain.CaseTask - this operation breaks =="". I get these very often when executing queries for classes which are mapped in a table per subclass, for example, using the NH Linq provider:

    Query<ICaseTask>().Where(c => c.Assignee == Of || c.Operator == Of)

where the class CaseTask inherits from Task, triggers the warning.

Information about the warning in the internet is scarce and mostly hints that this is something to be ignored... What does this warning warn about exactly? Should this be something I should seek to correct?

",nhibernate,,,,,,open,0,112,4,"NHibernate narrowing proxy warning We are building an ASP.NET MVC application utilizing NH for data access. Using NH Profiler I see a lot of warnings like ""WARN: Narrowing proxy to Domain.CaseTask - this operation breaks =="". I get these very often when executing queries for classes which are mapped in a table per subclass, for example, using the NH Linq provider:

    Query<ICaseTask>().Where(c => c.Assignee == Of || c.Operator == Of)

where the class CaseTask inherits from Task, triggers the warning.

Information about the warning in the internet is scarce and mostly hints that this is something to be ignored... What does this warning warn about exactly? Should this be something I should seek to correct?

",1
7123692,08/19/2011 15:14:21,230,08/03/2008 19:32:46,5959,62,Inserting parent and children with NHibernate at the same time,"I am attempting to save(insert) a Parent entity with list Child entities. Both entites use a Guid as primary keys. The keys are none nullable and there is no key relationship set up in the db.

The save doesn't work, an exception is thrown claiming - that I am trying to save a null into Parent foreign key in the Child table. When I debug the `session.Save` call the Child entites dont have there Parent property populated. 

I was expecting nhibernate to create a key for the Parent and let its Child objects know about it. Is this a limitation of NHibernate or of using Guids as primary keys?

This [answer][1] suggests you have to set the parent manully, is this really the only way?

Here are my mappings for reference:

Parent mapping:
  

    HasMany(x => x.Children).KeyColumn(""ParentKey"").Inverse().Cascade.All();

Child mapping:

     References(x => x.Parent).Not.Nullable().Column(""ParentKey"");






  [1]: http://stackoverflow.com/questions/721363/nhibernate-persist-an-object-with-children",nhibernate,fluent-nhibernate,,,,,open,0,148,10,"Inserting parent and children with NHibernate at the same time I am attempting to save(insert) a Parent entity with list Child entities. Both entites use a Guid as primary keys. The keys are none nullable and there is no key relationship set up in the db.

The save doesn't work, an exception is thrown claiming - that I am trying to save a null into Parent foreign key in the Child table. When I debug the `session.Save` call the Child entites dont have there Parent property populated. 

I was expecting nhibernate to create a key for the Parent and let its Child objects know about it. Is this a limitation of NHibernate or of using Guids as primary keys?

This [answer][1] suggests you have to set the parent manully, is this really the only way?

Here are my mappings for reference:

Parent mapping:
  

    HasMany(x => x.Children).KeyColumn(""ParentKey"").Inverse().Cascade.All();

Child mapping:

     References(x => x.Parent).Not.Nullable().Column(""ParentKey"");






  [1]: http://stackoverflow.com/questions/721363/nhibernate-persist-an-object-with-children",2
4038601,10/27/2010 23:43:50,296923,05/10/2009 18:19:21,475,29,"NHibernate, ORM : how is refactoring handled? existing data?","When using an ORM (specifically NHibernate), how is refactoring of data handled? I mean, if data objects change such that the underlying relational DB schema changes, does the ORM offer any help in schema upgrades / downgrades in the DB? How about migration of existing data to the new schema?

I am in the process of making a decision on using an ORM and have very limited exposure. Please bear with me if the questions are naive.",nhibernate,orm,,,,,open,0,76,9,"NHibernate, ORM : how is refactoring handled? existing data? When using an ORM (specifically NHibernate), how is refactoring of data handled? I mean, if data objects change such that the underlying relational DB schema changes, does the ORM offer any help in schema upgrades / downgrades in the DB? How about migration of existing data to the new schema?

I am in the process of making a decision on using an ORM and have very limited exposure. Please bear with me if the questions are naive.",2
584214,02/25/2009 00:04:56,17510,09/18/2008 10:26:18,165,7,NHibenate cascade problem.,"Hi I'm having a problem updating child objects in the following scenario.

The mapping are as follows:

Parent: Calendar

      <bag name=""defaultCategories""  inverse=""true"" lazy=""false"" 
        cascade=""all-delete-orphan"">
      <key column=""parentID"" />
      <one-to-many class=""DefaultCategory""/>
      </bag>

Child: DefaultCatergory
   
    <class name=""DefaultCategory"" table=""tb_calendar_default_category"" lazy=""false"">

    <id name=""id"" column=""id"">
      <generator class=""hilo""/>
    </id>

    <many-to-one name=""calendar"" column=""parentID"" not-null=""true"" 
     cascade=""all-delete-orphan"" />

Code used to update calendar:

    public Calendar Update(Calendar vo)
        {
            session = NHibernateHelper.GetCurrentSession();

            tx = session.BeginTransaction();
            using (tx)
            {

                session.Update(vo);

                tx.Commit();
            }

            return vo;
        }

The problem is that when I add or delete defaultCategories via the ui and send back the updated version of the calendar to the back end, NHibernate returns the updated calendar and all seems well. However any defaultCatergories which should have been deleted are left in the default Categories table. Thus when I call for the calendar again, I can see collection has not changed.

Do you think I need to delete all defaultCatergories by parentID and then recreate?
I was under the impression NHibernate took care of this for you?
Any help or pointers much appreciated.
",nhibernate,hibernate,nhibernate-mapping,,,,open,0,329,3,"NHibenate cascade problem. Hi I'm having a problem updating child objects in the following scenario.

The mapping are as follows:

Parent: Calendar

      <bag name=""defaultCategories""  inverse=""true"" lazy=""false"" 
        cascade=""all-delete-orphan"">
      <key column=""parentID"" />
      <one-to-many class=""DefaultCategory""/>
      </bag>

Child: DefaultCatergory
   
    <class name=""DefaultCategory"" table=""tb_calendar_default_category"" lazy=""false"">

    <id name=""id"" column=""id"">
      <generator class=""hilo""/>
    </id>

    <many-to-one name=""calendar"" column=""parentID"" not-null=""true"" 
     cascade=""all-delete-orphan"" />

Code used to update calendar:

    public Calendar Update(Calendar vo)
        {
            session = NHibernateHelper.GetCurrentSession();

            tx = session.BeginTransaction();
            using (tx)
            {

                session.Update(vo);

                tx.Commit();
            }

            return vo;
        }

The problem is that when I add or delete defaultCategories via the ui and send back the updated version of the calendar to the back end, NHibernate returns the updated calendar and all seems well. However any defaultCatergories which should have been deleted are left in the default Categories table. Thus when I call for the calendar again, I can see collection has not changed.

Do you think I need to delete all defaultCatergories by parentID and then recreate?
I was under the impression NHibernate took care of this for you?
Any help or pointers much appreciated.
",3
6269549,06/07/2011 17:55:03,197803,10/28/2009 03:49:56,23,0,Indexed views & Nhibernate - NOEXPAND Hint?,Is it possible to configure NHibernate to issue the NOEXPAND hint when it executes a select statement against an indexed view?  SQL Server always skips the views and goes straight to the base tables when executing queries unless the hint is used.,nhibernate,,,,,,open,0,43,7,Indexed views & Nhibernate - NOEXPAND Hint? Is it possible to configure NHibernate to issue the NOEXPAND hint when it executes a select statement against an indexed view?  SQL Server always skips the views and goes straight to the base tables when executing queries unless the hint is used.,1
7638766,10/03/2011 17:56:39,886031,08/09/2011 13:31:42,81,3,NHibernate list saving and loading optimization advice,"I have 3 classes that are mapped via NHibernate: Intersection, Vehicle and Zone.

My Intersection class contains a list of Zones that belong to the Intersection.  My Vehicle class contains a list of Zones that the Vehicle contains. Finally my Zone class contains a list of Vehicles that contain the Zone.

My test performance set consists of 10,000 Vehicles and 500 Zones and 250 Intersections.  My load time with the Zones and Vehicles both having the lists mapped is right around 27 minutes for all these objects.

I am not sure what is going on but these two lists are not optimized in the least.  There is a 10 minute difference in saving the objects if I take the Vehicle list out of the Zone class mapping.  This seems a bit off seeing as how the 2 lists are directly related to each other.  

It appears NHibernate is recursively saving the items within both the lists and adding a bunch of overhead to the saving procedure.  Is there any way to optimize these lists for faster time saving the objects?

Here are my mappings for Device which both my Intersection and Vehicle inherit from:

	<hibernate-mapping xmlns=""urn:nhibernate-mapping-2.2"">
	  <class xmlns=""urn:nhibernate-mapping-2.2"" name=""EMTRAC.Devices.Device, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"" table=""`Device`"" lazy=""false"">
		<id name=""PK"" type=""System.Int64, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
		  <column name=""PK"" />
		  <generator class=""identity"" />
		</id>
		<many-to-one class=""EMTRAC.Connections.Connection, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"" name=""LocalConnection"" lazy=""false"" cascade=""all"">
		  <column name=""LocalConnection_id"" />
		</many-to-one>
		<many-to-one class=""EMTRAC.Connections.Connection, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"" name=""Connection"" lazy=""false"" cascade=""all"">
		  <column name=""Connection_id"" />
		</many-to-one>
		<many-to-one class=""EMTRAC.Packets.Packet, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"" name=""Configuration"" cascade=""all"">
		  <column name=""Configuration_id"" />
		</many-to-one>
		<joined-subclass name=""EMTRAC.Intersections.Intersection, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"" lazy=""false"">
		  <key>
			<column name=""Device_id"" />
		  </key>
		  <component name=""Zones"" access=""property"">
			<bag name=""_list"" cascade=""all-delete-orphan"" access=""field"" fetch=""join"">
			  <key>
				<column name=""Zone_PK"" />
			  </key> 
			  <many-to-many class=""EMTRAC.Zones.Zone, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null""/>
			</bag>
		  </component>
		  <property name=""ID"" type=""System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			<column name=""ID"" />
		  </property>
		  <component name=""Streets"" class=""EMTRAC.Intersections.Streets, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"">
			<property name=""Route"" type=""System.String, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			  <column name=""Route"" />
			</property>
			<property name=""Crossing"" type=""System.String, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			  <column name=""Crossing"" />
			</property>
		  </component>
		  <component name=""Position"" class=""EMTRAC.Positions.Position, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"">
			<component name=""LatLon"" class=""EMTRAC.LatLon.LatLon, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"">
			  <property name=""Lat"" type=""System.Double, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
				<column name=""Lat"" />
			  </property>
			  <property name=""Lon"" type=""System.Double, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
				<column name=""Lon"" />
			  </property>
			</component>
		  </component>
		</joined-subclass>
		<joined-subclass name=""EMTRAC.Vehicles.Vehicle, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"">
		  <key>
			<column name=""Device_id"" />
		  </key>
		  <component name=""Zones"" access=""property"">
			<bag name=""_list"" cascade=""all-delete-orphan"" access=""field"" table=""VehicleZones"" inverse=""false"">
			  <key>
				<column name=""Device_id"" />
			  </key>
			  <many-to-many class=""EMTRAC.Zones.Zone, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null""/>
			</bag>
		  </component>
		  <property name=""ID"" type=""System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			<column name=""ID"" />
		  </property>
		  <property name=""Active"" type=""System.Boolean, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			<column name=""Active"" />
		  </property>
		  <property name=""Status"" type=""System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			<column name=""Status"" />
		  </property>
		  <property name=""Velocity"" type=""System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			<column name=""Velocity"" />
		  </property>
		  <property name=""Heading"" type=""System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			<column name=""Heading"" />
		  </property>
		  <property name=""Agency"" type=""System.String, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			<column name=""Agency"" />
		  </property>
		  <property name=""Unit"" type=""System.String, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			<column name=""Unit"" />
		  </property>
		  <property name=""Priority"" type=""System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			<column name=""Priority"" />
		  </property>
		  <component name=""Position"" class=""EMTRAC.Positions.Position, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"">
			<component name=""LatLon"" class=""EMTRAC.LatLon.LatLon, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"">
			  <property name=""Lat"" type=""System.Double, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
				<column name=""Lat"" />
			  </property>
			  <property name=""Lon"" type=""System.Double, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
				<column name=""Lon"" />
			  </property>
			</component>
		  </component>
		  <many-to-one class=""EMTRAC.VehicleClasses.VehicleClass, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"" name=""VehClass"" lazy=""false"" cascade=""all"">
			<column name=""VehClass_id"" />
		  </many-to-one>      
		</joined-subclass>
	  </class>
	</hibernate-mapping>

And finally here is my mapping for the Zone class:

	<hibernate-mapping xmlns=""urn:nhibernate-mapping-2.2"">
	  <class xmlns=""urn:nhibernate-mapping-2.2"" name=""EMTRAC.Zones.Zone, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"" table=""`Zone`"" lazy=""false"">
		<id name=""ID"" type=""System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
		  <column name=""PK"" />
		  <generator class=""identity"" />
		</id>
		<property name=""ID"" type=""System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
		  <column name=""ID"" />
		</property>
		<property name=""Active"" type=""System.Boolean, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
		  <column name=""Active"" />
		</property>
		<property name=""Dir"" type=""System.String, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
		  <column name=""Dir"" />
		</property>
		<property name=""IntID"" type=""System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
		  <column name=""IntID"" />
		</property>
		<property name=""Width"" type=""System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
		  <column name=""Width"" />
		</property>
		<property name=""Distance"" type=""System.Double, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
		  <column name=""Distance"" />
		</property>
		<component name=""Heading"" class=""EMTRAC.Headings.Heading, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"">
		  <property name=""CW"" type=""System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			<column name=""CW"" />
		  </property>
		  <property name=""CCW"" type=""System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			<column name=""CCW"" />
		  </property>
		</component>
		<component name=""Start"" class=""EMTRAC.Positions.Position, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"">
		  <component name=""LatLon"" class=""EMTRAC.LatLon.LatLon, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"">
			<property name=""Lat"" type=""System.Double, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			  <column name=""LatStart"" />
			</property>
			<property name=""Lon"" type=""System.Double, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			  <column name=""LonStart"" />
			</property>
		  </component>
		</component>
		<component name=""Finish"" class=""EMTRAC.Positions.Position, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"">
		  <component name=""LatLon"" class=""EMTRAC.LatLon.LatLon, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"">
			<property name=""Lat"" type=""System.Double, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			  <column name=""LatFinish"" />
			</property>
			<property name=""Lon"" type=""System.Double, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			  <column name=""LonFinish"" />
			</property>
		  </component>
		</component>
		<component name=""Vehicles"" access=""property"">
		  <bag name=""_list"" cascade=""all-delete-orphan"" access=""field"" table=""ZoneVehicles"">
			<key>
			  <column name=""Device_id"" />
			</key>
			<many-to-many class=""EMTRAC.Vehicles.Vehicle, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null""/>
		  </bag>
		</component>
	  </class>
	</hibernate-mapping>

Any ideas how to improve the efficiency of these lists?",nhibernate,nhibernate-mapping,,,,,open,0,793,7,"NHibernate list saving and loading optimization advice I have 3 classes that are mapped via NHibernate: Intersection, Vehicle and Zone.

My Intersection class contains a list of Zones that belong to the Intersection.  My Vehicle class contains a list of Zones that the Vehicle contains. Finally my Zone class contains a list of Vehicles that contain the Zone.

My test performance set consists of 10,000 Vehicles and 500 Zones and 250 Intersections.  My load time with the Zones and Vehicles both having the lists mapped is right around 27 minutes for all these objects.

I am not sure what is going on but these two lists are not optimized in the least.  There is a 10 minute difference in saving the objects if I take the Vehicle list out of the Zone class mapping.  This seems a bit off seeing as how the 2 lists are directly related to each other.  

It appears NHibernate is recursively saving the items within both the lists and adding a bunch of overhead to the saving procedure.  Is there any way to optimize these lists for faster time saving the objects?

Here are my mappings for Device which both my Intersection and Vehicle inherit from:

	<hibernate-mapping xmlns=""urn:nhibernate-mapping-2.2"">
	  <class xmlns=""urn:nhibernate-mapping-2.2"" name=""EMTRAC.Devices.Device, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"" table=""`Device`"" lazy=""false"">
		<id name=""PK"" type=""System.Int64, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
		  <column name=""PK"" />
		  <generator class=""identity"" />
		</id>
		<many-to-one class=""EMTRAC.Connections.Connection, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"" name=""LocalConnection"" lazy=""false"" cascade=""all"">
		  <column name=""LocalConnection_id"" />
		</many-to-one>
		<many-to-one class=""EMTRAC.Connections.Connection, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"" name=""Connection"" lazy=""false"" cascade=""all"">
		  <column name=""Connection_id"" />
		</many-to-one>
		<many-to-one class=""EMTRAC.Packets.Packet, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"" name=""Configuration"" cascade=""all"">
		  <column name=""Configuration_id"" />
		</many-to-one>
		<joined-subclass name=""EMTRAC.Intersections.Intersection, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"" lazy=""false"">
		  <key>
			<column name=""Device_id"" />
		  </key>
		  <component name=""Zones"" access=""property"">
			<bag name=""_list"" cascade=""all-delete-orphan"" access=""field"" fetch=""join"">
			  <key>
				<column name=""Zone_PK"" />
			  </key> 
			  <many-to-many class=""EMTRAC.Zones.Zone, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null""/>
			</bag>
		  </component>
		  <property name=""ID"" type=""System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			<column name=""ID"" />
		  </property>
		  <component name=""Streets"" class=""EMTRAC.Intersections.Streets, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"">
			<property name=""Route"" type=""System.String, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			  <column name=""Route"" />
			</property>
			<property name=""Crossing"" type=""System.String, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			  <column name=""Crossing"" />
			</property>
		  </component>
		  <component name=""Position"" class=""EMTRAC.Positions.Position, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"">
			<component name=""LatLon"" class=""EMTRAC.LatLon.LatLon, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"">
			  <property name=""Lat"" type=""System.Double, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
				<column name=""Lat"" />
			  </property>
			  <property name=""Lon"" type=""System.Double, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
				<column name=""Lon"" />
			  </property>
			</component>
		  </component>
		</joined-subclass>
		<joined-subclass name=""EMTRAC.Vehicles.Vehicle, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"">
		  <key>
			<column name=""Device_id"" />
		  </key>
		  <component name=""Zones"" access=""property"">
			<bag name=""_list"" cascade=""all-delete-orphan"" access=""field"" table=""VehicleZones"" inverse=""false"">
			  <key>
				<column name=""Device_id"" />
			  </key>
			  <many-to-many class=""EMTRAC.Zones.Zone, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null""/>
			</bag>
		  </component>
		  <property name=""ID"" type=""System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			<column name=""ID"" />
		  </property>
		  <property name=""Active"" type=""System.Boolean, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			<column name=""Active"" />
		  </property>
		  <property name=""Status"" type=""System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			<column name=""Status"" />
		  </property>
		  <property name=""Velocity"" type=""System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			<column name=""Velocity"" />
		  </property>
		  <property name=""Heading"" type=""System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			<column name=""Heading"" />
		  </property>
		  <property name=""Agency"" type=""System.String, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			<column name=""Agency"" />
		  </property>
		  <property name=""Unit"" type=""System.String, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			<column name=""Unit"" />
		  </property>
		  <property name=""Priority"" type=""System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			<column name=""Priority"" />
		  </property>
		  <component name=""Position"" class=""EMTRAC.Positions.Position, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"">
			<component name=""LatLon"" class=""EMTRAC.LatLon.LatLon, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"">
			  <property name=""Lat"" type=""System.Double, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
				<column name=""Lat"" />
			  </property>
			  <property name=""Lon"" type=""System.Double, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
				<column name=""Lon"" />
			  </property>
			</component>
		  </component>
		  <many-to-one class=""EMTRAC.VehicleClasses.VehicleClass, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"" name=""VehClass"" lazy=""false"" cascade=""all"">
			<column name=""VehClass_id"" />
		  </many-to-one>      
		</joined-subclass>
	  </class>
	</hibernate-mapping>

And finally here is my mapping for the Zone class:

	<hibernate-mapping xmlns=""urn:nhibernate-mapping-2.2"">
	  <class xmlns=""urn:nhibernate-mapping-2.2"" name=""EMTRAC.Zones.Zone, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"" table=""`Zone`"" lazy=""false"">
		<id name=""ID"" type=""System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
		  <column name=""PK"" />
		  <generator class=""identity"" />
		</id>
		<property name=""ID"" type=""System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
		  <column name=""ID"" />
		</property>
		<property name=""Active"" type=""System.Boolean, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
		  <column name=""Active"" />
		</property>
		<property name=""Dir"" type=""System.String, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
		  <column name=""Dir"" />
		</property>
		<property name=""IntID"" type=""System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
		  <column name=""IntID"" />
		</property>
		<property name=""Width"" type=""System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
		  <column name=""Width"" />
		</property>
		<property name=""Distance"" type=""System.Double, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
		  <column name=""Distance"" />
		</property>
		<component name=""Heading"" class=""EMTRAC.Headings.Heading, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"">
		  <property name=""CW"" type=""System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			<column name=""CW"" />
		  </property>
		  <property name=""CCW"" type=""System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			<column name=""CCW"" />
		  </property>
		</component>
		<component name=""Start"" class=""EMTRAC.Positions.Position, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"">
		  <component name=""LatLon"" class=""EMTRAC.LatLon.LatLon, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"">
			<property name=""Lat"" type=""System.Double, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			  <column name=""LatStart"" />
			</property>
			<property name=""Lon"" type=""System.Double, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			  <column name=""LonStart"" />
			</property>
		  </component>
		</component>
		<component name=""Finish"" class=""EMTRAC.Positions.Position, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"">
		  <component name=""LatLon"" class=""EMTRAC.LatLon.LatLon, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"">
			<property name=""Lat"" type=""System.Double, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			  <column name=""LatFinish"" />
			</property>
			<property name=""Lon"" type=""System.Double, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"">
			  <column name=""LonFinish"" />
			</property>
		  </component>
		</component>
		<component name=""Vehicles"" access=""property"">
		  <bag name=""_list"" cascade=""all-delete-orphan"" access=""field"" table=""ZoneVehicles"">
			<key>
			  <column name=""Device_id"" />
			</key>
			<many-to-many class=""EMTRAC.Vehicles.Vehicle, EMTRAC_v3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null""/>
		  </bag>
		</component>
	  </class>
	</hibernate-mapping>

Any ideas how to improve the efficiency of these lists?",2
1018897,06/19/2009 16:35:26,82657,03/25/2009 15:49:31,156,6,Select multiple entities in Criteria Query,"In NHibernate HQL you can select multiple entities for a given query like this example.

    var query = session.CreateQuery(""select c,k from Cat as c join c.Kittens as k"");

Obviously the real world situation has more complexity but that is the basics.  Is there a way to do this in a Criteria query?
",nhibernate,c#,,,,,open,0,55,6,"Select multiple entities in Criteria Query In NHibernate HQL you can select multiple entities for a given query like this example.

    var query = session.CreateQuery(""select c,k from Cat as c join c.Kittens as k"");

Obviously the real world situation has more complexity but that is the basics.  Is there a way to do this in a Criteria query?
",2
2395998,03/07/2010 11:02:25,178980,09/25/2009 09:56:59,539,30,nHibernate: limit the result set of a mapped collection,"How do you limit the result set of a mapped collection in nHibernate? For instance:

    Model.Items;

will always return all the Items for the given Model. Is there any way to force it to return only, say, 20 Items **without creating a specific query** ? Something like

    Model.Items.SetMaxResults(20);",nhibernate,,,,,,open,0,53,9,"nHibernate: limit the result set of a mapped collection How do you limit the result set of a mapped collection in nHibernate? For instance:

    Model.Items;

will always return all the Items for the given Model. Is there any way to force it to return only, say, 20 Items **without creating a specific query** ? Something like

    Model.Items.SetMaxResults(20);",1
2572498,04/03/2010 20:02:38,62006,02/02/2009 11:30:52,316,14,Lazy property loading in Nhibernate and Spring,"I'm using NHibernate 2.1.2 and Spring 1.3

I have two Text columns (blobs) in one of my classes. I'm trying to use lazy=""true"" for the mapping of those properties but NHProfiler still shows the two columns being added to the SELECT statement when the main object is loaded.

I'm using Spring.NHibernate session factory and have configured ProxyFactory with both Castle and Spring with no luck.
",nhibernate,spring.net,,,,,open,0,63,7,"Lazy property loading in Nhibernate and Spring I'm using NHibernate 2.1.2 and Spring 1.3

I have two Text columns (blobs) in one of my classes. I'm trying to use lazy=""true"" for the mapping of those properties but NHProfiler still shows the two columns being added to the SELECT statement when the main object is loaded.

I'm using Spring.NHibernate session factory and have configured ProxyFactory with both Castle and Spring with no luck.
",2
3040930,06/14/2010 21:05:47,358089,06/04/2010 03:14:22,8,0,NHibernate ManyToMany Relationship Cascading,"I have two objects that have a ManyToMany relationship with one another through a mapping table. Though, when I try to save it, I get a stack overflow exception. The following is the code for the mappings:

    //EventMapping.cs
    HasManyToMany(x => x.Performers).Table(""EventPerformer"").Inverse().Cascade.AllDeleteOrphan().LazyLoad().ParentKeyColumn(""EventId"").ChildKeyColumn(""PerformerId"");


    //PerformerMapping.cs
    HasManyToMany<Event>(x => x.Events).Table(""EventPerformer"").Inverse().Cascade.AllDeleteOrphan().LazyLoad().ParentKeyColumn(""PerformerId"").ChildKeyColumn(""EventId"");

When I change the performermapping.cs to Cascade.None() I get rid of the exception but then my Event Object doesn't have the performer I associate with it.

    //In a unit test, paraphrased
    event.Performers.Add(performer); //Event
    eventRepository.Save<Event>(event);
    eventResult = eventRepository.GetById<Event>(event.id); //Event
    eventResult.Performers[0]; //is null, should have performer in it

How should I be writing this properly?
Thanks
",nhibernate,cascade,many-to-many,nhibernate-cascade,,,open,0,123,4,"NHibernate ManyToMany Relationship Cascading I have two objects that have a ManyToMany relationship with one another through a mapping table. Though, when I try to save it, I get a stack overflow exception. The following is the code for the mappings:

    //EventMapping.cs
    HasManyToMany(x => x.Performers).Table(""EventPerformer"").Inverse().Cascade.AllDeleteOrphan().LazyLoad().ParentKeyColumn(""EventId"").ChildKeyColumn(""PerformerId"");


    //PerformerMapping.cs
    HasManyToMany<Event>(x => x.Events).Table(""EventPerformer"").Inverse().Cascade.AllDeleteOrphan().LazyLoad().ParentKeyColumn(""PerformerId"").ChildKeyColumn(""EventId"");

When I change the performermapping.cs to Cascade.None() I get rid of the exception but then my Event Object doesn't have the performer I associate with it.

    //In a unit test, paraphrased
    event.Performers.Add(performer); //Event
    eventRepository.Save<Event>(event);
    eventResult = eventRepository.GetById<Event>(event.id); //Event
    eventResult.Performers[0]; //is null, should have performer in it

How should I be writing this properly?
Thanks
",4
3726478,09/16/2010 12:06:22,281180,02/25/2010 12:00:19,432,8,unique in .hbm.xml file not raising exception ,"I am having the following in my .hbm.xml file

    <?xml version=""1.0"" encoding=""utf-8"" ?>
    <hibernate-mapping xmlns=""urn:nhibernate-mapping-2.2""
    									namespace=""Core.Domain.Model""
    									assembly=""Core"">
    
      <class name=""Category"" table=""Categories"" dynamic-update=""true"">
        <cache usage=""read-write""/>
        <id name=""Id"" column=""Id"" type=""Guid"">
          <generator class=""guid""/>
        </id>
        <property name=""Name"" length=""100"">
        <column name=""Name"" unique=""true"" index=""IX_Category""/>
        </property>
      </class>
    </hibernate-mapping>


----------
I am having the following code, however, I can see that no exception is being raised when I am inserting a duplicate value for the Name field. Why is that so? 

     void IRepository<Category>.Save(Category entity)
            {
                using (var scope = new TransactionScope(TransactionScopeOption.Required))
                {
                using (ISession session = NHibernateHelper.OpenSession())
                {
                    using (ITransaction transaction = session.BeginTransaction())
                    {
                        session.Save(entity);
                        transaction.Commit();
                    }
                }
                scope.Complete();
                }    
            }",nhibernate,nhibernate-mapping,,,,,open,0,419,8,"unique in .hbm.xml file not raising exception  I am having the following in my .hbm.xml file

    <?xml version=""1.0"" encoding=""utf-8"" ?>
    <hibernate-mapping xmlns=""urn:nhibernate-mapping-2.2""
    									namespace=""Core.Domain.Model""
    									assembly=""Core"">
    
      <class name=""Category"" table=""Categories"" dynamic-update=""true"">
        <cache usage=""read-write""/>
        <id name=""Id"" column=""Id"" type=""Guid"">
          <generator class=""guid""/>
        </id>
        <property name=""Name"" length=""100"">
        <column name=""Name"" unique=""true"" index=""IX_Category""/>
        </property>
      </class>
    </hibernate-mapping>


----------
I am having the following code, however, I can see that no exception is being raised when I am inserting a duplicate value for the Name field. Why is that so? 

     void IRepository<Category>.Save(Category entity)
            {
                using (var scope = new TransactionScope(TransactionScopeOption.Required))
                {
                using (ISession session = NHibernateHelper.OpenSession())
                {
                    using (ITransaction transaction = session.BeginTransaction())
                    {
                        session.Save(entity);
                        transaction.Commit();
                    }
                }
                scope.Complete();
                }    
            }",2
9444275,02/25/2012 13:08:55,82099,03/24/2009 16:18:12,468,4,Books on NHibernate 3,"Could you please recommend a book on nhibernate? A few years ago I read 'NHibernate in Action'. I wasn't working with nhibernate for a long time, and since then it changed to  3.x version. What books should I read now? What's your opinion on 'Working with NHibernate 3.0'?",nhibernate,,,,,02/27/2012 03:33:08,not constructive,1,49,4,"Books on NHibernate 3 Could you please recommend a book on nhibernate? A few years ago I read 'NHibernate in Action'. I wasn't working with nhibernate for a long time, and since then it changed to  3.x version. What books should I read now? What's your opinion on 'Working with NHibernate 3.0'?",1
739828,04/11/2009 10:25:34,67505,02/17/2009 18:30:08,55,9,should i use NHibernate ?,"i'm building a 3 tier wpf application.
i heard that nhibernate is best for web applications.


should i use it or not??

are there any recommended or mappers that will be more suitable?",nhibernate,fluent-nhibernate,design,,,11/24/2011 22:47:02,not constructive,1,30,5,"should i use NHibernate ? i'm building a 3 tier wpf application.
i heard that nhibernate is best for web applications.


should i use it or not??

are there any recommended or mappers that will be more suitable?",3
2731808,04/28/2010 17:34:32,258,08/04/2008 07:59:04,343,24,How do I return a bit from a stored procedure,"I am using nHibernate in my project but I have a stored procedure which just returns a boolen of success or now.

How do I code this in c#?

I have tried the following but it doesnt like cause I dont have a mapping for bool!!!

> {""No persister for: System.Boolean,
> mscorlib, Version=2.0.0.0,
> Culture=neutral,
> PublicKeyToken=b77a5c561934e089""}

    IQuery query = NHibernateSession.CreateSQLQuery(""EXEC MyDatabase.dbo.[ContentProvider_Import] :ContentProviderImportLogId"", ""success"", typeof(bool))
                    .SetInt32(""ContentProviderImportLogId"", log.Id);
    
                var test = query.UniqueResult<bool>();

and the same result from

    IQuery query = NHibernateSession.CreateSQLQuery(""EXEC MyDatabase.dbo.[ContentProvider_Import] :ContentProviderImportLogId"")
                    .AddEntity(typeof(bool))
                    .SetInt32(""ContentProviderImportLogId"", log.Id);
    
                var test = query.UniqueResult<bool>();",nhibernate,c#,,,,,open,0,184,10,"How do I return a bit from a stored procedure I am using nHibernate in my project but I have a stored procedure which just returns a boolen of success or now.

How do I code this in c#?

I have tried the following but it doesnt like cause I dont have a mapping for bool!!!

> {""No persister for: System.Boolean,
> mscorlib, Version=2.0.0.0,
> Culture=neutral,
> PublicKeyToken=b77a5c561934e089""}

    IQuery query = NHibernateSession.CreateSQLQuery(""EXEC MyDatabase.dbo.[ContentProvider_Import] :ContentProviderImportLogId"", ""success"", typeof(bool))
                    .SetInt32(""ContentProviderImportLogId"", log.Id);
    
                var test = query.UniqueResult<bool>();

and the same result from

    IQuery query = NHibernateSession.CreateSQLQuery(""EXEC MyDatabase.dbo.[ContentProvider_Import] :ContentProviderImportLogId"")
                    .AddEntity(typeof(bool))
                    .SetInt32(""ContentProviderImportLogId"", log.Id);
    
                var test = query.UniqueResult<bool>();",2
6776783,07/21/2011 13:26:33,95245,04/23/2009 23:49:55,2404,117,nhibernate inheritance mapping issue,"In the object model, Party is a base class to a Student, and can have one to many Names.

When I run a test using a Party object that has multiple names, the names are saved and hydrated by NHib, as I would expect.

When I run the a similar test, but with a Student object, NHib persists the names - but they aren't available. Please note I am trying to populate the unmapped StudentName property based on the set of names available in the base class, and NHib is doing an extra select that must be related to it.

Can some explain what is going on with the failing test, given the code below? In particular, why is the set of Party names empty, and what is triggering that last select from the Names table?

Cheers,  
Berryl

MAPPING
======
   <class name=""Party"" table=""Parties"">
    <id name=""Id"">
      <column name=""PartyId"" />
      <generator class=""hilo"" />
    </id>

    <discriminator column=""Type"" not-null=""true"" type=""string"" />

    <set access=""field.camelcase-underscore"" cascade=""all"" inverse=""true"" name=""Names"">
      <key foreign-key=""Party_PartyName_FK"">
        <column name=""PartyNameId"" />
      </key>
      <one-to-many class=""Parties.Domain.Names.PartyName, Parties.Domain"" />
    </set>

    <subclass 
      name=""Student, Core.TestingSupport"" 
      discriminator-value=""Student""
      >
      <property name=""Number"" />

      <many-to-one 
        class=""Course, Core.TestingSupport"" 
        foreign-key=""Course_FK"" 
        name=""Course"">
        <column name=""CourseId"" index=""CourseIndex"" />
      </many-to-one>
    </subclass>

  </class>

Student class
======
    public class Student : Party
    {
        private const string _context = ""student"";

        public virtual PersonName StudentName {
            get { return (PersonName) GetNameInContextOf(_context); } 
            set { this.SetPartyName(value, _context); }
        }

        ...
    }


Passing Test (and output)
===========

	[Test]
	public void PartyRelationship_CanSaveAndLoadRelatedNames() {
		var party = new Party();
		party.AddPartyName(NameSeeds.DevName);
		party.AddPartyName(NameSeeds.LegalName);
		using (var tx = _session.BeginTransaction())
		{
			_session.Save(party);
			tx.Commit();
		}
		_session.Clear();

		Party found;
		using (var tx = _session.BeginTransaction())
		{
			found = _session.Get<Party>(party.Id);
			tx.Commit();
		}
		found.Look();
		Assert.That(party.Names, Is.Not.Empty);
	}

	NHibernate: INSERT INTO Parties (Type, PartyId) VALUES ('Parties.Domain.Party', @p0);@p0 = 32768 [Type: Int32 (0)]
	NHibernate: INSERT INTO PartyNames (PartyId, TheRequiredName, EverythingElse, ContextUsed, Salutation, Start, End, PartyNameId) VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);@p0 = 32768 [Type: Int32 (0)], @p1 = 'Hesh' [Type: String (0)], @p2 = 'Berryl;;;' [Type: String (0)], @p3 = 'Stack Overflow Profile' [Type: String (0)], @p4 = 'Fellow Geek' [Type: String (0)], @p5 = 7/21/2011 5:49:09 AM [Type: DateTime (0)], @p6 = 12/31/9999 11:59:59 PM [Type: DateTime (0)], @p7 = 65536 [Type: Int32 (0)]
	NHibernate: INSERT INTO PartyNames (PartyId, TheRequiredName, EverythingElse, ContextUsed, Salutation, Start, End, PartyNameId) VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);@p0 = 32768 [Type: Int32 (0)], @p1 = 'Fingerhut' [Type: String (0)], @p2 = 'Eric;;;' [Type: String (0)], @p3 = 'birth certificate' [Type: String (0)], @p4 = 'Sir' [Type: String (0)], @p5 = 7/21/2011 5:49:09 AM [Type: DateTime (0)], @p6 = 12/31/9999 11:59:59 PM [Type: DateTime (0)], @p7 = 65537 [Type: Int32 (0)]
	NHibernate: SELECT party0_.PartyId as PartyId2_0_, party0_.Number as Number2_0_, party0_.SomeDopeyClassId as SomeDope4_2_0_, party0_.Type as Type2_0_ FROM Parties party0_ WHERE party0_.PartyId=@p0;@p0 = 32768 [Type: Int32 (0)]

Failing test (and output)
================

	[Test]
	public void CanSaveAndLoad_Names()
	{
                _student = new Student { StudentName = NameSeeds.DevPersonName, };
		using (var tx = _session.BeginTransaction()) {
			_session.Save(_student);
			tx.Commit();
		}
		_session.Clear();

		Student found;
		using (var tx = _session.BeginTransaction())
		{
			found = _session.Get<Student>(_student.Id);
			tx.Commit();
		}
		found.Look();
		Assert.That(found.Names, Is.Not.Empty);
		Assert.That(found.StudentName, Is.EqualTo(NameSeeds.DevPersonName));
	}

	NHibernate: INSERT INTO Parties (Number, CourseId, Type, PartyId) VALUES (@p0, @p1, 'Student', @p2);@p0 = 0 [Type: Int32 (0)], @p1 = NULL [Type: Int32 (0)], @p2 = 32768 [Type: Int32 (0)]
	NHibernate: INSERT INTO PartyNames (PartyId, TheRequiredName, EverythingElse, ContextUsed, Salutation, Start, End, PartyNameId) VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);@p0 = 32768 [Type: Int32 (0)], @p1 = 'Hesh' [Type: String (0)], @p2 = 'Berryl;;;' [Type: String (0)], @p3 = 'student' [Type: String (0)], @p4 = NULL [Type: String (0)], @p5 = NULL [Type: DateTime (0)], @p6 = NULL [Type: DateTime (0)], @p7 = 65536 [Type: Int32 (0)]
	NHibernate: UPDATE PartyNames SET PartyId = @p0, TheRequiredName = @p1, EverythingElse = @p2, ContextUsed = @p3, Salutation = @p4, Start = @p5, End = @p6 WHERE PartyNameId = @p7;@p0 = 32768 [Type: Int32 (0)], @p1 = 'Hesh' [Type: String (0)], @p2 = 'Berryl;;;' [Type: String (0)], @p3 = 'student' [Type: String (0)], @p4 = NULL [Type: String (0)], @p5 = NULL [Type: DateTime (0)], @p6 = NULL [Type: DateTime (0)], @p7 = 65536 [Type: Int32 (0)]
	NHibernate: SELECT student0_.PartyId as PartyId2_0_, student0_.Number as Number2_0_, student0_.CourseId as SomeDope4_2_0_ FROM Parties student0_ WHERE student0_.PartyId=@p0 and student0_.Type='Student';@p0 = 32768 [Type: Int32 (0)]

	NHibernate: SELECT names0_.PartyNameId as PartyNam1_1_, names0_.PartyNameId as PartyNam1_1_0_, names0_.PartyId as PartyId1_0_, names0_.TheRequiredName as TheRequi3_1_0_, names0_.EverythingElse as Everythi4_1_0_, names0_.ContextUsed as ContextU5_1_0_, names0_.Salutation as Salutation1_0_, names0_.Start as Start1_0_, names0_.End as End1_0_ FROM PartyNames names0_ WHERE names0_.PartyNameId=@p0;@p0 = 32768 [Type: Int32 (0)]
	Test 'Parties.Data.Impl.NHib.Tests.Names.StudentMappingTests.CanSaveAndLoad_Names' failed: 
	  Expected: not <empty>
	  But was:  <empty>
		Names\StudentMappingTests.cs(63,0): at Parties.Data.Impl.NHib.Tests.Names.StudentMappingTests.CanSaveAndLoad_Names()
",nhibernate,inheritance,mapping,,,,open,0,891,4,"nhibernate inheritance mapping issue In the object model, Party is a base class to a Student, and can have one to many Names.

When I run a test using a Party object that has multiple names, the names are saved and hydrated by NHib, as I would expect.

When I run the a similar test, but with a Student object, NHib persists the names - but they aren't available. Please note I am trying to populate the unmapped StudentName property based on the set of names available in the base class, and NHib is doing an extra select that must be related to it.

Can some explain what is going on with the failing test, given the code below? In particular, why is the set of Party names empty, and what is triggering that last select from the Names table?

Cheers,  
Berryl

MAPPING
======
   <class name=""Party"" table=""Parties"">
    <id name=""Id"">
      <column name=""PartyId"" />
      <generator class=""hilo"" />
    </id>

    <discriminator column=""Type"" not-null=""true"" type=""string"" />

    <set access=""field.camelcase-underscore"" cascade=""all"" inverse=""true"" name=""Names"">
      <key foreign-key=""Party_PartyName_FK"">
        <column name=""PartyNameId"" />
      </key>
      <one-to-many class=""Parties.Domain.Names.PartyName, Parties.Domain"" />
    </set>

    <subclass 
      name=""Student, Core.TestingSupport"" 
      discriminator-value=""Student""
      >
      <property name=""Number"" />

      <many-to-one 
        class=""Course, Core.TestingSupport"" 
        foreign-key=""Course_FK"" 
        name=""Course"">
        <column name=""CourseId"" index=""CourseIndex"" />
      </many-to-one>
    </subclass>

  </class>

Student class
======
    public class Student : Party
    {
        private const string _context = ""student"";

        public virtual PersonName StudentName {
            get { return (PersonName) GetNameInContextOf(_context); } 
            set { this.SetPartyName(value, _context); }
        }

        ...
    }


Passing Test (and output)
===========

	[Test]
	public void PartyRelationship_CanSaveAndLoadRelatedNames() {
		var party = new Party();
		party.AddPartyName(NameSeeds.DevName);
		party.AddPartyName(NameSeeds.LegalName);
		using (var tx = _session.BeginTransaction())
		{
			_session.Save(party);
			tx.Commit();
		}
		_session.Clear();

		Party found;
		using (var tx = _session.BeginTransaction())
		{
			found = _session.Get<Party>(party.Id);
			tx.Commit();
		}
		found.Look();
		Assert.That(party.Names, Is.Not.Empty);
	}

	NHibernate: INSERT INTO Parties (Type, PartyId) VALUES ('Parties.Domain.Party', @p0);@p0 = 32768 [Type: Int32 (0)]
	NHibernate: INSERT INTO PartyNames (PartyId, TheRequiredName, EverythingElse, ContextUsed, Salutation, Start, End, PartyNameId) VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);@p0 = 32768 [Type: Int32 (0)], @p1 = 'Hesh' [Type: String (0)], @p2 = 'Berryl;;;' [Type: String (0)], @p3 = 'Stack Overflow Profile' [Type: String (0)], @p4 = 'Fellow Geek' [Type: String (0)], @p5 = 7/21/2011 5:49:09 AM [Type: DateTime (0)], @p6 = 12/31/9999 11:59:59 PM [Type: DateTime (0)], @p7 = 65536 [Type: Int32 (0)]
	NHibernate: INSERT INTO PartyNames (PartyId, TheRequiredName, EverythingElse, ContextUsed, Salutation, Start, End, PartyNameId) VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);@p0 = 32768 [Type: Int32 (0)], @p1 = 'Fingerhut' [Type: String (0)], @p2 = 'Eric;;;' [Type: String (0)], @p3 = 'birth certificate' [Type: String (0)], @p4 = 'Sir' [Type: String (0)], @p5 = 7/21/2011 5:49:09 AM [Type: DateTime (0)], @p6 = 12/31/9999 11:59:59 PM [Type: DateTime (0)], @p7 = 65537 [Type: Int32 (0)]
	NHibernate: SELECT party0_.PartyId as PartyId2_0_, party0_.Number as Number2_0_, party0_.SomeDopeyClassId as SomeDope4_2_0_, party0_.Type as Type2_0_ FROM Parties party0_ WHERE party0_.PartyId=@p0;@p0 = 32768 [Type: Int32 (0)]

Failing test (and output)
================

	[Test]
	public void CanSaveAndLoad_Names()
	{
                _student = new Student { StudentName = NameSeeds.DevPersonName, };
		using (var tx = _session.BeginTransaction()) {
			_session.Save(_student);
			tx.Commit();
		}
		_session.Clear();

		Student found;
		using (var tx = _session.BeginTransaction())
		{
			found = _session.Get<Student>(_student.Id);
			tx.Commit();
		}
		found.Look();
		Assert.That(found.Names, Is.Not.Empty);
		Assert.That(found.StudentName, Is.EqualTo(NameSeeds.DevPersonName));
	}

	NHibernate: INSERT INTO Parties (Number, CourseId, Type, PartyId) VALUES (@p0, @p1, 'Student', @p2);@p0 = 0 [Type: Int32 (0)], @p1 = NULL [Type: Int32 (0)], @p2 = 32768 [Type: Int32 (0)]
	NHibernate: INSERT INTO PartyNames (PartyId, TheRequiredName, EverythingElse, ContextUsed, Salutation, Start, End, PartyNameId) VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);@p0 = 32768 [Type: Int32 (0)], @p1 = 'Hesh' [Type: String (0)], @p2 = 'Berryl;;;' [Type: String (0)], @p3 = 'student' [Type: String (0)], @p4 = NULL [Type: String (0)], @p5 = NULL [Type: DateTime (0)], @p6 = NULL [Type: DateTime (0)], @p7 = 65536 [Type: Int32 (0)]
	NHibernate: UPDATE PartyNames SET PartyId = @p0, TheRequiredName = @p1, EverythingElse = @p2, ContextUsed = @p3, Salutation = @p4, Start = @p5, End = @p6 WHERE PartyNameId = @p7;@p0 = 32768 [Type: Int32 (0)], @p1 = 'Hesh' [Type: String (0)], @p2 = 'Berryl;;;' [Type: String (0)], @p3 = 'student' [Type: String (0)], @p4 = NULL [Type: String (0)], @p5 = NULL [Type: DateTime (0)], @p6 = NULL [Type: DateTime (0)], @p7 = 65536 [Type: Int32 (0)]
	NHibernate: SELECT student0_.PartyId as PartyId2_0_, student0_.Number as Number2_0_, student0_.CourseId as SomeDope4_2_0_ FROM Parties student0_ WHERE student0_.PartyId=@p0 and student0_.Type='Student';@p0 = 32768 [Type: Int32 (0)]

	NHibernate: SELECT names0_.PartyNameId as PartyNam1_1_, names0_.PartyNameId as PartyNam1_1_0_, names0_.PartyId as PartyId1_0_, names0_.TheRequiredName as TheRequi3_1_0_, names0_.EverythingElse as Everythi4_1_0_, names0_.ContextUsed as ContextU5_1_0_, names0_.Salutation as Salutation1_0_, names0_.Start as Start1_0_, names0_.End as End1_0_ FROM PartyNames names0_ WHERE names0_.PartyNameId=@p0;@p0 = 32768 [Type: Int32 (0)]
	Test 'Parties.Data.Impl.NHib.Tests.Names.StudentMappingTests.CanSaveAndLoad_Names' failed: 
	  Expected: not <empty>
	  But was:  <empty>
		Names\StudentMappingTests.cs(63,0): at Parties.Data.Impl.NHib.Tests.Names.StudentMappingTests.CanSaveAndLoad_Names()
",3
1678284,11/05/2009 04:08:16,199183,10/29/2009 19:29:29,6,0,How to test Nhibernate with Nunit?,"Sorry for the repost.

I'm using Nhibernate for ORM and have this class I need to perform unit tests using Nunit:

    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Text;
    using NHibernate;
    using NHibernate.Cfg;
    using NutritionLibrary.Entity;
    using System.Data;
    using System.Data.SqlClient;
    using System.Collections;
    
    namespace NutritionLibrary.DAO
    {
        public class IngredientDAONHibernate : NutritionLibrary.DAO.IngredientDAO
       
        {
       
              private Configuration config;
            private ISessionFactory factory;
    
            public IngredientDAONHibernate()
            {
               
                    config = new Configuration();
                    config.AddClass(typeof(NutritionLibrary.Entity.Ingredient));
                    config.AddClass(typeof(Entity.Nutrient));
                    config.AddClass(typeof(Entity.NutrientIngredient));
                           factory = config.BuildSessionFactory();
               
            }
    
    
            /// <summary>
            ///  gets the list of ingredients from the db
            /// </summary>
            /// <returns>IList of ingredients</returns>
            public System.Collections.Generic.IList<Ingredient> GetIngredientList()
            {
                System.Collections.Generic.IList<Ingredient> ingredients;
                string hql = ""from NutritionLibrary.Entity.Ingredient ingredient"";
    
                ISession session = null;
                ITransaction tx = null;
    
                try
                {
                    session = factory.OpenSession();
                    tx = session.BeginTransaction();
    
                    IQuery q = session.CreateQuery(hql);
    
                    ingredients = q.List<Ingredient>();
                    tx.Commit();
                }
                catch (Exception e)
                {
                    if (tx != null) tx.Rollback();
                    /*if (logger.IsErrorEnabled)
                    {
                        logger.Error(""EXCEPTION OCCURRED"", e);
                    }*/
    
                 ingredients = null;
                }
                finally
                {
                    session.Close();
                    session = null;
                    tx = null;
                }
    
                return ingredients;
            }
    
        
        }
    }

I started with the constructor, but I got a few people advising me its not really necessary. So this is my method that I need to test. It queries the db and gives me a List of ingredient objects. I am having difficulty getting started with how to test the getIngredientList() method. I have this test stub:

    [TestMethod()]
            public void GetIngredientListTest()
            {
                IngredientDAONHibernate target = new IngredientDAONHibernate(); // TODO: Initialize to an appropriate value
                IList<Ingredient> expected = null; // TODO: Initialize to an appropriate value
                IList<Ingredient> actual;
                actual = target.GetIngredientList();
                Assert.AreEqual(expected, actual);
                
            }

I have a lot of other similar methods that I have to test, so if someone could be kind enough to help me get started with this, I will have a basic idea of how to implement unit tests on my other methods.

Once again, thank you for your time and advise.",nhibernate,c#,nunit,unit-testing,,,open,0,1297,6,"How to test Nhibernate with Nunit? Sorry for the repost.

I'm using Nhibernate for ORM and have this class I need to perform unit tests using Nunit:

    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Text;
    using NHibernate;
    using NHibernate.Cfg;
    using NutritionLibrary.Entity;
    using System.Data;
    using System.Data.SqlClient;
    using System.Collections;
    
    namespace NutritionLibrary.DAO
    {
        public class IngredientDAONHibernate : NutritionLibrary.DAO.IngredientDAO
       
        {
       
              private Configuration config;
            private ISessionFactory factory;
    
            public IngredientDAONHibernate()
            {
               
                    config = new Configuration();
                    config.AddClass(typeof(NutritionLibrary.Entity.Ingredient));
                    config.AddClass(typeof(Entity.Nutrient));
                    config.AddClass(typeof(Entity.NutrientIngredient));
                           factory = config.BuildSessionFactory();
               
            }
    
    
            /// <summary>
            ///  gets the list of ingredients from the db
            /// </summary>
            /// <returns>IList of ingredients</returns>
            public System.Collections.Generic.IList<Ingredient> GetIngredientList()
            {
                System.Collections.Generic.IList<Ingredient> ingredients;
                string hql = ""from NutritionLibrary.Entity.Ingredient ingredient"";
    
                ISession session = null;
                ITransaction tx = null;
    
                try
                {
                    session = factory.OpenSession();
                    tx = session.BeginTransaction();
    
                    IQuery q = session.CreateQuery(hql);
    
                    ingredients = q.List<Ingredient>();
                    tx.Commit();
                }
                catch (Exception e)
                {
                    if (tx != null) tx.Rollback();
                    /*if (logger.IsErrorEnabled)
                    {
                        logger.Error(""EXCEPTION OCCURRED"", e);
                    }*/
    
                 ingredients = null;
                }
                finally
                {
                    session.Close();
                    session = null;
                    tx = null;
                }
    
                return ingredients;
            }
    
        
        }
    }

I started with the constructor, but I got a few people advising me its not really necessary. So this is my method that I need to test. It queries the db and gives me a List of ingredient objects. I am having difficulty getting started with how to test the getIngredientList() method. I have this test stub:

    [TestMethod()]
            public void GetIngredientListTest()
            {
                IngredientDAONHibernate target = new IngredientDAONHibernate(); // TODO: Initialize to an appropriate value
                IList<Ingredient> expected = null; // TODO: Initialize to an appropriate value
                IList<Ingredient> actual;
                actual = target.GetIngredientList();
                Assert.AreEqual(expected, actual);
                
            }

I have a lot of other similar methods that I have to test, so if someone could be kind enough to help me get started with this, I will have a basic idea of how to implement unit tests on my other methods.

Once again, thank you for your time and advise.",4
10131740,04/12/2012 20:59:09,106532,05/13/2009 18:16:47,125,2,OneToManyPersister GenerateInsertRowString() creates UPDATE statements,"Why does the OneToManyPersister in NHibernate create Update statements when it calls GenerateInsertRowString()?

I have a unidirectional one-to-many relationship and I need the save to cascade, but when the collection calls PerformInsert, an update is issued. 

Below is my mapping. We are using a repository pattern. ""Root"" has a ""Parent"", and ""Parent"" has a list of ""Child"". The repository saves the ""Root"" and ""Parent"" and its list of ""Child"" should be saved via cascading. 


    <class name=""Root"">
        <id name=""Id"">
            <generator class=""My.DomainModel.NHibernate.AssignedOrGuidCombIdGenerator, My.DomainModel.NHibernate"" />
        </id>
        <version name=""Version"" unsaved-value=""0"" />
        
        <many-to-one name=""Parent"" column=""ParentId"" unique=""True"" />
    </class>

    <class name=""Parent"">
        <id name=""Id"">
            <generator class=""My.DomainModel.NHibernate.AssignedOrGuidCombIdGenerator, My.DomainModel.NHibernate"" />
        </id>
        <version name=""Version"" unsaved-value=""0"" />
        <list name=""Children"" cascade=""all"">
            <key column=""ParentId""/>
            <index column=""Position""/>
            <one-to-many class=""Child""/>
        </list>
    </class>
    
    <class name=""Child"" discriminator-value=""G"">
        <id name=""Id"">
            <generator class=""My.DomainModel.NHibernate.AssignedOrGuidCombIdGenerator, My.DomainModel.NHibernate"" />
        </id>
        <discriminator column=""ChildType"" type=""char"" />
        <version name=""Version"" unsaved-value=""0"" />

        <subclass name=""SubChild1"" discriminator-value=""N"">
            <many-to-one name=""AnotherClass1"" column=""Another1Id""/>
        </subclass>

        <subclass name=""SubChild2"" discriminator-value=""A"">
            <many-to-one name=""AnotherClass2"" column=""Another2Id""/>            
        </subclass>
    </class>",nhibernate,,,,,,open,0,399,5,"OneToManyPersister GenerateInsertRowString() creates UPDATE statements Why does the OneToManyPersister in NHibernate create Update statements when it calls GenerateInsertRowString()?

I have a unidirectional one-to-many relationship and I need the save to cascade, but when the collection calls PerformInsert, an update is issued. 

Below is my mapping. We are using a repository pattern. ""Root"" has a ""Parent"", and ""Parent"" has a list of ""Child"". The repository saves the ""Root"" and ""Parent"" and its list of ""Child"" should be saved via cascading. 


    <class name=""Root"">
        <id name=""Id"">
            <generator class=""My.DomainModel.NHibernate.AssignedOrGuidCombIdGenerator, My.DomainModel.NHibernate"" />
        </id>
        <version name=""Version"" unsaved-value=""0"" />
        
        <many-to-one name=""Parent"" column=""ParentId"" unique=""True"" />
    </class>

    <class name=""Parent"">
        <id name=""Id"">
            <generator class=""My.DomainModel.NHibernate.AssignedOrGuidCombIdGenerator, My.DomainModel.NHibernate"" />
        </id>
        <version name=""Version"" unsaved-value=""0"" />
        <list name=""Children"" cascade=""all"">
            <key column=""ParentId""/>
            <index column=""Position""/>
            <one-to-many class=""Child""/>
        </list>
    </class>
    
    <class name=""Child"" discriminator-value=""G"">
        <id name=""Id"">
            <generator class=""My.DomainModel.NHibernate.AssignedOrGuidCombIdGenerator, My.DomainModel.NHibernate"" />
        </id>
        <discriminator column=""ChildType"" type=""char"" />
        <version name=""Version"" unsaved-value=""0"" />

        <subclass name=""SubChild1"" discriminator-value=""N"">
            <many-to-one name=""AnotherClass1"" column=""Another1Id""/>
        </subclass>

        <subclass name=""SubChild2"" discriminator-value=""A"">
            <many-to-one name=""AnotherClass2"" column=""Another2Id""/>            
        </subclass>
    </class>",1
9932704,03/29/2012 20:08:09,1051834,11/17/2011 12:58:43,38,1,Can't delete many-to-one relationship in NHibernate. Constraint Error,"I have the following mapping in Fluent NHibernate:

    public class SubEventMap : ClassMap<SubEvent>
    {
        public SubEventMap()
        {
            Id(x => x.ID).GeneratedBy.HiLo(""1000"");
            Map(x => x.Name);
            References(x => x.Project)
                .Not.Nullable()
                .Cascade.All();
            References(x => x.Place)
                .Not.Nullable()
                .Cascade.SaveUpdate();
            Map(x => x.BeginDate);
            Map(x => x.EndDate);
            Map(x => x.Description);
        }
    }
	
    public class ReservationMap : ClassMap<Reservation>
    {
        public ReservationMap()
        {
            Id(x => x.ID).GeneratedBy.HiLo(""1000"");
            References(x => x.Customer)
            References(x => x.SubEvent)
        }
    }
	
    public class EventMap : ClassMap<Event>
    {
        public EventMap()
        {
            Id(x => x.ID).GeneratedBy.HiLo(""1000"");
            Map(x => x.Name);
            Map(x => x.BeginDate);
            Map(x => x.EndDate);
            Map(x => x.Description);
            Map(x => x.ImageUrl);
            HasMany(x => x.SubEvents)
                .Cascade.All();
            References(x => x.Place)
                .Cascade.SaveUpdate();
        }
    }

My problem arises when I want to delete a SubEvent Entity. Then I get the following error:
The DELETE statement conflicted with the REFERENCE constraint ""FKC6A3305D965F624D"". The conflict occurred in database ""EMS"", table ""dbo.Reservation"", column 'SubEvent_id'.
The statement has been terminated.

How can I change my mapping to prevent this error on subevent deletion and cascade the deletion of reservations?",nhibernate,fluent,many-to-one,,,,open,0,535,8,"Can't delete many-to-one relationship in NHibernate. Constraint Error I have the following mapping in Fluent NHibernate:

    public class SubEventMap : ClassMap<SubEvent>
    {
        public SubEventMap()
        {
            Id(x => x.ID).GeneratedBy.HiLo(""1000"");
            Map(x => x.Name);
            References(x => x.Project)
                .Not.Nullable()
                .Cascade.All();
            References(x => x.Place)
                .Not.Nullable()
                .Cascade.SaveUpdate();
            Map(x => x.BeginDate);
            Map(x => x.EndDate);
            Map(x => x.Description);
        }
    }
	
    public class ReservationMap : ClassMap<Reservation>
    {
        public ReservationMap()
        {
            Id(x => x.ID).GeneratedBy.HiLo(""1000"");
            References(x => x.Customer)
            References(x => x.SubEvent)
        }
    }
	
    public class EventMap : ClassMap<Event>
    {
        public EventMap()
        {
            Id(x => x.ID).GeneratedBy.HiLo(""1000"");
            Map(x => x.Name);
            Map(x => x.BeginDate);
            Map(x => x.EndDate);
            Map(x => x.Description);
            Map(x => x.ImageUrl);
            HasMany(x => x.SubEvents)
                .Cascade.All();
            References(x => x.Place)
                .Cascade.SaveUpdate();
        }
    }

My problem arises when I want to delete a SubEvent Entity. Then I get the following error:
The DELETE statement conflicted with the REFERENCE constraint ""FKC6A3305D965F624D"". The conflict occurred in database ""EMS"", table ""dbo.Reservation"", column 'SubEvent_id'.
The statement has been terminated.

How can I change my mapping to prevent this error on subevent deletion and cascade the deletion of reservations?",3
4596505,01/04/2011 17:24:40,562897,01/04/2011 17:24:40,1,0,NHibernate and fluent NHibernate - Can I risk using these ?,"I started to look at these technologies but the more I look the more confused I am. It seems there are so many dependencies on Open Source that I am worried. I'm not even sure who is developing what and if the projects will continue. 

Entity Framework on the other hand is simple. There is version 4 and that's it. The code works and does not rely on anything else. 

Does anyone else have the concerns I have. 

Should I take a risk and use these products when I'm not even 100% sure how to find out what the latest versions are?",nhibernate,entity-framework,fluent-nhibernate,,,01/05/2011 08:36:21,not constructive,1,102,11,"NHibernate and fluent NHibernate - Can I risk using these ? I started to look at these technologies but the more I look the more confused I am. It seems there are so many dependencies on Open Source that I am worried. I'm not even sure who is developing what and if the projects will continue. 

Entity Framework on the other hand is simple. There is version 4 and that's it. The code works and does not rely on anything else. 

Does anyone else have the concerns I have. 

Should I take a risk and use these products when I'm not even 100% sure how to find out what the latest versions are?",3
10518452,05/09/2012 14:45:26,249686,01/13/2010 09:59:29,1115,65,Where can I get the latest FluentNHibernate build?,"In my applications, I've used FluentNHibernate quite a lot. Unfortunately, [a Visual Studio Bug has forced me to get a different FNH version][1], but ever since the project homepage has switched to GitHub, there is no working download link for compiled binaries anymore, so it's impossible to get a signed, strong-named version at this point.

What I've done is get the source and build my own version (using VS, not rake / albacore), which has - lacking the original .snk - no strong name / another strong name than the original. This creates some incompatibility between my assemblies, which in part use the vendor build and in part my own.

So, how the hell do you guys / gals deal with this issue? I can't be the only one looking for the latest FNH binaries, can I? Is there some continuous integration platform hosting it? 


  [1]: http://stackoverflow.com/questions/10331325/what-causes-the-vs-2010-sp1-wpf-designer-to-crash",nhibernate,fluent-nhibernate,,,,,open,0,147,8,"Where can I get the latest FluentNHibernate build? In my applications, I've used FluentNHibernate quite a lot. Unfortunately, [a Visual Studio Bug has forced me to get a different FNH version][1], but ever since the project homepage has switched to GitHub, there is no working download link for compiled binaries anymore, so it's impossible to get a signed, strong-named version at this point.

What I've done is get the source and build my own version (using VS, not rake / albacore), which has - lacking the original .snk - no strong name / another strong name than the original. This creates some incompatibility between my assemblies, which in part use the vendor build and in part my own.

So, how the hell do you guys / gals deal with this issue? I can't be the only one looking for the latest FNH binaries, can I? Is there some continuous integration platform hosting it? 


  [1]: http://stackoverflow.com/questions/10331325/what-causes-the-vs-2010-sp1-wpf-designer-to-crash",2
4938219,02/08/2011 20:46:13,357844,07/22/2009 18:48:19,199,0,Facing Below issue,"I am facing below issue, please help me.

-------------------------------------------

""StackTrace"":""   at System.RuntimeTypeHandle.CreateInstance(RuntimeType type, Boolean publicOnly, Boolean noCheck, Boolean& canBeCached, RuntimeMethodHandle& ctor, Boolean& bNeedSecurityCheck)\u000d\u000a   at System.RuntimeType.CreateInstanceSlow(Boolean publicOnly, Boolean fillCache)\u000d\u000a   at System.RuntimeType.CreateInstanceImpl(Boolean publicOnly, Boolean skipVisibilityChecks, Boolean fillCache)\u000d\u000a   at System.Activator.CreateInstance(Type type, Boolean nonPublic)\u000d\u000a   at NHibernate.AdoNet.SqlClientSqlCommandSet..ctor()\u000d\u000a   at NHibernate.AdoNet.SqlClientBatchingBatcher..ctor(ConnectionManager connectionManager, IInterceptor interceptor)\u000d\u000a   at NHibernate.AdoNet.SqlClientBatchingBatcherFactory.CreateBatcher(ConnectionManager connectionManager, IInterceptor interceptor)\u000d\u000a   at NHibernate.AdoNet.ConnectionManager..ctor(ISessionImplementor session, IDbConnection suppliedConnection, ConnectionReleaseMode connectionReleaseMode, IInterceptor interceptor)\u000d\u000a   at NHibernate.Impl.SessionImpl..ctor(IDbConnection connection, SessionFactoryImpl factory, Boolean autoclose, Int64 timestamp, IInterceptor interceptor, EntityMode entityMode, Boolean flushBeforeCompletionEnabled, Boolean autoCloseSessionEnabled, ConnectionReleaseMode connectionReleaseMode)\u000d\u000a   at NHibernate.Impl.SessionFactoryImpl.OpenSession(IDbConnection connection, Boolean autoClose, Int64 timestamp, IInterceptor sessionLocalInterceptor)\u000d\u000a   at NHibernate.Impl.SessionFactoryImpl.OpenSession(IInterceptor sessionLocalInterceptor)\u000d\u000a   at NHibernate.Impl.SessionFactoryImpl.OpenSession()\u000d\u000a   at SharpArch.Data.NHibernate.NHibernateSession.CurrentFor(String factoryKey)\u000d\u000a   at SharpArch.Data.NHibernate.RepositoryWithTypedId`2.get_Session()\u000d\u000a   at Apdecs.SocietyManager.Data.Repositories.StateRepository.GetStateB…

-------------------------------------------
 
Thanks in advance.",nhibernate,fluent-nhibernate,,,,02/08/2011 22:10:17,not a real question,1,132,3,"Facing Below issue I am facing below issue, please help me.

-------------------------------------------

""StackTrace"":""   at System.RuntimeTypeHandle.CreateInstance(RuntimeType type, Boolean publicOnly, Boolean noCheck, Boolean& canBeCached, RuntimeMethodHandle& ctor, Boolean& bNeedSecurityCheck)\u000d\u000a   at System.RuntimeType.CreateInstanceSlow(Boolean publicOnly, Boolean fillCache)\u000d\u000a   at System.RuntimeType.CreateInstanceImpl(Boolean publicOnly, Boolean skipVisibilityChecks, Boolean fillCache)\u000d\u000a   at System.Activator.CreateInstance(Type type, Boolean nonPublic)\u000d\u000a   at NHibernate.AdoNet.SqlClientSqlCommandSet..ctor()\u000d\u000a   at NHibernate.AdoNet.SqlClientBatchingBatcher..ctor(ConnectionManager connectionManager, IInterceptor interceptor)\u000d\u000a   at NHibernate.AdoNet.SqlClientBatchingBatcherFactory.CreateBatcher(ConnectionManager connectionManager, IInterceptor interceptor)\u000d\u000a   at NHibernate.AdoNet.ConnectionManager..ctor(ISessionImplementor session, IDbConnection suppliedConnection, ConnectionReleaseMode connectionReleaseMode, IInterceptor interceptor)\u000d\u000a   at NHibernate.Impl.SessionImpl..ctor(IDbConnection connection, SessionFactoryImpl factory, Boolean autoclose, Int64 timestamp, IInterceptor interceptor, EntityMode entityMode, Boolean flushBeforeCompletionEnabled, Boolean autoCloseSessionEnabled, ConnectionReleaseMode connectionReleaseMode)\u000d\u000a   at NHibernate.Impl.SessionFactoryImpl.OpenSession(IDbConnection connection, Boolean autoClose, Int64 timestamp, IInterceptor sessionLocalInterceptor)\u000d\u000a   at NHibernate.Impl.SessionFactoryImpl.OpenSession(IInterceptor sessionLocalInterceptor)\u000d\u000a   at NHibernate.Impl.SessionFactoryImpl.OpenSession()\u000d\u000a   at SharpArch.Data.NHibernate.NHibernateSession.CurrentFor(String factoryKey)\u000d\u000a   at SharpArch.Data.NHibernate.RepositoryWithTypedId`2.get_Session()\u000d\u000a   at Apdecs.SocietyManager.Data.Repositories.StateRepository.GetStateB…

-------------------------------------------
 
Thanks in advance.",2
1009110,06/17/2009 19:37:35,64334,02/09/2009 21:08:32,638,21,Learning NHibernate,"I am interested in learning NHibernate.

So, I found this:
[http://www.summerofnhibernate.com/][1]

I would like to watch these, but I am afraid that the videos are for a previous version of NHibernate. Is this true and if so should I still watch them? Is there a current video series?

Any other suggestions for learning NHibernate?



  [1]: http://www.summerofnhibernate.com/",nhibernate,orm,.net,,,09/18/2011 12:49:18,not constructive,1,53,2,"Learning NHibernate I am interested in learning NHibernate.

So, I found this:
[http://www.summerofnhibernate.com/][1]

I would like to watch these, but I am afraid that the videos are for a previous version of NHibernate. Is this true and if so should I still watch them? Is there a current video series?

Any other suggestions for learning NHibernate?



  [1]: http://www.summerofnhibernate.com/",3
965186,06/08/2009 14:34:53,21918,09/24/2008 22:22:17,38,6,nHibernate vulnerabilities,"We have been using nhibernate for almost a year now.
I wuld like to know that are there any vulnerabilities that could be injected(like SQL injection etc.) using web application.
I just want to secure any nhibernate injection through web application if there are.
",nhibernate,,,,,,open,0,42,2,"nHibernate vulnerabilities We have been using nhibernate for almost a year now.
I wuld like to know that are there any vulnerabilities that could be injected(like SQL injection etc.) using web application.
I just want to secure any nhibernate injection through web application if there are.
",1
966490,06/08/2009 19:20:52,113342,05/27/2009 18:37:28,98,2,NHibernate Aggregate Traversal (C#),"My application has a very simple model right now and I'm trying to find the best way to traverse through an aggregate. As you can see in my model diagram at the bottom, I have an account, a trip and a list of people attending a trip. I would like to be able to view all of the trips an account is apart of and I have come up with something like this:

        public List<Trip> GetAllTripsFor(int accountid)
        {
            var tripRepository = new TripRepository();
            var trips = tripRepository.FindAll();
            var userTrips = new List<Trip>();

            foreach (Trip trip in trips)
            {
                foreach (TripPeople person in trip.People)
                {
                    // If this trip's person list contains this accountid
                    // then add this trip to the userTrips list.
                    if(person.Account.Id == accountid)
                        userTrips.Add(trip);
                }
            }

            return userTrips;
        }

To me this doesn't seem very efficient and that I'm not thinking about things correctly. Do any of you have ideas on a better way of implementing this? Perhaps I'm thinking about my model wrong? Thanks

![alt text][1]


  [1]: http://i43.tinypic.com/214qb0l.png",nhibernate,aggregate,traversal,c#,,,open,0,393,4,"NHibernate Aggregate Traversal (C#) My application has a very simple model right now and I'm trying to find the best way to traverse through an aggregate. As you can see in my model diagram at the bottom, I have an account, a trip and a list of people attending a trip. I would like to be able to view all of the trips an account is apart of and I have come up with something like this:

        public List<Trip> GetAllTripsFor(int accountid)
        {
            var tripRepository = new TripRepository();
            var trips = tripRepository.FindAll();
            var userTrips = new List<Trip>();

            foreach (Trip trip in trips)
            {
                foreach (TripPeople person in trip.People)
                {
                    // If this trip's person list contains this accountid
                    // then add this trip to the userTrips list.
                    if(person.Account.Id == accountid)
                        userTrips.Add(trip);
                }
            }

            return userTrips;
        }

To me this doesn't seem very efficient and that I'm not thinking about things correctly. Do any of you have ideas on a better way of implementing this? Perhaps I'm thinking about my model wrong? Thanks

![alt text][1]


  [1]: http://i43.tinypic.com/214qb0l.png",4
740180,04/11/2009 14:28:14,7391,09/15/2008 13:39:40,1,5,Usage of ORMs like NHibernate when there are many associations - performance concerns,"I have created an application (a web-based application) which now has a large number of associations. Simply put, an Account:

 - has many Users
 - has Settings
 - has many Projects

Similarly a Project:

 - has many Items

A User:

 - has many Tasks

And so on, with loads more associations. Nothing particularly unusual about that I hope. I chose to use NHibernate to give me a nice set of persistent classes with mappers defining all of the associations.

But is this approach right? On every request to the application the Account is loaded (because it is needed) and this then requests a large amount of data from the DB that is not required. Lazy loading is an option, but I don't know if my initial approach couldn't be better. All I want at that stage is the Account and associated Settings so should the mapping reflect this? Trouble is I want things like all the Projects for an Account at other points so I need the mappers to reflect all of the associations.

My concern is that lazy-loading may just be compensating for a bad initial architecture on my part. I am well aware that this may just be a result of my as-yet poor knowledge of the inner workings of NHibernate. As a result I'd be grateful for any suggestions on good practice.

",nhibernate,orm,web-applications,performance,,,open,0,220,13,"Usage of ORMs like NHibernate when there are many associations - performance concerns I have created an application (a web-based application) which now has a large number of associations. Simply put, an Account:

 - has many Users
 - has Settings
 - has many Projects

Similarly a Project:

 - has many Items

A User:

 - has many Tasks

And so on, with loads more associations. Nothing particularly unusual about that I hope. I chose to use NHibernate to give me a nice set of persistent classes with mappers defining all of the associations.

But is this approach right? On every request to the application the Account is loaded (because it is needed) and this then requests a large amount of data from the DB that is not required. Lazy loading is an option, but I don't know if my initial approach couldn't be better. All I want at that stage is the Account and associated Settings so should the mapping reflect this? Trouble is I want things like all the Projects for an Account at other points so I need the mappers to reflect all of the associations.

My concern is that lazy-loading may just be compensating for a bad initial architecture on my part. I am well aware that this may just be a result of my as-yet poor knowledge of the inner workings of NHibernate. As a result I'd be grateful for any suggestions on good practice.

",4
5393183,03/22/2011 14:58:04,415477,02/17/2010 14:41:29,457,5,Which websites or products have successfully used ORM and benefited,"I have used Nhibernate before and at that time it was more like learning something new.I did not put much effort into learning the internal workings of it.But now I'm working with couple of my friends who decided to use fluentNhibernate and sometimes I feel that it has turned out to be the wrong decision, as too much of time is spent in thinking about performance and response time.I want to know if ORM has actually been helpful in building a successful product or a website.Right now I see it as a overhead.",nhibernate,orm,fluent-nhibernate,,,03/25/2011 00:53:51,off topic,1,93,10,"Which websites or products have successfully used ORM and benefited I have used Nhibernate before and at that time it was more like learning something new.I did not put much effort into learning the internal workings of it.But now I'm working with couple of my friends who decided to use fluentNhibernate and sometimes I feel that it has turned out to be the wrong decision, as too much of time is spent in thinking about performance and response time.I want to know if ORM has actually been helpful in building a successful product or a website.Right now I see it as a overhead.",3
2626247,04/13/2010 00:18:29,48025,12/20/2008 19:11:28,255,11,Recommendations for supporting both Oracle and MSSQL in the same ASP.NET app with NHibernate,"
Our client wants to support both SQLServer and Oracle in the next project. Our experience comes from .NET/SQL Server platform. We will hire an Oracle developer, but our concern is with  the DataAccess code. Will NHibernate make the DB Engine transparent for us? I don't think so, but i would like to hear from developers who have faced similar situations. 

I know this question is a little vague, because i don't have Oracle experience, so i don't know what issues we will find.
",nhibernate,oracle,sql,server,,,open,0,84,14,"Recommendations for supporting both Oracle and MSSQL in the same ASP.NET app with NHibernate 
Our client wants to support both SQLServer and Oracle in the next project. Our experience comes from .NET/SQL Server platform. We will hire an Oracle developer, but our concern is with  the DataAccess code. Will NHibernate make the DB Engine transparent for us? I don't think so, but i would like to hear from developers who have faced similar situations. 

I know this question is a little vague, because i don't have Oracle experience, so i don't know what issues we will find.
",4
1905022,12/15/2009 03:41:48,21966,09/25/2008 01:55:29,2026,90,When does NHibernate cause Sql:BatchStarting/Sql:BatchCompleted,"I notice that some queries created by NHibernate are executed as batches whereas others are not. When I profile my database using Sql Server Profiler, the event type for these queries is listed as 'SQL:BatchStarting' followed by 'SQL:BatchCompleted', rather than simply RPC:Completed.

Is there any reason why some statements are run as batches and some not?

How does NHibernate decide which queries should be executed as batches? 

It seems to execute a lot of single queries as batches - why would this be?",nhibernate,batch,,,,,open,0,81,5,"When does NHibernate cause Sql:BatchStarting/Sql:BatchCompleted I notice that some queries created by NHibernate are executed as batches whereas others are not. When I profile my database using Sql Server Profiler, the event type for these queries is listed as 'SQL:BatchStarting' followed by 'SQL:BatchCompleted', rather than simply RPC:Completed.

Is there any reason why some statements are run as batches and some not?

How does NHibernate decide which queries should be executed as batches? 

It seems to execute a lot of single queries as batches - why would this be?",2
679895,03/25/2009 01:30:51,50021,12/30/2008 00:01:03,16,8,Using NHibernate with Codesmith to generate ORM,"Just started learning NHiberate. It seems rather tedious to write proper hbm.xml config files for each database table. 

The question is can NHibernate read into tables and automatically retrieve relationships and needed config file as well as database mapper classes for you? It seems that the programmer still has to do a lot of ground work initially. Then I came across Codesmith which got templates for NHiberate? Does it fill in the gap?",nhibernate,codesmith,,,,,open,0,73,7,"Using NHibernate with Codesmith to generate ORM Just started learning NHiberate. It seems rather tedious to write proper hbm.xml config files for each database table. 

The question is can NHibernate read into tables and automatically retrieve relationships and needed config file as well as database mapper classes for you? It seems that the programmer still has to do a lot of ground work initially. Then I came across Codesmith which got templates for NHiberate? Does it fill in the gap?",2
2817493,05/12/2010 09:30:28,291357,03/11/2010 09:51:36,8,0,"NHibernate, each property is filled with a different select statement","I'm retrieving a list of nhibernate entites which have relationships to other tables/entities. I've noticed instead of NHibernate performing JOINS and populating the properties, it retrieves the entity and then calls a select for each property. For example if a user can have many roles and I retrieve a user from the DB, Nhibernate retrieves the user and then populates the roles with another select statement. The problem is that I want to retrieve oh let's say a list of products which have various many-to-many relationships and relationships to items which have their own relationships. In the end I'm left with over a thousand DB calls to retrieve a list of 30 products.

Thanks.

I've also set default lazy loading to false because whenever I save the list of entities to a session, I get an error when trying to retrieve it on another page: LazyInitializationException: could not initialize proxy

If anybody could shed any light I would truly appreciate it.

Thanks. 

Eitan",nhibernate,optimization,database,,,,open,0,159,10,"NHibernate, each property is filled with a different select statement I'm retrieving a list of nhibernate entites which have relationships to other tables/entities. I've noticed instead of NHibernate performing JOINS and populating the properties, it retrieves the entity and then calls a select for each property. For example if a user can have many roles and I retrieve a user from the DB, Nhibernate retrieves the user and then populates the roles with another select statement. The problem is that I want to retrieve oh let's say a list of products which have various many-to-many relationships and relationships to items which have their own relationships. In the end I'm left with over a thousand DB calls to retrieve a list of 30 products.

Thanks.

I've also set default lazy loading to false because whenever I save the list of entities to a session, I get an error when trying to retrieve it on another page: LazyInitializationException: could not initialize proxy

If anybody could shed any light I would truly appreciate it.

Thanks. 

Eitan",3
7575574,09/27/2011 20:56:37,880601,08/05/2011 12:50:30,20,1,When to use Nhibernate <version>?,"I was looking at ayende blog http://ayende.com/blog/3946/nhibernate-mapping-concurrency about NHibernate concurrency and i still not very clear when to use <version> . It seems like it is a solution to solve StaleObjectException. 

Can anyone explain to me in what scenario you will use a <version> and why ?

Thanks.   ",nhibernate,,,,,,open,0,50,5,"When to use Nhibernate <version>? I was looking at ayende blog http://ayende.com/blog/3946/nhibernate-mapping-concurrency about NHibernate concurrency and i still not very clear when to use <version> . It seems like it is a solution to solve StaleObjectException. 

Can anyone explain to me in what scenario you will use a <version> and why ?

Thanks.   ",1
2003440,01/05/2010 00:49:57,243575,01/05/2010 00:18:48,1,0,NHibernate - mapping entity from multiple database tables,"Is it possible to map an entities properties from different database tables? Say you had the below data model...

    [dbo.Songs]                [dbo.Artists]
    SongID int                 ArtistID int
    SongTitle nvarchar(50)     ArtistName nvarchar(100)
    Duration int               .
    ArtistID int               .
    .                          .

Required entity:

    public class Song
    {
        public virtual int SongID { get; private set; }
        public virtual string SongTitle { get; set; }
        public virtual int Duration { get; set; }
        public virtual ArtistID { get; set; }
        public virtual ArtistName { get; private set; }      <- from different table, read only
    }

I know I should probably be creating an Artists entity and attaching that to the Song entity but if the Artists table had lots of columns and all I needed was the ArtistName what's the point in returning all the extra data across the wire when it's not going to be used or updated? I only want the ArtistName for display purposes only.

Thanks, FJ",nhibernate,,,,,,open,0,307,8,"NHibernate - mapping entity from multiple database tables Is it possible to map an entities properties from different database tables? Say you had the below data model...

    [dbo.Songs]                [dbo.Artists]
    SongID int                 ArtistID int
    SongTitle nvarchar(50)     ArtistName nvarchar(100)
    Duration int               .
    ArtistID int               .
    .                          .

Required entity:

    public class Song
    {
        public virtual int SongID { get; private set; }
        public virtual string SongTitle { get; set; }
        public virtual int Duration { get; set; }
        public virtual ArtistID { get; set; }
        public virtual ArtistName { get; private set; }      <- from different table, read only
    }

I know I should probably be creating an Artists entity and attaching that to the Song entity but if the Artists table had lots of columns and all I needed was the ArtistName what's the point in returning all the extra data across the wire when it's not going to be used or updated? I only want the ArtistName for display purposes only.

Thanks, FJ",1
2281488,02/17/2010 14:37:28,218377,11/25/2009 07:31:11,287,3,nhibernate 2 books,"Is there any hibernate 2 book?
No v 1.x

Thanks",nhibernate,c#,,,,09/30/2011 11:20:35,not constructive,1,8,3,"nhibernate 2 books Is there any hibernate 2 book?
No v 1.x

Thanks",2
4635762,01/08/2011 19:43:28,84539,03/30/2009 09:34:26,1540,39,Is NHibernate LINQ stable and do all NHibernate bolt on projects allow it,"I have been a long time user of Subsonic due to its ease of use and LINQ integration.

I now have to use something else because I need to be able to use Oracle.

I have 2 databases with the same schema therefore I want to have 1 set of POCO's and then change a connection string to switch between SQL & Oracle depending on the requirements.

Is this possible firstly, is LINQ fully functioning and stable in NHibernate and do Castle ActiveRecord and Fluent Hibernate allow the LINQ querying?
",nhibernate,orm,fluent-nhibernate,castle-activerecord,,,open,0,87,13,"Is NHibernate LINQ stable and do all NHibernate bolt on projects allow it I have been a long time user of Subsonic due to its ease of use and LINQ integration.

I now have to use something else because I need to be able to use Oracle.

I have 2 databases with the same schema therefore I want to have 1 set of POCO's and then change a connection string to switch between SQL & Oracle depending on the requirements.

Is this possible firstly, is LINQ fully functioning and stable in NHibernate and do Castle ActiveRecord and Fluent Hibernate allow the LINQ querying?
",4
5407265,03/23/2011 15:03:52,354661,05/31/2010 14:19:38,117,4,Nhibernate - Map a single row table,"I have an existing nhibernate web application and I'm about to add a configuration table that will contain all system wide configuration options. This table will always contain one and only one row. Each column will contain one configuration property. I plan on having a domain object that will have a matching property for each column in the table. The users will be able to modify the values for each property in an admin screen. I plan on populating the table with one row during installation, setting initial values for each configuration option. My questions are as follows:

1) I only want the system to update the existing row, and want to block any deletes or inserts on the table. I can, of course, enforce this by not creating application tier functions that do deletes or updates, but I wondered if NHibernate had some built in mapping or configuration options to help. I'd prefer to not have to do this at the database level since we are writing a database agnostic application, and so far, have not had to write any database platform specific code or scripts.

2) Would the mapping be different for this class than my other ""normal"" classes?
",nhibernate,mapping,,,,,open,0,199,7,"Nhibernate - Map a single row table I have an existing nhibernate web application and I'm about to add a configuration table that will contain all system wide configuration options. This table will always contain one and only one row. Each column will contain one configuration property. I plan on having a domain object that will have a matching property for each column in the table. The users will be able to modify the values for each property in an admin screen. I plan on populating the table with one row during installation, setting initial values for each configuration option. My questions are as follows:

1) I only want the system to update the existing row, and want to block any deletes or inserts on the table. I can, of course, enforce this by not creating application tier functions that do deletes or updates, but I wondered if NHibernate had some built in mapping or configuration options to help. I'd prefer to not have to do this at the database level since we are writing a database agnostic application, and so far, have not had to write any database platform specific code or scripts.

2) Would the mapping be different for this class than my other ""normal"" classes?
",2
1615248,10/23/2009 18:45:31,49881,12/29/2008 16:17:18,228,4,How to project only two columns and list them? (Nhibernate),"Given the table structure below, how do you project x and y only with nhibernate? How do you list the results, what is the type of the resulting list?
    
    //Table structure, mapped in the traditional way
    FunnyTable { 
                 x [int] NOT NULL, 
                 y [int] NULL, 
                 z [int] NOT NULL
               }

    //assume criteria is set somewhere else
    ProjectionList list = Projections.ProjectionList()
                                     .Add(Projections.Property(""x""))
                                     .Add(Projections.Property(""y""));
    return criteria.SetProjection(list).List<???>??",nhibernate,c#,hibernate,,,,open,0,220,10,"How to project only two columns and list them? (Nhibernate) Given the table structure below, how do you project x and y only with nhibernate? How do you list the results, what is the type of the resulting list?
    
    //Table structure, mapped in the traditional way
    FunnyTable { 
                 x [int] NOT NULL, 
                 y [int] NULL, 
                 z [int] NOT NULL
               }

    //assume criteria is set somewhere else
    ProjectionList list = Projections.ProjectionList()
                                     .Add(Projections.Property(""x""))
                                     .Add(Projections.Property(""y""));
    return criteria.SetProjection(list).List<???>??",3
3260659,07/15/2010 22:42:33,316632,04/14/2010 15:00:31,1,1,Fluent NHibernate one-to-many Cascade.SaveUpdate() blocks updates to entity,"We have an Enrollment object that has a Student object and the Student object has many Enrollment objects.  If I leave off the Cascade.SaveUpdate() from the Enrollment's Student reference, updates to the Student table do not execute, but updates to the Enrollment object succeed.  But if I add the Cascade.SaveUpdate() on the Enrollment's Student reference, the updates to the Student table work fine, but updates to the Enrollment table fail.  No exceptions are throw, the updates just don't succeed. 

Is there some way to both save objects on both sides of the relationship?

Here's the code snips, let me know if you need more:<br>
EnrollmentMap: 
<pre>
    References(x => x.Student)
                .Column(""student_id"");// without the cascade on the next line, this fails to update changes to Student
                //.Cascade.SaveUpdate();// when uncommented this updates changes to Student but blocks updates to Enrollment
</pre>
StudentMap:
<pre>
    HasMany(x => x.Enrollments)
                .KeyColumn(""student_id"")
                .Inverse()
                .Cascade.SaveUpdate();
</pre>

Database call:
<pre>
public Application GetApplication(long applicationId)
        {
            using (var session = sessionFactory.OpenSession())
            {
                var query = session.Linq<Application>();
                query.Expand(x => x.Enrollment);
                query.Expand(x => x.Enrollment.Student);
                var result = from entity in query
                             where entity.ApplicationId == applicationId
                             select entity;
                return result.Count() > 0 ? result.First() : null;
            }
        }
</pre>
Database save:<br>
<pre>
using (var session = sessionFactory.OpenSession())
            {
                using (var transaction = session.BeginTransaction())
                {
                    try
                    {
                        session.SaveOrUpdate(entity);
                        transaction.Commit();
                    }
                    catch(Exception ex)
                    {
                        transaction.Rollback();
                        throw;
                    }
                }
            }
</pre>",nhibernate,fluent-nhibernate,,,,,open,0,745,8,"Fluent NHibernate one-to-many Cascade.SaveUpdate() blocks updates to entity We have an Enrollment object that has a Student object and the Student object has many Enrollment objects.  If I leave off the Cascade.SaveUpdate() from the Enrollment's Student reference, updates to the Student table do not execute, but updates to the Enrollment object succeed.  But if I add the Cascade.SaveUpdate() on the Enrollment's Student reference, the updates to the Student table work fine, but updates to the Enrollment table fail.  No exceptions are throw, the updates just don't succeed. 

Is there some way to both save objects on both sides of the relationship?

Here's the code snips, let me know if you need more:<br>
EnrollmentMap: 
<pre>
    References(x => x.Student)
                .Column(""student_id"");// without the cascade on the next line, this fails to update changes to Student
                //.Cascade.SaveUpdate();// when uncommented this updates changes to Student but blocks updates to Enrollment
</pre>
StudentMap:
<pre>
    HasMany(x => x.Enrollments)
                .KeyColumn(""student_id"")
                .Inverse()
                .Cascade.SaveUpdate();
</pre>

Database call:
<pre>
public Application GetApplication(long applicationId)
        {
            using (var session = sessionFactory.OpenSession())
            {
                var query = session.Linq<Application>();
                query.Expand(x => x.Enrollment);
                query.Expand(x => x.Enrollment.Student);
                var result = from entity in query
                             where entity.ApplicationId == applicationId
                             select entity;
                return result.Count() > 0 ? result.First() : null;
            }
        }
</pre>
Database save:<br>
<pre>
using (var session = sessionFactory.OpenSession())
            {
                using (var transaction = session.BeginTransaction())
                {
                    try
                    {
                        session.SaveOrUpdate(entity);
                        transaction.Commit();
                    }
                    catch(Exception ex)
                    {
                        transaction.Rollback();
                        throw;
                    }
                }
            }
</pre>",2
1848656,12/04/2009 18:05:00,98876,04/30/2009 19:37:14,6,0,nhibernate many-to-many with relationship specific properties,"Is there a way to map a many-to-many relationship with properties on each item in the list specific to the relationship?  The actual case I'm trying to solve is this: 

A business can be related to many contacts, and a contact can be related to many businesses.  What I want to do is provide a status for the relationship, like active or deleted and a date the contact was invited (or added) to be a contact for that business.  So say a contact can be active for one business, but pending for another business.

I know I can easily achieve this by just making the relationship an actual entity and mapping the association entity to the collections, but I REALLY hate doing that.  It just feels dirty making something like a relationship an actual entity.  What I'm wondering is if there's a way to map the relationship specific properties to each object.  So, say I have the list of contacts for a business.  Each contact in that list would have a status, but in the mapping it would make that status specific to the business.  I was hoping I could do something like this in what would be the business mapping:

    <bag name=""Contacts"" table=""BusinessContactAssociations"" lazy=""true"" cascade=""all"">
      <key column=""BusinessID""/>
      <many-to-many class=""Contact"" column=""ContactID"">
        <join table=""BusinessContactAssociations"">
          <key column=""ContactID""/>
          <property name=""InvitedDate""/>
          <property name=""Status""/>
        </join>
      </many-to-many>
    </bag>

but of course that doesn't work, because join can't be used within a many-to-many, but it illustrates what I want.

Anyone have any handy nhibernate mapping magic for me?",nhibernate,many-to-many,,,,,open,0,318,6,"nhibernate many-to-many with relationship specific properties Is there a way to map a many-to-many relationship with properties on each item in the list specific to the relationship?  The actual case I'm trying to solve is this: 

A business can be related to many contacts, and a contact can be related to many businesses.  What I want to do is provide a status for the relationship, like active or deleted and a date the contact was invited (or added) to be a contact for that business.  So say a contact can be active for one business, but pending for another business.

I know I can easily achieve this by just making the relationship an actual entity and mapping the association entity to the collections, but I REALLY hate doing that.  It just feels dirty making something like a relationship an actual entity.  What I'm wondering is if there's a way to map the relationship specific properties to each object.  So, say I have the list of contacts for a business.  Each contact in that list would have a status, but in the mapping it would make that status specific to the business.  I was hoping I could do something like this in what would be the business mapping:

    <bag name=""Contacts"" table=""BusinessContactAssociations"" lazy=""true"" cascade=""all"">
      <key column=""BusinessID""/>
      <many-to-many class=""Contact"" column=""ContactID"">
        <join table=""BusinessContactAssociations"">
          <key column=""ContactID""/>
          <property name=""InvitedDate""/>
          <property name=""Status""/>
        </join>
      </many-to-many>
    </bag>

but of course that doesn't work, because join can't be used within a many-to-many, but it illustrates what I want.

Anyone have any handy nhibernate mapping magic for me?",2
10427796,05/03/2012 08:35:19,369166,06/17/2010 09:33:07,458,30,How to not-load a reference/collection in NHibernate unless it is eagerly preloaded?,"I would like to create a requirement to pre-load all required entities before displaying them, to minimize the amount of database calls that are caused by negligence. Is it possible to force NHibernate to test a collection before returning it?

I had in mind something like checking `NHibernateUtil.IsInitialized()` before returning the object, not sure how to implement it globally without manually doing it for every property though.

Note: I would not want to enable eager loading for the whole application, just introduce a slightly smarter lazy-loading.",nhibernate,lazy-loading,,,,,open,0,84,12,"How to not-load a reference/collection in NHibernate unless it is eagerly preloaded? I would like to create a requirement to pre-load all required entities before displaying them, to minimize the amount of database calls that are caused by negligence. Is it possible to force NHibernate to test a collection before returning it?

I had in mind something like checking `NHibernateUtil.IsInitialized()` before returning the object, not sure how to implement it globally without manually doing it for every property though.

Note: I would not want to enable eager loading for the whole application, just introduce a slightly smarter lazy-loading.",2
811266,05/01/2009 13:05:47,1975,08/19/2008 16:30:04,562,51,Foreign Key Constraint is preventing NHibernate from saving child record,"I have two tables:

SupportTicket  
-------------
SupportTicketID  
SupportTicketDate  

SupportTicketNote
-----------------
SupportTicketNoteID  
SupportTicketNoteDate  
SupportTicketID  

With a foreign key constraint so I don't have any unassociated Notes...in sql that constraint is working properly.

On my SupportTicket class I have an IList<SupportTicketNote> SupportTicketNotes property and have it mapped as a bag (probably really should be a set but that's not important at the moment). The load works just fine.  The problem is if I new up a SupportTicket, new up a SupportTicketNote, add the note to the ticket and save the ticket.  NHibernate is inserting the SupportTicket, then inserting the SupportTicketNote with a SupportTicketID of zero which blows up of course because of the FK constraint.  If I delete the constraint it will insert with the SupportTicketID of zero and then go back and do an update on the SupportTicketNote with the proper ID value...but that seems....wrong.  Is there anything I might be doing in the mapping that is causing that?  

Here's my current mapping:

    <bag name=""_supportTicketNotes"" table=""SupportTicketNotes"" access=""field"" cascade=""save-update"" inverse=""true"" >
      <key column=""SupportTicketID"" foreign-key=""FK_SupportTicketNotes_supporttickets"" ></key>
      <one-to-many class=""NhibernateSample.DomainModel.SupportTicketNote, NhibernateSample.DomainModel"" />
    </bag>",nhibernate,,,,,,open,0,200,10,"Foreign Key Constraint is preventing NHibernate from saving child record I have two tables:

SupportTicket  
-------------
SupportTicketID  
SupportTicketDate  

SupportTicketNote
-----------------
SupportTicketNoteID  
SupportTicketNoteDate  
SupportTicketID  

With a foreign key constraint so I don't have any unassociated Notes...in sql that constraint is working properly.

On my SupportTicket class I have an IList<SupportTicketNote> SupportTicketNotes property and have it mapped as a bag (probably really should be a set but that's not important at the moment). The load works just fine.  The problem is if I new up a SupportTicket, new up a SupportTicketNote, add the note to the ticket and save the ticket.  NHibernate is inserting the SupportTicket, then inserting the SupportTicketNote with a SupportTicketID of zero which blows up of course because of the FK constraint.  If I delete the constraint it will insert with the SupportTicketID of zero and then go back and do an update on the SupportTicketNote with the proper ID value...but that seems....wrong.  Is there anything I might be doing in the mapping that is causing that?  

Here's my current mapping:

    <bag name=""_supportTicketNotes"" table=""SupportTicketNotes"" access=""field"" cascade=""save-update"" inverse=""true"" >
      <key column=""SupportTicketID"" foreign-key=""FK_SupportTicketNotes_supporttickets"" ></key>
      <one-to-many class=""NhibernateSample.DomainModel.SupportTicketNote, NhibernateSample.DomainModel"" />
    </bag>",1
2851856,05/17/2010 18:54:25,247184,01/09/2010 18:42:25,9,0,NHibernate Query Analyzer,"Could anyone please describe how to use NHibernate Query Analyzer? I downloaded it and trying to build it but it fails, I am not quite sure how to use it.

I am using nHibernate with Sybase and WCF.

Any help is greatly appreciated.

Thanks",nhibernate,query,analyzer,,,,open,0,41,3,"NHibernate Query Analyzer Could anyone please describe how to use NHibernate Query Analyzer? I downloaded it and trying to build it but it fails, I am not quite sure how to use it.

I am using nHibernate with Sybase and WCF.

Any help is greatly appreciated.

Thanks",3
7012570,08/10/2011 14:38:29,148009,07/30/2009 18:03:15,3920,200,NHibernate One-to-Many - why is it updating child with null foreign key?,"I am troubleshooting code that is attempting to update a disconnected entity that has uninitialized references to child entities.  The intent is to update only the properties on Parent without loading children.

    HasMany(x => x.ChildEntities)
      .KeyColumn(""ChildEntityId"")
      .Table(""ChildEntity"")
      .Not.LazyLoad()
      .Inverse()
      .Cascade.All().AsBag();

When Session.Update(parent) is called, two update statements are executed.  The first updates the parent object as expected.

    update Parent set ... where ParentId = 12345

The second update confuses me...

    update ChildEntity set ParentId = null where ParentId = 12345

Why is NHibernate issuing that second SQL statement?  I realize that ChildEntities is uninitialized and that NHibernate is probably trying to enforce the state of Parent but I can't seem to tweak the mapping to not make this second update.  I've tried Merge, lazy loading, various cascade options, etc. without success.  The only connected entity in the session when it tries to commit is Parent.

Note that I typically approach this by retrieving the entity with lazy loading enabled and then mapping from the disconnected object (DTO or entity) to the connected entity before letting NHibernate persist to the database.  I want to understand why the above isn't working before I suggest an alternative approach.",nhibernate,fluent-nhibernate,,,,,open,0,231,12,"NHibernate One-to-Many - why is it updating child with null foreign key? I am troubleshooting code that is attempting to update a disconnected entity that has uninitialized references to child entities.  The intent is to update only the properties on Parent without loading children.

    HasMany(x => x.ChildEntities)
      .KeyColumn(""ChildEntityId"")
      .Table(""ChildEntity"")
      .Not.LazyLoad()
      .Inverse()
      .Cascade.All().AsBag();

When Session.Update(parent) is called, two update statements are executed.  The first updates the parent object as expected.

    update Parent set ... where ParentId = 12345

The second update confuses me...

    update ChildEntity set ParentId = null where ParentId = 12345

Why is NHibernate issuing that second SQL statement?  I realize that ChildEntities is uninitialized and that NHibernate is probably trying to enforce the state of Parent but I can't seem to tweak the mapping to not make this second update.  I've tried Merge, lazy loading, various cascade options, etc. without success.  The only connected entity in the session when it tries to commit is Parent.

Note that I typically approach this by retrieving the entity with lazy loading enabled and then mapping from the disconnected object (DTO or entity) to the connected entity before letting NHibernate persist to the database.  I want to understand why the above isn't working before I suggest an alternative approach.",2
6882842,07/30/2011 11:34:15,104002,05/09/2009 08:53:55,184,14,using Nhibernate lazy proxys with a webservice,"Recently i had some performance problems in a SOAP webservice I wrote a while ago. I noticed I had a lot of queries going on and my hbm.xml mappings where full of lazy=false statements. I upgraded to NHibernate 3.0 and removed the lazy = false stuff and everything was a LOT faster....but now i am getting the following error:

> System.InvalidOperationException: There was an error generating the XML document. ---> System.InvalidOperationException: The type UserProxy was not expected. Use the XmlInclude or SoapInclude attribute to specify types that are not known statically.

User is a class of which i removed the lazy=false property from the class tag like this:

    <class name=""User"" table=""Users"" >
      <id name=""DatabaseID"" unsaved-value=""0"" column=""ID"" type=""integer"" >
        <generator class=""native""/>
       </id>
       <property name=""IsExpert""/>
        .....more stuff here....
    </class>

My webservice has a method like this (simplified a little..in real-life i use a repository-like pattern between the service and nhibernate):

        [WebMethod]
        public User GetUser(int userid)
        {
            session = GetCurrentSession();
            return session.Load<User>(userid);                         
        }

The webservice expects to serialize a user and NHibernate gives me a UserProxy (which is not a user exectlY). How should I overcome this?",nhibernate,soap,xml-serialization,lazy,proxy-classes,,open,0,292,7,"using Nhibernate lazy proxys with a webservice Recently i had some performance problems in a SOAP webservice I wrote a while ago. I noticed I had a lot of queries going on and my hbm.xml mappings where full of lazy=false statements. I upgraded to NHibernate 3.0 and removed the lazy = false stuff and everything was a LOT faster....but now i am getting the following error:

> System.InvalidOperationException: There was an error generating the XML document. ---> System.InvalidOperationException: The type UserProxy was not expected. Use the XmlInclude or SoapInclude attribute to specify types that are not known statically.

User is a class of which i removed the lazy=false property from the class tag like this:

    <class name=""User"" table=""Users"" >
      <id name=""DatabaseID"" unsaved-value=""0"" column=""ID"" type=""integer"" >
        <generator class=""native""/>
       </id>
       <property name=""IsExpert""/>
        .....more stuff here....
    </class>

My webservice has a method like this (simplified a little..in real-life i use a repository-like pattern between the service and nhibernate):

        [WebMethod]
        public User GetUser(int userid)
        {
            session = GetCurrentSession();
            return session.Load<User>(userid);                         
        }

The webservice expects to serialize a user and NHibernate gives me a UserProxy (which is not a user exectlY). How should I overcome this?",5
9946397,03/30/2012 15:52:46,543205,12/15/2010 10:22:48,750,47,Does NHibernate support subqueries in the `from` clause?,"Does NHibernate support subqueries in the `from` clause? For example I have sql queries looking like this:

    SELECT subquery.Id, sum(subquery.Value) ... 
       FROM (SELECT DISTINCT ... ) as subquery
    WHERE ...
    GROUP BY subquery.Id


I've only found this info:

> HQL does not have subquery in from clause support.  I've been consider
> how to add this, but I think it's going to be a substantial effort.
> It's coming, but unless somebody can provide more development time,
> it's going to take while to implement.
>         Patrick Earl

from [Google Groups][1] (17.08.2011). Is it still relevant? Maybe I can use Linq to NHibernate?


  [1]: https://groups.google.com/forum/?fromgroups#!topic/nhusers/mCJ_fOC_wfo",nhibernate,,,,,,open,0,124,8,"Does NHibernate support subqueries in the `from` clause? Does NHibernate support subqueries in the `from` clause? For example I have sql queries looking like this:

    SELECT subquery.Id, sum(subquery.Value) ... 
       FROM (SELECT DISTINCT ... ) as subquery
    WHERE ...
    GROUP BY subquery.Id


I've only found this info:

> HQL does not have subquery in from clause support.  I've been consider
> how to add this, but I think it's going to be a substantial effort.
> It's coming, but unless somebody can provide more development time,
> it's going to take while to implement.
>         Patrick Earl

from [Google Groups][1] (17.08.2011). Is it still relevant? Maybe I can use Linq to NHibernate?


  [1]: https://groups.google.com/forum/?fromgroups#!topic/nhusers/mCJ_fOC_wfo",1
7505001,09/21/2011 18:46:36,708307,04/14/2011 16:05:40,1,0,NHibernate 1.2 Id Generated by Database Trigger,"In NHibernate 1.2 is it possible to have the ID generated by a database trigger? Basically we need to change one of our tables to stop using a sequence and instead use a trigger to generate the primary key. So obviously I need to update the nhibernate mapping to use a different generator class but I'm not sure what class I should use, or even if this is supported in 1.2. Any help would be greatly appreciated. Thanks!",nhibernate,,,,,,open,0,78,7,"NHibernate 1.2 Id Generated by Database Trigger In NHibernate 1.2 is it possible to have the ID generated by a database trigger? Basically we need to change one of our tables to stop using a sequence and instead use a trigger to generate the primary key. So obviously I need to update the nhibernate mapping to use a different generator class but I'm not sure what class I should use, or even if this is supported in 1.2. Any help would be greatly appreciated. Thanks!",1
1715189,11/11/2009 13:33:15,61625,02/02/2009 18:39:40,36,2,What are the upsides and downsides of NHibernate?,"For a new project we are looking at NHibernate. We like it a lot overall, but one thing bothers us: it seems to be very resource consuming. Apparently NHibernate will load all the properties of an object even if you need only one of the properties. More over, it will do the same for the properties of child objects.

So we are weighing the pros and cons of NHibernate. What would you say they are, and if the upsides make up for the downsides?",nhibernate,,,,,10/01/2011 20:54:04,not constructive,1,83,8,"What are the upsides and downsides of NHibernate? For a new project we are looking at NHibernate. We like it a lot overall, but one thing bothers us: it seems to be very resource consuming. Apparently NHibernate will load all the properties of an object even if you need only one of the properties. More over, it will do the same for the properties of child objects.

So we are weighing the pros and cons of NHibernate. What would you say they are, and if the upsides make up for the downsides?",1
8644284,12/27/2011 11:49:05,39880,11/22/2008 07:12:51,334,3,Nhibernate for enterpise application or developer nightmare,"for last 2 years we are using nhibernate as an enterprise infrastructure for a large scale application, but every time we upgrade it to the new version almost 50% of queries dose not work anymore, all queries need to be reviewed and test again. it seems nhibernate product bug instead of feature. I wonder how many developer have the same problem. the team is tired, what shall we do.",nhibernate,enterprise,,,,12/30/2011 04:15:23,not constructive,1,69,7,"Nhibernate for enterpise application or developer nightmare for last 2 years we are using nhibernate as an enterprise infrastructure for a large scale application, but every time we upgrade it to the new version almost 50% of queries dose not work anymore, all queries need to be reviewed and test again. it seems nhibernate product bug instead of feature. I wonder how many developer have the same problem. the team is tired, what shall we do.",2
7084467,08/16/2011 20:19:58,895557,08/15/2011 20:12:39,1,0,NHibernate Dynamic Objects,"To our UI application allows dynamic integration of SQL procedures. A user can add new reports by specifying the SQL procedure. Currently we are using data table to bind data grid.

Is there a way I can use NHibernate to generate the objects dynamically? We have the mapping information (Column Names and Data Type) while configuring the new procedure.",nhibernate,object,,,,,open,0,58,3,"NHibernate Dynamic Objects To our UI application allows dynamic integration of SQL procedures. A user can add new reports by specifying the SQL procedure. Currently we are using data table to bind data grid.

Is there a way I can use NHibernate to generate the objects dynamically? We have the mapping information (Column Names and Data Type) while configuring the new procedure.",2
1782193,11/23/2009 10:06:54,112440,05/26/2009 08:27:16,75,10,nhibernate many to many association - property returns null set,"I have a many to many relationship between A and B. (I know I can consider refactoring etc, but that's another matter).
my Code does something like this:

    // given aId is the Id of an instance of A, and A has a many to many set of B's
        A a = myActiveSession.Get<A>(aId);
        a.Bs.Add(new B() {Name=""dave""});

and I get an exception because a.Bs is NULL.
this only happens in the context of a test suite, and when I run the single test I get a set and everything is ok.
I expect that since the default is lazy fetch, Bs will be initialized when I access the property getter, but if this fails I expect to get an exception, and not simply null... since this way I have no immediate clue what caused this. any ideas?",nhibernate,associations,many-to-many,,,,open,0,149,10,"nhibernate many to many association - property returns null set I have a many to many relationship between A and B. (I know I can consider refactoring etc, but that's another matter).
my Code does something like this:

    // given aId is the Id of an instance of A, and A has a many to many set of B's
        A a = myActiveSession.Get<A>(aId);
        a.Bs.Add(new B() {Name=""dave""});

and I get an exception because a.Bs is NULL.
this only happens in the context of a test suite, and when I run the single test I get a set and everything is ok.
I expect that since the default is lazy fetch, Bs will be initialized when I access the property getter, but if this fails I expect to get an exception, and not simply null... since this way I have no immediate clue what caused this. any ideas?",3
9505581,02/29/2012 19:44:32,250686,01/14/2010 11:48:35,112,2,Fluently map assemblies/entities at run time,"Simple question for I bet a not so simple answer.

Think of a project like Wordpress. The base of Wordpress is great and the developers built it to be extended with widgets or plugins etc.

Now think NHibernate, specifically with Fluent Mappings.

Put them together and you have a great and stable ""base"" system BUT how do you load mappings presented from external assemblies? I realize that the system would have to load the Assemblies on the fly using reflection but how do you configure nHibernate, Fluently, at first run to realize that there are extra entities to be loaded from those assemblies? How do you reference them?

I know you can;t add Mappings at run-time after the configurations is made, well you have to recreate the SessionFactory. This is why I want to load all required entities at runtime.

I also know that this can be somewhat accomplished with Dependancy Injection but I do not wish to go that route nor want the extreme baggage that comes with it. 

If the plain old nHiberante config file can be modified and then referenced at runtime to reflect new Entities I can only assume there has to be a way to do it Fluently.

Also, based on answers: do you make the configuration from the base project or a DATA ACCESS assembly?

Thanks for your help.

",nhibernate,reference,fluent-nhibernate,nhibernate-mapping,,,open,0,218,6,"Fluently map assemblies/entities at run time Simple question for I bet a not so simple answer.

Think of a project like Wordpress. The base of Wordpress is great and the developers built it to be extended with widgets or plugins etc.

Now think NHibernate, specifically with Fluent Mappings.

Put them together and you have a great and stable ""base"" system BUT how do you load mappings presented from external assemblies? I realize that the system would have to load the Assemblies on the fly using reflection but how do you configure nHibernate, Fluently, at first run to realize that there are extra entities to be loaded from those assemblies? How do you reference them?

I know you can;t add Mappings at run-time after the configurations is made, well you have to recreate the SessionFactory. This is why I want to load all required entities at runtime.

I also know that this can be somewhat accomplished with Dependancy Injection but I do not wish to go that route nor want the extreme baggage that comes with it. 

If the plain old nHiberante config file can be modified and then referenced at runtime to reflect new Entities I can only assume there has to be a way to do it Fluently.

Also, based on answers: do you make the configuration from the base project or a DATA ACCESS assembly?

Thanks for your help.

",4
4895083,02/04/2011 06:09:41,95012,04/23/2009 14:49:27,526,48,How would I prevent nhibernate from creating left outer joins for each subclass,"
When querying a base class NHibernate will create a left outer join for each of the base's subclasses. This happens even if the query is on properties only in the base and projections are set on those properties.

Example:

    SELECT this_.Id as y0_, this_.Name as y1_ FROM AnimalBase this_ 
        left outer join Dog this_1_ on this_.Id=this_1_.AnimalBaseFK 
        left outer join Cat this_2_ on this_.Id=this_2_.AnimalBaseFK 
    WHERE lower(this_.Name) like @p0;@p0 = '%rover%'

My question is how should I change this default behavior?

Thanks",nhibernate,inheritance,criteria,,,,open,0,100,13,"How would I prevent nhibernate from creating left outer joins for each subclass 
When querying a base class NHibernate will create a left outer join for each of the base's subclasses. This happens even if the query is on properties only in the base and projections are set on those properties.

Example:

    SELECT this_.Id as y0_, this_.Name as y1_ FROM AnimalBase this_ 
        left outer join Dog this_1_ on this_.Id=this_1_.AnimalBaseFK 
        left outer join Cat this_2_ on this_.Id=this_2_.AnimalBaseFK 
    WHERE lower(this_.Name) like @p0;@p0 = '%rover%'

My question is how should I change this default behavior?

Thanks",3
1840649,12/03/2009 15:30:11,68183,02/19/2009 03:16:03,1858,0,Converting this method from IList to IQueryable,"Is it possible to convert:

 public IList<T> Get()
        {
            return Session.CreateCriteria(typeof(T)).List<T>();
        }


to return IQueryable?

What is the difference between IList and IQueryable?",nhibernate,collections,,,,,open,0,46,7,"Converting this method from IList to IQueryable Is it possible to convert:

 public IList<T> Get()
        {
            return Session.CreateCriteria(typeof(T)).List<T>();
        }


to return IQueryable?

What is the difference between IList and IQueryable?",2
478715,01/26/2009 02:42:31,17510,09/18/2008 10:26:18,79,4,NHibernate Query Help,"I have the following code which works fine.
However, I only want to return rows where eventID = 5;
Where can I add criteria to this query? 


    tx = session.BeginTransaction();

            List<Catergory> Catergories;

            using (tx)
            {
                Catergories = (List<Catergory>)session.CreateCriteria(typeof(Catergory)).AddOrder(Order.Asc(""catergoryType"")).List<Catergory>();
                
                tx.Commit();
            }

            return Catergories;

Any help much appreciated.
",nhibernate,hibernate,,,,,open,0,148,3,"NHibernate Query Help I have the following code which works fine.
However, I only want to return rows where eventID = 5;
Where can I add criteria to this query? 


    tx = session.BeginTransaction();

            List<Catergory> Catergories;

            using (tx)
            {
                Catergories = (List<Catergory>)session.CreateCriteria(typeof(Catergory)).AddOrder(Order.Asc(""catergoryType"")).List<Catergory>();
                
                tx.Commit();
            }

            return Catergories;

Any help much appreciated.
",2
8963267,01/22/2012 18:02:44,1163720,01/22/2012 17:59:07,1,0,database design bigger table vs split table have the same col,"i have a database program for store as you know there is too type of invoice in it one for the thing i bought and the other for me when i sold them the two table is almost identical like
 
invoice table
Id
customerName
date
invoiceType
 
and invoiceDetails which have
id 
invoiceId
item
price
amount
 
my question is simple its what best to keep the design like that or split every table for two sperate tabels
couple of my friend suggest splitting the tables as one for saleInvoice and the other for buyInvoice to speed the time for querying
so whats the pro and con of every abrouch i feel that if i split them its like i dont follow DRY rule
i am using Nhibernate BTW so its kindda weird to have to identical class with different names",nhibernate,database-design,orm,relational-database,,,open,0,128,11,"database design bigger table vs split table have the same col i have a database program for store as you know there is too type of invoice in it one for the thing i bought and the other for me when i sold them the two table is almost identical like
 
invoice table
Id
customerName
date
invoiceType
 
and invoiceDetails which have
id 
invoiceId
item
price
amount
 
my question is simple its what best to keep the design like that or split every table for two sperate tabels
couple of my friend suggest splitting the tables as one for saleInvoice and the other for buyInvoice to speed the time for querying
so whats the pro and con of every abrouch i feel that if i split them its like i dont follow DRY rule
i am using Nhibernate BTW so its kindda weird to have to identical class with different names",4
3063663,06/17/2010 16:40:56,254873,01/20/2010 12:28:35,15,0,many-to-many join table discriminator?,"I'm trying to link a Communication object I've created that has 2 properties ""SuccessRecipientList"" and ""FailRecipientList"" to a Users object, via joining table ""Communication_Recipients"". I'd like to do this using a discriminator on the joining table instead of creating an actual domain object for it (Using the HasFailed Bit column on the join table) Does anyone know if this can be done?

Communication HBM:

    <hibernate-mapping xmlns=""urn:nhibernate-mapping-2.2"" assembly=""DataLogic"" namespace=""DataLogic.Domain"">
      <class name=""DataLogic.Domain.Communication, DataLogic"" table=""Communications"" >
        <id name=""Id"" column=""Id"" type=""Int32"" unsaved-value=""0"">
          <generator class=""identity""></generator>
        </id>
        ...
        <set name=""SuccessRecipientList"" table=""Communication_Recipients"" lazy=""true"">
          <key column=""Communication_ID""></key>
          <many-to-many class=""MilkroundOnline.OnlineApplications.DataLogic.Domain.User, MilkroundOnline.OnlineApplications.DataLogic"" column=""User_ID""></many-to-many>
        </set>
        <set name=""FailedRecipientList"" table=""Communication_Recipients"" lazy=""true"" where="""" >
          <key column=""Communication_ID""></key>      
          <many-to-many class=""MilkroundOnline.OnlineApplications.DataLogic.Domain.User, MilkroundOnline.OnlineApplications.DataLogic"" column=""User_ID""></many-to-many>
        </set>
      </class>
    </hibernate-mapping>


The DB looks like:

Communication Table
-------------------
ID,  
Subject,  
Body  


User Table
----------
ID,   
Firstname,   
Lastname  



CommunicationUser Table
-----------------------
CommunicationId,   
UserId,  
HasFailed(Bit) 

   
Thanks in advance for any help!  
Rob",nhibernate,mapping,many-to-many,,,,open,0,259,4,"many-to-many join table discriminator? I'm trying to link a Communication object I've created that has 2 properties ""SuccessRecipientList"" and ""FailRecipientList"" to a Users object, via joining table ""Communication_Recipients"". I'd like to do this using a discriminator on the joining table instead of creating an actual domain object for it (Using the HasFailed Bit column on the join table) Does anyone know if this can be done?

Communication HBM:

    <hibernate-mapping xmlns=""urn:nhibernate-mapping-2.2"" assembly=""DataLogic"" namespace=""DataLogic.Domain"">
      <class name=""DataLogic.Domain.Communication, DataLogic"" table=""Communications"" >
        <id name=""Id"" column=""Id"" type=""Int32"" unsaved-value=""0"">
          <generator class=""identity""></generator>
        </id>
        ...
        <set name=""SuccessRecipientList"" table=""Communication_Recipients"" lazy=""true"">
          <key column=""Communication_ID""></key>
          <many-to-many class=""MilkroundOnline.OnlineApplications.DataLogic.Domain.User, MilkroundOnline.OnlineApplications.DataLogic"" column=""User_ID""></many-to-many>
        </set>
        <set name=""FailedRecipientList"" table=""Communication_Recipients"" lazy=""true"" where="""" >
          <key column=""Communication_ID""></key>      
          <many-to-many class=""MilkroundOnline.OnlineApplications.DataLogic.Domain.User, MilkroundOnline.OnlineApplications.DataLogic"" column=""User_ID""></many-to-many>
        </set>
      </class>
    </hibernate-mapping>


The DB looks like:

Communication Table
-------------------
ID,  
Subject,  
Body  


User Table
----------
ID,   
Firstname,   
Lastname  



CommunicationUser Table
-----------------------
CommunicationId,   
UserId,  
HasFailed(Bit) 

   
Thanks in advance for any help!  
Rob",3
7116489,08/19/2011 02:58:15,744845,05/09/2011 09:14:09,1,0,FluentNHibernate or NHibernate Mapping by Code,"I have tested with FNH and NH mapping by code, it works fine too. Just with simple test, I still not identify pros & cons for each one. Any master there, could you show me some information?",nhibernate,mapping-by-code,,,,08/20/2011 01:37:34,not a real question,1,37,6,"FluentNHibernate or NHibernate Mapping by Code I have tested with FNH and NH mapping by code, it works fine too. Just with simple test, I still not identify pros & cons for each one. Any master there, could you show me some information?",2
4901947,02/04/2011 19:09:37,272274,02/13/2010 04:49:12,59,1,nHibernate Exception: Unable to cast object of type ,"I am running into an nHibernate error while saving an object. 

The classes involved are :

          interface IHardwareSpecification
        {
         //fields and methods
        } 
        public class CPUSpecification : IHardwareSpecification
        {
         //fields and methods
         }
    
    
      public class SystemTransaction 
       
     {       
          //Bunch of other fields
    
            private IHardwareSpecification _specs;
            public virtual IHardwareSpecification Specification 
            { 
                get { return _specs; }
                set { _specs = value;} 
            }
        }

   
   


   


**Mapping:**

         <hibernate-mapping xmlns=""urn:nhibernate-mapping-2.2""
            ...............>
        
          <class name=""SystemTransaction"" table=""SystemTransactions"" lazy=""false"">
            
           <component access=""field.camelcase-underscore"" name=""Specification""    class=""HardwareMarketplace.Model.CPUSpecification"">
              <property access=""field.camelcase-underscore"" column=""Specification_Rate"" name=""Rate""/>
             .....
         </component>
      </class>
    </hibernate-mapping >


While persisting the object to database via Save, I get the following error:

**Exception: Unable to cast object of type 'Castle.Proxies.IHardwareSpecificationProxy' to type 'Hardwaremarketplace.Model.SystemTransactions.CPUSpecification'.**



I am trying to figure out how to resolve this so any help will be appreciated. 

Thanks,
",nhibernate,object-persistence,,,,,open,0,421,9,"nHibernate Exception: Unable to cast object of type  I am running into an nHibernate error while saving an object. 

The classes involved are :

          interface IHardwareSpecification
        {
         //fields and methods
        } 
        public class CPUSpecification : IHardwareSpecification
        {
         //fields and methods
         }
    
    
      public class SystemTransaction 
       
     {       
          //Bunch of other fields
    
            private IHardwareSpecification _specs;
            public virtual IHardwareSpecification Specification 
            { 
                get { return _specs; }
                set { _specs = value;} 
            }
        }

   
   


   


**Mapping:**

         <hibernate-mapping xmlns=""urn:nhibernate-mapping-2.2""
            ...............>
        
          <class name=""SystemTransaction"" table=""SystemTransactions"" lazy=""false"">
            
           <component access=""field.camelcase-underscore"" name=""Specification""    class=""HardwareMarketplace.Model.CPUSpecification"">
              <property access=""field.camelcase-underscore"" column=""Specification_Rate"" name=""Rate""/>
             .....
         </component>
      </class>
    </hibernate-mapping >


While persisting the object to database via Save, I get the following error:

**Exception: Unable to cast object of type 'Castle.Proxies.IHardwareSpecificationProxy' to type 'Hardwaremarketplace.Model.SystemTransactions.CPUSpecification'.**



I am trying to figure out how to resolve this so any help will be appreciated. 

Thanks,
",2
1275725,08/14/2009 02:20:59,2849,08/25/2008 14:24:20,1159,39,Restrictions.Disjunction() between condition a AND condition b OR condition c AND condition d,"How can I create a disjunction in NHibernate that would accomplish the following sql:

> Select * from MyTable<br>
> Where (conditionA = true AND conditionB = true) <br>
> OR (conditionC = true AND conditionD = true)

From what I've seen, the Disjuntion() takes single criterions and ""ORs"" them together. Is it possible to group to criterion together and ""OR"" it against another pair of criterion?

I hope this question is clear enough.

Thanks!",nhibernate,detachedcriteria,,,,,open,0,69,13,"Restrictions.Disjunction() between condition a AND condition b OR condition c AND condition d How can I create a disjunction in NHibernate that would accomplish the following sql:

> Select * from MyTable<br>
> Where (conditionA = true AND conditionB = true) <br>
> OR (conditionC = true AND conditionD = true)

From what I've seen, the Disjuntion() takes single criterions and ""ORs"" them together. Is it possible to group to criterion together and ""OR"" it against another pair of criterion?

I hope this question is clear enough.

Thanks!",2
1027814,06/22/2009 15:22:51,119406,06/08/2009 19:28:15,31,2,Loading tables dynamically with NHibernate,"I'm working on a project that requires me to load tables based on table names stored in another table.  More tables will be added to the DB (and by someone else), so creating NHibernate mapping files for each table isn't an option.  

Does anyone know if it is possible to load tables dynamically using NHibernate?   ",nhibernate,,,,,,open,0,60,5,"Loading tables dynamically with NHibernate I'm working on a project that requires me to load tables based on table names stored in another table.  More tables will be added to the DB (and by someone else), so creating NHibernate mapping files for each table isn't an option.  

Does anyone know if it is possible to load tables dynamically using NHibernate?   ",1
467276,01/21/2009 22:20:57,17847,09/18/2008 15:27:47,1317,62,How do I map a one-to-one association with NHibernate using foreign key generator?,"So far the association works fine (the `User` class loads the appropriate `UserRoles` instance when present), but when creating a new `User` and setting its `Roles` property to a new instance of `UserRoles`, the `UserRoles` object is not saved.

Here is my abridged User.hbm.xml:

    <?xml version=""1.0"" encoding=""utf-8"" ?>
    <hibernate-mapping xmlns=""urn:nhibernate-mapping-2.2"">
      <class name=""DistrictObservations.User, DistrictObservations"" table=""users"">
        <cache usage=""read-write"" region=""all"" />
    
        <id name=""ID"" column=""id"" type=""int"" unsaved-value=""0"">
          <generator class=""identity"" />
        </id>
    
        <!-- snip -->
   
        <one-to-one name=""Roles"" class=""DistrictObservations.UserRoles, DistrictObservations"" lazy=""false"" />
    
      </class>
    </hibernate-mapping>

And here is the UserRoles mapping:

    <?xml version=""1.0"" encoding=""utf-8"" ?>
    <hibernate-mapping xmlns=""urn:nhibernate-mapping-2.2"">
      <class name=""DistrictObservations.UserRoles, DistrictObservations"" table=""user_roles"">
        <cache usage=""read-write"" region=""all"" />
        
        <id name=""UserID"" column=""user_id"" type=""int"" >
          <generator class=""foreign"">
            <param name=""property"">User</param>
          </generator>
        </id>
    
        <!-- snip -->
    
        <one-to-one name=""User"" class=""DistrictObservations.User, DistrictObservations"" lazy=""false"" constrained=""true"" foreign-key=""FK_user_roles_users"" />
    
      </class>
    </hibernate-mapping>

Anyone got an idea how to have the UserRoles object saved with the User.ID as its primary key?  I've been looking at the documentation, and to be honest, it is not particularly helpful.
",nhibernate,object-relational-mapping,foreign-keys,.net,,,open,0,334,13,"How do I map a one-to-one association with NHibernate using foreign key generator? So far the association works fine (the `User` class loads the appropriate `UserRoles` instance when present), but when creating a new `User` and setting its `Roles` property to a new instance of `UserRoles`, the `UserRoles` object is not saved.

Here is my abridged User.hbm.xml:

    <?xml version=""1.0"" encoding=""utf-8"" ?>
    <hibernate-mapping xmlns=""urn:nhibernate-mapping-2.2"">
      <class name=""DistrictObservations.User, DistrictObservations"" table=""users"">
        <cache usage=""read-write"" region=""all"" />
    
        <id name=""ID"" column=""id"" type=""int"" unsaved-value=""0"">
          <generator class=""identity"" />
        </id>
    
        <!-- snip -->
   
        <one-to-one name=""Roles"" class=""DistrictObservations.UserRoles, DistrictObservations"" lazy=""false"" />
    
      </class>
    </hibernate-mapping>

And here is the UserRoles mapping:

    <?xml version=""1.0"" encoding=""utf-8"" ?>
    <hibernate-mapping xmlns=""urn:nhibernate-mapping-2.2"">
      <class name=""DistrictObservations.UserRoles, DistrictObservations"" table=""user_roles"">
        <cache usage=""read-write"" region=""all"" />
        
        <id name=""UserID"" column=""user_id"" type=""int"" >
          <generator class=""foreign"">
            <param name=""property"">User</param>
          </generator>
        </id>
    
        <!-- snip -->
    
        <one-to-one name=""User"" class=""DistrictObservations.User, DistrictObservations"" lazy=""false"" constrained=""true"" foreign-key=""FK_user_roles_users"" />
    
      </class>
    </hibernate-mapping>

Anyone got an idea how to have the UserRoles object saved with the User.ID as its primary key?  I've been looking at the documentation, and to be honest, it is not particularly helpful.
",4
6596784,07/06/2011 13:01:30,813906,06/24/2011 10:35:35,58,0,nHibernate custom membership/role provider -,"I am trying to create a custom membership and role provider. The code for this seems to be fine, but when I try to go to the Security section of the Web Site Administration Tool, I get the following:

> The invoked member is not supported in
> a dynamic assembly.

In reference to the first line of the first bit of NHibernate-related code that is called:

    var cfg = new Configuration();

I have the providers in the App_Code folder and the NHibernate DLLs are copied to the Bin folder on execution of the application.
",nhibernate,,,,,03/12/2012 09:41:07,too localized,1,94,5,"nHibernate custom membership/role provider - I am trying to create a custom membership and role provider. The code for this seems to be fine, but when I try to go to the Security section of the Web Site Administration Tool, I get the following:

> The invoked member is not supported in
> a dynamic assembly.

In reference to the first line of the first bit of NHibernate-related code that is called:

    var cfg = new Configuration();

I have the providers in the App_Code folder and the NHibernate DLLs are copied to the Bin folder on execution of the application.
",1
8901217,01/17/2012 20:22:48,525278,11/30/2010 14:27:24,300,5,Linq to Nhibernate strange behaivour,"I have a table fill query, which have to get all references entites. 

I have Client:

       public class Client 
        {
                public virtual int Id { get; set; }
            
                public virtual ICollection<Address> Addresses { get; protected set; }
    
                public virtual Address CurrentAddress { get; set; }
        }

Address

    public class Address 
    {
                public virtual int Id { get; set; }
        
                public virtual string Address1 { get; set; }      
        
                public virtual string City { get; set; }
        
                public virtual string ZipCode { get; set; }
    }

and DB diagramma![enter image description here][1]

I want get all users Addresses by Linq to Nhibernate:

    ClientRepository.Where(x => x.Id == clientId).ToList().SelectMany(c => c.Addresses ).ToList();

But I got this Query:

    SELECT TOP (20 /* @p0 */) Id31_,
                     Address2_31_,
                     Address3_31_,
                     City31_,                
                     ZipCode31_
    FROM   (select address2_.Id                                    as Id31_,
                   address2_.Address1                              as Address2_31_,
                   address2_.Address2                              as Address3_31_,
                   address2_.City                                  as City31_,               
                   address2_.ZipCode                               as ZipCode31_,
                   ROW_NUMBER() OVER( ORDER BY address2_.Address1) as __hibernate_sort_row
            from   CLIENTS client0_
                   inner join AddressToClient addresshis1_
                     on client0_.Id = addresshis1_.ClientId
                   inner join ADDRESSES address2_
                     on addresshis1_.AddressId = address2_.Id
            where  address2_.Id = 2 /* @p1 */) as query
    WHERE  query.__hibernate_sort_row > 0 /* @p2 */
    ORDER  BY query.__hibernate_sort_row

Where query filters by **id = address2_.Id** not client id. 

Why search appears by address Id not Client? 
  [1]: http://i.stack.imgur.com/woJJt.png",nhibernate,linq-to-nhibernate,conform,,,,open,0,862,5,"Linq to Nhibernate strange behaivour I have a table fill query, which have to get all references entites. 

I have Client:

       public class Client 
        {
                public virtual int Id { get; set; }
            
                public virtual ICollection<Address> Addresses { get; protected set; }
    
                public virtual Address CurrentAddress { get; set; }
        }

Address

    public class Address 
    {
                public virtual int Id { get; set; }
        
                public virtual string Address1 { get; set; }      
        
                public virtual string City { get; set; }
        
                public virtual string ZipCode { get; set; }
    }

and DB diagramma![enter image description here][1]

I want get all users Addresses by Linq to Nhibernate:

    ClientRepository.Where(x => x.Id == clientId).ToList().SelectMany(c => c.Addresses ).ToList();

But I got this Query:

    SELECT TOP (20 /* @p0 */) Id31_,
                     Address2_31_,
                     Address3_31_,
                     City31_,                
                     ZipCode31_
    FROM   (select address2_.Id                                    as Id31_,
                   address2_.Address1                              as Address2_31_,
                   address2_.Address2                              as Address3_31_,
                   address2_.City                                  as City31_,               
                   address2_.ZipCode                               as ZipCode31_,
                   ROW_NUMBER() OVER( ORDER BY address2_.Address1) as __hibernate_sort_row
            from   CLIENTS client0_
                   inner join AddressToClient addresshis1_
                     on client0_.Id = addresshis1_.ClientId
                   inner join ADDRESSES address2_
                     on addresshis1_.AddressId = address2_.Id
            where  address2_.Id = 2 /* @p1 */) as query
    WHERE  query.__hibernate_sort_row > 0 /* @p2 */
    ORDER  BY query.__hibernate_sort_row

Where query filters by **id = address2_.Id** not client id. 

Why search appears by address Id not Client? 
  [1]: http://i.stack.imgur.com/woJJt.png",3
2312563,02/22/2010 17:00:08,173317,09/14/2009 18:38:27,37,0,NHibernate Lazy Initialized collection on WCF Wire,"My object looks something like this:
class
{
int a;
object b;
IList<string> c;
}

All the fields are getting populated from the database and the collection is getting lazy initialization which is desirable.
Now, my problem is that I want to send this object to the  web service. But since the collection is lazily loaded, am not able to do it. Can somebody please give me an idea or a direction or some example code which I can look into for my problem.

Thanks.",nhibernate,lazy-loading,collections,,,,open,0,77,7,"NHibernate Lazy Initialized collection on WCF Wire My object looks something like this:
class
{
int a;
object b;
IList<string> c;
}

All the fields are getting populated from the database and the collection is getting lazy initialization which is desirable.
Now, my problem is that I want to send this object to the  web service. But since the collection is lazily loaded, am not able to do it. Can somebody please give me an idea or a direction or some example code which I can look into for my problem.

Thanks.",3
3879795,10/07/2010 08:12:17,126015,06/19/2009 22:39:19,476,5,Are nhibernate entities part of the BL?,"I am looking for the right n-tier modal to adapt to my new nhibernate project. I am quite new to it. I currently have several entities and their corrosponding mapping classes. I can't seem to figure if the entities should act as the BL level classes, or merly an object oriented part of my DAL.

Can anyone help shed light on this?

Thank you.",nhibernate,,,,,,open,0,62,7,"Are nhibernate entities part of the BL? I am looking for the right n-tier modal to adapt to my new nhibernate project. I am quite new to it. I currently have several entities and their corrosponding mapping classes. I can't seem to figure if the entities should act as the BL level classes, or merly an object oriented part of my DAL.

Can anyone help shed light on this?

Thank you.",1
1228146,08/04/2009 15:22:54,61654,02/02/2009 20:02:32,606,28,NHibernate QuerySyntaxException,"I am following along with the [Summer of NHibernate Screencast Series][1] and am running into a strange NHibernate Exception.

    NHibernate.Hql.Ast.ANTLR.QuerySyntaxException:
    Exception of type
    'Antlr.Runtime.NoViableAltException' was thrown.
    [select from DataTransfer.Person p where p.FirstName=:fn].

I have deviated from the Screencast Series in the following ways:

 1. Running against an MS SQL Server Compact Database
 2. I am using MSTest instead of MbUnit

I've tried any number of combination of queries always with the same result. My present CreateQuery syntax

    public IList<Person> GetPersonsByFirstName(string firstName)
    {
        ISession session = GetSession();

        return session.CreateQuery(""select from Person p "" +
            ""where p.FirstName=:fn"").SetString(""fn"", firstName)
            .List<Person>();
    }

While not a direct query this method works

    public Person GetPersonById(int personId)
    {
        ISession session = GetSession();
        return session.Get<Person>(personId);
    }

My *hibernate.cfg.xml*

    <?xml version=""1.0"" encoding=""utf-8"" ?>
    <hibernate-configuration xmlns=""urn:nhibernate-configuration-2.2"">
      <session-factory name=""BookDb"">
        <property name=""connection.provider"">NHibernate.Connection.DriverConnectionProvider</property>
        <property name=""connection.driver_class"">NHibernate.Driver.SqlServerCeDriver</property>
        <property name=""dialect"">NHibernate.Dialect.MsSqlCeDialect</property>
        <property name=""connection.connection_string"">Data Source=C:\Code\BookCollection\DataAccessLayer\BookCollectionDb.sdf</property>
        <property name=""show_sql"">true</property>
        <property name=""proxyfactory.factory_class"">NHibernate.ByteCode.Castle.ProxyFactoryFactory, NHibernate.ByteCode.Castle</property>
        <mapping assembly=""DataTransfer""/>
      </session-factory>
    </hibernate-configuration>

*Person.hbm.xml*

    <?xml version=""1.0"" encoding=""utf-8"" ?>
    <hibernate-mapping xmlns=""urn:nhibernate-mapping-2.2"" assembly=""DataTransfer"" namespace=""DataTransfer"">
      <class name=""DataTransfer.Person,DataTransfer"" table=""Person"">
        <id name=""PersonId"" column=""PersonId"" type=""Int32"" unsaved-value=""0"">
          <generator class=""native""/>
        </id>
        <property name=""FirstName"" column=""FirstName"" type=""String"" length=""50"" not-null=""false"" />
        <property name=""LastName"" column=""LastName"" type=""String"" length=""50"" not-null=""false"" />
      </class>
    </hibernate-mapping>

  [1]: http://www.summerofnhibernate.com/",nhibernate,exception,,,,,open,0,384,2,"NHibernate QuerySyntaxException I am following along with the [Summer of NHibernate Screencast Series][1] and am running into a strange NHibernate Exception.

    NHibernate.Hql.Ast.ANTLR.QuerySyntaxException:
    Exception of type
    'Antlr.Runtime.NoViableAltException' was thrown.
    [select from DataTransfer.Person p where p.FirstName=:fn].

I have deviated from the Screencast Series in the following ways:

 1. Running against an MS SQL Server Compact Database
 2. I am using MSTest instead of MbUnit

I've tried any number of combination of queries always with the same result. My present CreateQuery syntax

    public IList<Person> GetPersonsByFirstName(string firstName)
    {
        ISession session = GetSession();

        return session.CreateQuery(""select from Person p "" +
            ""where p.FirstName=:fn"").SetString(""fn"", firstName)
            .List<Person>();
    }

While not a direct query this method works

    public Person GetPersonById(int personId)
    {
        ISession session = GetSession();
        return session.Get<Person>(personId);
    }

My *hibernate.cfg.xml*

    <?xml version=""1.0"" encoding=""utf-8"" ?>
    <hibernate-configuration xmlns=""urn:nhibernate-configuration-2.2"">
      <session-factory name=""BookDb"">
        <property name=""connection.provider"">NHibernate.Connection.DriverConnectionProvider</property>
        <property name=""connection.driver_class"">NHibernate.Driver.SqlServerCeDriver</property>
        <property name=""dialect"">NHibernate.Dialect.MsSqlCeDialect</property>
        <property name=""connection.connection_string"">Data Source=C:\Code\BookCollection\DataAccessLayer\BookCollectionDb.sdf</property>
        <property name=""show_sql"">true</property>
        <property name=""proxyfactory.factory_class"">NHibernate.ByteCode.Castle.ProxyFactoryFactory, NHibernate.ByteCode.Castle</property>
        <mapping assembly=""DataTransfer""/>
      </session-factory>
    </hibernate-configuration>

*Person.hbm.xml*

    <?xml version=""1.0"" encoding=""utf-8"" ?>
    <hibernate-mapping xmlns=""urn:nhibernate-mapping-2.2"" assembly=""DataTransfer"" namespace=""DataTransfer"">
      <class name=""DataTransfer.Person,DataTransfer"" table=""Person"">
        <id name=""PersonId"" column=""PersonId"" type=""Int32"" unsaved-value=""0"">
          <generator class=""native""/>
        </id>
        <property name=""FirstName"" column=""FirstName"" type=""String"" length=""50"" not-null=""false"" />
        <property name=""LastName"" column=""LastName"" type=""String"" length=""50"" not-null=""false"" />
      </class>
    </hibernate-mapping>

  [1]: http://www.summerofnhibernate.com/",2
2424144,03/11/2010 10:27:20,164297,08/27/2009 15:28:56,18,2,NHibernate config connection string info,"What's the best way to store connection string info?

I'd rather not just store the db password in NHib.config file.",nhibernate,connection,string,,,,open,0,19,5,"NHibernate config connection string info What's the best way to store connection string info?

I'd rather not just store the db password in NHib.config file.",3
360444,12/11/2008 18:50:58,45452,12/11/2008 18:34:31,1,0,NHibernate Transactions best practices,"I have been reading about nhibernate for a while and have been trying to use it for a site I'm implementing. I read the article by Billy McCafferty http://www.codeproject.com/KB/architecture/NHibernateBestPractices.aspx on NHibernate best practices but I did not see any indication on where is the best place to handle transactions. 

I thought of putting that code in the DAO but then I'm not sure how to handle cases in which more than 1 DAO is used. What are best places to put transaction code in your NHibernate Application? ",nhibernate,,,,,05/29/2012 06:17:03,not constructive,1,88,4,"NHibernate Transactions best practices I have been reading about nhibernate for a while and have been trying to use it for a site I'm implementing. I read the article by Billy McCafferty http://www.codeproject.com/KB/architecture/NHibernateBestPractices.aspx on NHibernate best practices but I did not see any indication on where is the best place to handle transactions. 

I thought of putting that code in the DAO but then I'm not sure how to handle cases in which more than 1 DAO is used. What are best places to put transaction code in your NHibernate Application? ",1
874981,05/17/2009 16:53:53,56256,01/17/2009 19:36:09,70,23,NHibernate Win Forms Session Management,"I have used NHibernate in web applications before. I must admit that I am still learning NHibernate and do not totally grasp the art of session management. So I would like to use NHibernate within a Win Forms application that I am writing. I hear that session management in a Forms application is a bit different. Sessions must be opened and closed on a conversation basis. Yes? Does anyone know of a good example of this? Or perhaps some cohesive documentation explaining session creation and tear down within a win32 app?

Thanks,

Nick",nhibernate,winforms,data-binding,,,,open,0,91,5,"NHibernate Win Forms Session Management I have used NHibernate in web applications before. I must admit that I am still learning NHibernate and do not totally grasp the art of session management. So I would like to use NHibernate within a Win Forms application that I am writing. I hear that session management in a Forms application is a bit different. Sessions must be opened and closed on a conversation basis. Yes? Does anyone know of a good example of this? Or perhaps some cohesive documentation explaining session creation and tear down within a win32 app?

Thanks,

Nick",3
2965413,06/03/2010 11:21:09,428859,05/27/2010 13:45:44,18,1,Nhibernate inserting with values on a bag,I am using a where clause on a bag to filter a bag. Is there any way to make nhibernate insert these filter values into the database?,nhibernate,,,,,,open,0,27,7,Nhibernate inserting with values on a bag I am using a where clause on a bag to filter a bag. Is there any way to make nhibernate insert these filter values into the database?,1
3557215,08/24/2010 13:58:42,44682,12/09/2008 17:33:52,1,0,Should an Entity ever know anything about its DAO?,"I have a chance to introduce NHibernate to my group by using it with some new components that are being added to a legacy application.  I'm trying to get my head around using the DAO pattern with NHibernate, and am stumped with an architectural question.

In my _fictional_ example, let's say I have CarDAO and a Car entity:

    public interface CarDAO {
        Car FindById(int id)
        ... // everything else
    }

    public interface Car {
        ... various properties and methods
    }

I have a need to be able to convert a car to right-hand drive. Since this would be a very complex operation, I need to execute a stored procedure.  I'm not clear on where the ConvertToRightHandDrive() method should go.

It makes sense to me to put the method on Car, and let it call a method on the CarDAO that will execute the stored procedure.  And this is where I'm not clear:

- should Car have a reference to the CarDAO and call CarDAO.ConvertToRightHandDrive?
- should there be some sort of CarService layer that calls CarDAO.ConvertToRightHandDrive?
- what about injecting the CarDAO through the method on Car (Car.ConvertToRightHandDrive(carDAO))
- some other option?

Perhaps this is only a religious argument, and people have differing opinions on whether or not an Entity should have a reference to its DAO (or any other DAO, for that matter). I've been searching StackOverflow for some time, and have seen several discussions around this topic; but, I'd be interested in people's opinions in this particular scenario.

",nhibernate,domain-driven-design,dao,,,,open,0,278,9,"Should an Entity ever know anything about its DAO? I have a chance to introduce NHibernate to my group by using it with some new components that are being added to a legacy application.  I'm trying to get my head around using the DAO pattern with NHibernate, and am stumped with an architectural question.

In my _fictional_ example, let's say I have CarDAO and a Car entity:

    public interface CarDAO {
        Car FindById(int id)
        ... // everything else
    }

    public interface Car {
        ... various properties and methods
    }

I have a need to be able to convert a car to right-hand drive. Since this would be a very complex operation, I need to execute a stored procedure.  I'm not clear on where the ConvertToRightHandDrive() method should go.

It makes sense to me to put the method on Car, and let it call a method on the CarDAO that will execute the stored procedure.  And this is where I'm not clear:

- should Car have a reference to the CarDAO and call CarDAO.ConvertToRightHandDrive?
- should there be some sort of CarService layer that calls CarDAO.ConvertToRightHandDrive?
- what about injecting the CarDAO through the method on Car (Car.ConvertToRightHandDrive(carDAO))
- some other option?

Perhaps this is only a religious argument, and people have differing opinions on whether or not an Entity should have a reference to its DAO (or any other DAO, for that matter). I've been searching StackOverflow for some time, and have seen several discussions around this topic; but, I'd be interested in people's opinions in this particular scenario.

",3
4301957,11/29/2010 08:24:59,215172,11/20/2009 03:36:07,31,9,When the nhibernate version 3 is available ?,When the nhibernate version 3 is available ? :),nhibernate,,,,,12/01/2010 06:13:40,too localized,1,9,8,When the nhibernate version 3 is available ? When the nhibernate version 3 is available ? :),1
11614930,07/23/2012 14:49:05,1546153,07/23/2012 14:46:33,1,0,Nhibernate combine two ICriterias?,Can I combine two Icriterias? I build one Icriteria and build another separately and want to join them together. ,nhibernate,icriteria,,,,07/23/2012 21:43:17,not a real question,1,20,4,Nhibernate combine two ICriterias? Can I combine two Icriterias? I build one Icriteria and build another separately and want to join them together. ,2
1934358,12/19/2009 22:55:09,76422,03/10/2009 23:38:50,396,21,Is it possible to do this in NHibernate without using CreateSQLQuery?,"Is it possible to do this in NHibernate without using CreateSQLQuery. Preferably with Linq To Nhibernate. The biggest question is how do I do joins not on a primary key?


    SELECT DISTINCT calEvent.* From CalendarEvent as calEvent
	LEFT JOIN UserChannelInteraction as channelInteraction on channelInteraction.ChannelToFollow_id = calEvent.Channel_id
	LEFT JOIN UserCalendarEventInteraction as eventInteraction on eventInteraction.CalendarEvent_id = calEvent.Id
	LEFT JOIN UserChannelInteraction as eventInteractionEvent on eventInteractionEvent.UserToFollow_id = eventInteraction.User_id
	WHERE (calEvent.Channel_id = @intMainChannelID 
	OR channelInteraction.User_id = @intUserID
	OR eventInteraction.User_id = @intUserID
	OR (eventInteractionEvent.User_id = @intUserID AND eventInteraction.Status = 'Accepted'))
	AND calEvent.StartDateTime >= @dtStartDate 
	AND calEvent.StartDateTime <= @dtEndDate
	ORDER BY calEvent.StartDateTime asc",nhibernate,,,,,,open,0,91,11,"Is it possible to do this in NHibernate without using CreateSQLQuery? Is it possible to do this in NHibernate without using CreateSQLQuery. Preferably with Linq To Nhibernate. The biggest question is how do I do joins not on a primary key?


    SELECT DISTINCT calEvent.* From CalendarEvent as calEvent
	LEFT JOIN UserChannelInteraction as channelInteraction on channelInteraction.ChannelToFollow_id = calEvent.Channel_id
	LEFT JOIN UserCalendarEventInteraction as eventInteraction on eventInteraction.CalendarEvent_id = calEvent.Id
	LEFT JOIN UserChannelInteraction as eventInteractionEvent on eventInteractionEvent.UserToFollow_id = eventInteraction.User_id
	WHERE (calEvent.Channel_id = @intMainChannelID 
	OR channelInteraction.User_id = @intUserID
	OR eventInteraction.User_id = @intUserID
	OR (eventInteractionEvent.User_id = @intUserID AND eventInteraction.Status = 'Accepted'))
	AND calEvent.StartDateTime >= @dtStartDate 
	AND calEvent.StartDateTime <= @dtEndDate
	ORDER BY calEvent.StartDateTime asc",1
4256237,11/23/2010 13:00:47,336271,05/08/2010 16:35:43,353,22,nhibernate inner join a table without a property in class,"i have the following model:

        
    public class FlatMap : ClassMap<Flat>
        {
            public FlatMap()
            {
                Id(m => m.FlatID).GeneratedBy.Identity();
                Map(m => m.Name);
                Map(m => m.Notes);
                Map(m => m.Released);
            }
    
        } 
    public class BuildingMap : ClassMap<Building>
    {
        public BuildingMap()
        {
            Id(i => i.BuildingID).GeneratedBy.Identity();
            Map(m => m.Name);
            HasMany<Flat>(m => m.Flats).Cascade.All().KeyColumn(""BuildingID"").Not.LazyLoad();
        }
    }

    public class ContractMap : ClassMap<Contract>
        {
            public ContractMap()
            {
                Id(m => m.ContractID).GeneratedBy.Identity();
                Map(m => m.Amount);
                Map(m => m.BeginIn);
                Map(m => m.EndIn);
                References(m => m.RentedFlat);
            }
        }



how can i make the following query using fluent nhibernate ?

    Select * From Contract 
    Inner Join Flat On Contract.RentedFlatID = Flat.ID
    Inner Join Building On Building.BuildingID = Flat.BuildingID
    Where Building.BuildingID = @p0

especially there no reference from Flat to Building?? and i don't want it to be !

of course the reference i am talking about in order to be able to do something like this

    var criteria = session.CreateCriteria<Contract>().CreateCriteria (""RentedFlat"").CreateCriteria (""Building""/*there is no such property in Flat class*/);",nhibernate,fluent-nhibernate,inner-join,sqlquery,,,open,0,478,10,"nhibernate inner join a table without a property in class i have the following model:

        
    public class FlatMap : ClassMap<Flat>
        {
            public FlatMap()
            {
                Id(m => m.FlatID).GeneratedBy.Identity();
                Map(m => m.Name);
                Map(m => m.Notes);
                Map(m => m.Released);
            }
    
        } 
    public class BuildingMap : ClassMap<Building>
    {
        public BuildingMap()
        {
            Id(i => i.BuildingID).GeneratedBy.Identity();
            Map(m => m.Name);
            HasMany<Flat>(m => m.Flats).Cascade.All().KeyColumn(""BuildingID"").Not.LazyLoad();
        }
    }

    public class ContractMap : ClassMap<Contract>
        {
            public ContractMap()
            {
                Id(m => m.ContractID).GeneratedBy.Identity();
                Map(m => m.Amount);
                Map(m => m.BeginIn);
                Map(m => m.EndIn);
                References(m => m.RentedFlat);
            }
        }



how can i make the following query using fluent nhibernate ?

    Select * From Contract 
    Inner Join Flat On Contract.RentedFlatID = Flat.ID
    Inner Join Building On Building.BuildingID = Flat.BuildingID
    Where Building.BuildingID = @p0

especially there no reference from Flat to Building?? and i don't want it to be !

of course the reference i am talking about in order to be able to do something like this

    var criteria = session.CreateCriteria<Contract>().CreateCriteria (""RentedFlat"").CreateCriteria (""Building""/*there is no such property in Flat class*/);",4
1552449,10/12/2009 02:41:07,133405,07/05/2009 17:43:52,18,6,NHibernate: Change from lazy=true to fetch=join brings back the world,"I have a User object/mapping in my application. Each user has a list of contact information (phone, email etc)

the mapping for the user contains:


    <bag name=""ContactInfo"" table=""contact_info"" lazy=""true"" cascade=""all"">
        <key column=""contact_id""/>
        <one-to-many class=""...ContactInfo, ...""/>
    </bag>

this works fine but i get the n+1 select problem so i need to optimize it a little bit. But for some reason, when I change this to a join and perform some db operation, NH starts updating ALL contact_info objects in the database. When i say db operation i dont mean changinf a contact. i mean anything. 

Anyone knows why? thx",nhibernate,nhibernate-mapping,,,,,open,0,116,10,"NHibernate: Change from lazy=true to fetch=join brings back the world I have a User object/mapping in my application. Each user has a list of contact information (phone, email etc)

the mapping for the user contains:


    <bag name=""ContactInfo"" table=""contact_info"" lazy=""true"" cascade=""all"">
        <key column=""contact_id""/>
        <one-to-many class=""...ContactInfo, ...""/>
    </bag>

this works fine but i get the n+1 select problem so i need to optimize it a little bit. But for some reason, when I change this to a join and perform some db operation, NH starts updating ALL contact_info objects in the database. When i say db operation i dont mean changinf a contact. i mean anything. 

Anyone knows why? thx",2
11394776,07/09/2012 12:12:02,52912,01/08/2009 12:52:23,754,22,How do I store a Serializable List<int> in FluentNhibernate,"If I have the following (cut down for brevity)

    public class TempCartMap : ClassMap<TempCart>
    {
       Id(x => x.Id).GeneratedBy.Identity();
       Map(x => x.Products); // < This one
    }
    
    [Serializable]
    public class TempCart {
    
      public TempCart(){
        Products = new List<int>();
      }
    
      public virtual IList<int> Products { get; set; }
    
    }



I've looked at ([http://www.philliphaydon.com/2012/06/using-nhibernate-with-servicestack/][1]) and ([http://www.philliphaydon.com/2012/03/ormlite-blobbing-done-with-nhibernate-and-serialized-json/][2]) but is there a shorter, simpler, faster way of getting NHibernate to Serialize & De-serialize a column as above. 
Seems overkill to create a new IUserType class etc etc.



  [1]: http://www.philliphaydon.com/2012/06/using-nhibernate-with-servicestack/
  [2]: http://www.philliphaydon.com/2012/03/ormlite-blobbing-done-with-nhibernate-and-serialized-json/",nhibernate,fluent-nhibernate,fluent-nhibernate-mapping,,,,open,0,155,9,"How do I store a Serializable List<int> in FluentNhibernate If I have the following (cut down for brevity)

    public class TempCartMap : ClassMap<TempCart>
    {
       Id(x => x.Id).GeneratedBy.Identity();
       Map(x => x.Products); // < This one
    }
    
    [Serializable]
    public class TempCart {
    
      public TempCart(){
        Products = new List<int>();
      }
    
      public virtual IList<int> Products { get; set; }
    
    }



I've looked at ([http://www.philliphaydon.com/2012/06/using-nhibernate-with-servicestack/][1]) and ([http://www.philliphaydon.com/2012/03/ormlite-blobbing-done-with-nhibernate-and-serialized-json/][2]) but is there a shorter, simpler, faster way of getting NHibernate to Serialize & De-serialize a column as above. 
Seems overkill to create a new IUserType class etc etc.



  [1]: http://www.philliphaydon.com/2012/06/using-nhibernate-with-servicestack/
  [2]: http://www.philliphaydon.com/2012/03/ormlite-blobbing-done-with-nhibernate-and-serialized-json/",3
5099457,02/24/2011 01:40:00,296923,05/10/2009 18:19:21,719,42,iBatis / MyBatis opinion,"What is your opinion on iBatis / MyBatis? With respect to performance and flexibility.

How do you think it stacks up against other C# ORMs?

Is the C# version pretty stable and usable? Does caching work well?",nhibernate,orm,ibatis,mybatis,,12/09/2011 18:54:51,not constructive,1,35,4,"iBatis / MyBatis opinion What is your opinion on iBatis / MyBatis? With respect to performance and flexibility.

How do you think it stacks up against other C# ORMs?

Is the C# version pretty stable and usable? Does caching work well?",4
658168,03/18/2009 12:59:21,68631,02/19/2009 21:28:35,6,0,Linq to nHibernate,"So the nHibernate 2.1 Alpha came out a few days ago, but the announcement on sourceforge doesn't mention the additional features. In particular, it doesn't mention whether LINQ is included. I know that I've read that LINQ would be part of 2.1, but that was 6 months ago. Anybody know if LINQ is in 2.1 or what new features are? There's no documenation about 2.1 alpha features on the official site.",nhibernate,linq,,,,,open,0,71,3,"Linq to nHibernate So the nHibernate 2.1 Alpha came out a few days ago, but the announcement on sourceforge doesn't mention the additional features. In particular, it doesn't mention whether LINQ is included. I know that I've read that LINQ would be part of 2.1, but that was 6 months ago. Anybody know if LINQ is in 2.1 or what new features are? There's no documenation about 2.1 alpha features on the official site.",2
6815591,07/25/2011 11:46:07,309973,04/06/2010 11:39:36,79,7,Best ORM tool with MVC ?,"we are about to start working on an application , on MVC 3, with sql server 2008. We are planning to use ORM tool in the project. we have go through several tools, like LLBL , EF etc. 
I want help to decide which one is better and more reliable. 

<ul>
<li> Entity Framework</li>
<li> nHiberante /Fluent nHibernate</li>
<li> LLBL</li>
<li> nHydrate</li>
</ul>

Thanks
",nhibernate,entity-framework,orm,fluent-nhibernate,,07/25/2011 12:49:11,not constructive,1,58,6,"Best ORM tool with MVC ? we are about to start working on an application , on MVC 3, with sql server 2008. We are planning to use ORM tool in the project. we have go through several tools, like LLBL , EF etc. 
I want help to decide which one is better and more reliable. 

<ul>
<li> Entity Framework</li>
<li> nHiberante /Fluent nHibernate</li>
<li> LLBL</li>
<li> nHydrate</li>
</ul>

Thanks
",4
2761854,05/03/2010 23:19:00,24954,10/03/2008 19:06:44,596,28,NHibernate - get List<long> representing primary keys?,"I have a situation where I definitely don't want to get the whole domain object.  Basically, the entity has a primary key of long (.NET)/bigint(sql server 2005). I simply need to pass the primary key to an external system which will access the database directly - and since the list of ids could be large, I don't want to rehydrate the entire domain object just to get the Id.

In linq2sql, I could accomplish this with a projection, but I am restricted to NHibernate 1.2.1.4000, which doesn't support Linq.

Is there a way to accomplish this using NHibernate 1.2.1.4000?

(I am open to using a named-query if that will work)",nhibernate,orm,,,,,open,0,108,7,"NHibernate - get List<long> representing primary keys? I have a situation where I definitely don't want to get the whole domain object.  Basically, the entity has a primary key of long (.NET)/bigint(sql server 2005). I simply need to pass the primary key to an external system which will access the database directly - and since the list of ids could be large, I don't want to rehydrate the entire domain object just to get the Id.

In linq2sql, I could accomplish this with a projection, but I am restricted to NHibernate 1.2.1.4000, which doesn't support Linq.

Is there a way to accomplish this using NHibernate 1.2.1.4000?

(I am open to using a named-query if that will work)",2
7910649,10/27/2011 01:00:35,447341,09/14/2010 12:25:11,3141,177,Storing additional data in Entities,"Let's say I have the following Entities: `Location` & `Product`

`Locations` have dimensions (length, width, height) and so do `Products`.  `Locations` contain one or more `Products`.  Basically I need to get a bunch of `Locations` and calculate based on their dimensions and `Products` at the `Location` the remaining room left at a particular location.  I need to basically store this value (the amount of room left) and sort the `Locations` based on this value.

**Where should I store this value?**  

**Should I store it in the `Location` entity itself as just a property that is not mapped to anything in the database?**  This seems like it is bad practice but easy to do.

**Should I create a DTO for this that contains this additional property and the rest of the location data (this kind of seems like a lot of extra work for this scenario)**?  

  **Should I maybe create a wrapper basically that has this one additional property and the actual `Location` entity inside it?**",nhibernate,entity,dto,,,,open,0,170,5,"Storing additional data in Entities Let's say I have the following Entities: `Location` & `Product`

`Locations` have dimensions (length, width, height) and so do `Products`.  `Locations` contain one or more `Products`.  Basically I need to get a bunch of `Locations` and calculate based on their dimensions and `Products` at the `Location` the remaining room left at a particular location.  I need to basically store this value (the amount of room left) and sort the `Locations` based on this value.

**Where should I store this value?**  

**Should I store it in the `Location` entity itself as just a property that is not mapped to anything in the database?**  This seems like it is bad practice but easy to do.

**Should I create a DTO for this that contains this additional property and the rest of the location data (this kind of seems like a lot of extra work for this scenario)**?  

  **Should I maybe create a wrapper basically that has this one additional property and the actual `Location` entity inside it?**",3
10477890,05/07/2012 06:52:24,21966,09/25/2008 01:55:29,5962,172,What's the deal with PrimitiveType in NHibernate?,"[I just noticed][1] someone using the PrimitiveType class. It seems like an alternative to IUserType, but I can't find any documentation for it.
Should I be using it?


  [1]: http://lostechies.com/jimmybogard/2012/05/01/persisting-enumeration-classes-with-nhibernate/",nhibernate,,,,,,open,0,30,7,"What's the deal with PrimitiveType in NHibernate? [I just noticed][1] someone using the PrimitiveType class. It seems like an alternative to IUserType, but I can't find any documentation for it.
Should I be using it?


  [1]: http://lostechies.com/jimmybogard/2012/05/01/persisting-enumeration-classes-with-nhibernate/",1
10484780,05/07/2012 15:29:43,627969,02/22/2011 08:41:26,27,1,Filter the results using n-hibernate via matching with another Db table,"I have already written Hbn & code to fetch the users from db.

with following info

userid, name,email,phone

now we have new requirement in which new table has been created with following fields


Table 1

 - userid -- foreign key to above user table
 - workinglocation
 - WorkingStatusId

table 2

 - WorkingStatusId 
 - workingstatus



 

filter criteria is workinglocation and workingstatus 

i can not change my existing code.

either i have to write new hbn file and write the code

or should i fetch the data using earlier created hbn and filter it

Please suggest me with the code using linq etc (if possible)
",nhibernate,linq-to-nhibernate,nhibernate-criteria,,,,open,0,96,11,"Filter the results using n-hibernate via matching with another Db table I have already written Hbn & code to fetch the users from db.

with following info

userid, name,email,phone

now we have new requirement in which new table has been created with following fields


Table 1

 - userid -- foreign key to above user table
 - workinglocation
 - WorkingStatusId

table 2

 - WorkingStatusId 
 - workingstatus



 

filter criteria is workinglocation and workingstatus 

i can not change my existing code.

either i have to write new hbn file and write the code

or should i fetch the data using earlier created hbn and filter it

Please suggest me with the code using linq etc (if possible)
",3
2318475,02/23/2010 13:36:33,258,08/04/2008 07:59:04,353,21,Why can't I reference child entities with part of the parent entities composite key,"I am trying to reference some child entities with part of the parents composite key not all of it, why cant I? This happens when I use the following mapping instead of that which is commented. 

I get the following error

> Foreign key in table
> VolatileEventContent must have same
> number of columns as referenced
> primary key in table
> LocationSearchView

    <?xml version=""1.0"" encoding=""utf-8"" ?>
    <hibernate-mapping xmlns=""urn:nhibernate-mapping-2.2"" namespace=""JeanieMaster.Domain.Entities"" assembly=""JeanieMaster.Domain"">
      <class name=""LocationSearchView"" table=""LocationSearchView"">
    
        <composite-id>
          <key-property name=""LocationId"" type=""Int32""></key-property>
          <key-property name=""ContentProviderId"" type=""Int32""></key-property>
          <key-property name=""CategoryId"" type=""Int32""></key-property>
        </composite-id>
    
        <property name=""CompanyName"" type=""String"" not-null=""true"" update=""false"" insert=""false""/>
        <property name=""Description"" type=""String"" not-null=""true"" update=""false"" insert=""false""/>
        <property name=""CategoryId"" type=""Int32"" not-null=""true"" update=""false"" insert=""false""/>
        <property name=""ContentProviderId"" type=""Int32"" not-null=""true"" update=""false"" insert=""false""/>
        <property name=""LocationId"" type=""Int32"" not-null=""true"" update=""false"" insert=""false""/>
        <property name=""Latitude"" type=""Double""  update=""false"" insert=""false"" />
        <property name=""Longitude"" type=""Double""  update=""false"" insert=""false"" />

        <bag name=""Events"" table=""VolatileEventContent"" where=""DeactivatedOn IS NULL"" order-by=""StartDate DESC"" lazy=""false"" cascade=""none"">
          <key column=""LocationId"">
            <!--<column name=""LocationId""></column>
            <column name=""ContentProviderId""></column>
            <column name=""CategoryId""></column>-->
          </key>
          <many-to-many class=""Event"" column=""VolatileEventContentId""></many-to-many>
        </bag>
        
      </class>
    </hibernate-mapping>

",nhibernate,hibernate,c#,,,,open,0,349,14,"Why can't I reference child entities with part of the parent entities composite key I am trying to reference some child entities with part of the parents composite key not all of it, why cant I? This happens when I use the following mapping instead of that which is commented. 

I get the following error

> Foreign key in table
> VolatileEventContent must have same
> number of columns as referenced
> primary key in table
> LocationSearchView

    <?xml version=""1.0"" encoding=""utf-8"" ?>
    <hibernate-mapping xmlns=""urn:nhibernate-mapping-2.2"" namespace=""JeanieMaster.Domain.Entities"" assembly=""JeanieMaster.Domain"">
      <class name=""LocationSearchView"" table=""LocationSearchView"">
    
        <composite-id>
          <key-property name=""LocationId"" type=""Int32""></key-property>
          <key-property name=""ContentProviderId"" type=""Int32""></key-property>
          <key-property name=""CategoryId"" type=""Int32""></key-property>
        </composite-id>
    
        <property name=""CompanyName"" type=""String"" not-null=""true"" update=""false"" insert=""false""/>
        <property name=""Description"" type=""String"" not-null=""true"" update=""false"" insert=""false""/>
        <property name=""CategoryId"" type=""Int32"" not-null=""true"" update=""false"" insert=""false""/>
        <property name=""ContentProviderId"" type=""Int32"" not-null=""true"" update=""false"" insert=""false""/>
        <property name=""LocationId"" type=""Int32"" not-null=""true"" update=""false"" insert=""false""/>
        <property name=""Latitude"" type=""Double""  update=""false"" insert=""false"" />
        <property name=""Longitude"" type=""Double""  update=""false"" insert=""false"" />

        <bag name=""Events"" table=""VolatileEventContent"" where=""DeactivatedOn IS NULL"" order-by=""StartDate DESC"" lazy=""false"" cascade=""none"">
          <key column=""LocationId"">
            <!--<column name=""LocationId""></column>
            <column name=""ContentProviderId""></column>
            <column name=""CategoryId""></column>-->
          </key>
          <many-to-many class=""Event"" column=""VolatileEventContentId""></many-to-many>
        </bag>
        
      </class>
    </hibernate-mapping>

",3
8997777,01/25/2012 04:22:40,1155613,01/18/2012 07:05:02,12,0,Which is better Icriteria or queryover,"will anyone tell me which is best Icriteria or queryover.Please tell me which is good?

Can also anyone what is the difference between Restriction and Expression .What is good to be used





",nhibernate,,,,,01/25/2012 13:36:46,not constructive,1,31,6,"Which is better Icriteria or queryover will anyone tell me which is best Icriteria or queryover.Please tell me which is good?

Can also anyone what is the difference between Restriction and Expression .What is good to be used





",1
1702068,11/09/2009 16:19:22,112440,05/26/2009 08:27:16,39,10,NHibernate - access the ID of an associated object without lazy loading the whole object,"I have two associated business objects - A and B.
the association is (A->B)many-to-one, with B.Id a foreign key in A (so A has A.B_id in the DB).

I'm using lazy=true and solved most of my problems,
however in A's ToString I want to print also A.B.Id, which I should have without further trips to the DB. but accessing A.B activates the proxy, and since this isn't in the context of an open session, throws an exception.

one easy but ugly solution would be to have A.B_id property. but that's part of the stuff we were trying to avoid in the first place.
any ""organic"" way to do this? :)
thanks!",nhibernate,lazy-loading,associations,,,,open,0,105,15,"NHibernate - access the ID of an associated object without lazy loading the whole object I have two associated business objects - A and B.
the association is (A->B)many-to-one, with B.Id a foreign key in A (so A has A.B_id in the DB).

I'm using lazy=true and solved most of my problems,
however in A's ToString I want to print also A.B.Id, which I should have without further trips to the DB. but accessing A.B activates the proxy, and since this isn't in the context of an open session, throws an exception.

one easy but ugly solution would be to have A.B_id property. but that's part of the stuff we were trying to avoid in the first place.
any ""organic"" way to do this? :)
thanks!",3
4453630,12/15/2010 18:44:58,142637,07/22/2009 08:32:45,1453,47,Can I control the insert/update-command of (fluent) nhibernate to call a webservice instead of writing into the DB?,"I want to use fluent-nhibernate to query my data, but when a entity gets saved, it should not be written into the database via insert/update. Instead, I want to (better: have to) serialize that object and send it to a webservice (which will map that object to a 3rd-party class that will trigger some important business-logic). 

Is such behaviour possible to implement with nhibernate (call a custom method instead of update on saving)?",nhibernate,fluent-nhibernate,,,,,open,0,73,18,"Can I control the insert/update-command of (fluent) nhibernate to call a webservice instead of writing into the DB? I want to use fluent-nhibernate to query my data, but when a entity gets saved, it should not be written into the database via insert/update. Instead, I want to (better: have to) serialize that object and send it to a webservice (which will map that object to a 3rd-party class that will trigger some important business-logic). 

Is such behaviour possible to implement with nhibernate (call a custom method instead of update on saving)?",2
5868234,05/03/2011 10:38:08,694103,04/06/2011 03:48:11,1,0,In MS SQL SERVER 2008 I am able to pass Table value parameter to my stored Procedure from NHibernate.How to achieve the same in Oracle,"I have created a table as a type in MS SQL SERVER2008.    
As SQL Server 2008 supports passing table value parameter as IN parameter to stored Procedure.It is working fine.

Now I have to perform the same approach in Oracle.
I did it through **PLSQLAssociativeArray** but the limitaion of Associative array is they are homogeneous (every element must be of the same type). 

Where as in case of Table value parameter of MS SQL Server 2008,it is possible.

**How to achieve the same in Oracle.?**

Following are  my type  and stored procedure in **MS SQL SERVER 2008**


**CREATE TYPE [dbo].[EmployeeType] AS TABLE(  
	[EmployeeID] [int] NULL,  
	[EmployeeName] [nvarchar](50) NULL  
)  
GO**


**CREATE PROCEDURE [dbo].[TestCustom] @location EmployeeType READONLY  
AS  
insert into Employee (EMP_ID,EMP_NAME)   
SELECT EmployeeID,EmployeeName  
FROM @location;**   

GO",nhibernate,sql-server-2008,stored-procedures,oracle11g,,,open,0,136,25,"In MS SQL SERVER 2008 I am able to pass Table value parameter to my stored Procedure from NHibernate.How to achieve the same in Oracle I have created a table as a type in MS SQL SERVER2008.    
As SQL Server 2008 supports passing table value parameter as IN parameter to stored Procedure.It is working fine.

Now I have to perform the same approach in Oracle.
I did it through **PLSQLAssociativeArray** but the limitaion of Associative array is they are homogeneous (every element must be of the same type). 

Where as in case of Table value parameter of MS SQL Server 2008,it is possible.

**How to achieve the same in Oracle.?**

Following are  my type  and stored procedure in **MS SQL SERVER 2008**


**CREATE TYPE [dbo].[EmployeeType] AS TABLE(  
	[EmployeeID] [int] NULL,  
	[EmployeeName] [nvarchar](50) NULL  
)  
GO**


**CREATE PROCEDURE [dbo].[TestCustom] @location EmployeeType READONLY  
AS  
insert into Employee (EMP_ID,EMP_NAME)   
SELECT EmployeeID,EmployeeName  
FROM @location;**   

GO",4
6460736,06/23/2011 21:19:12,808651,06/21/2011 14:41:14,1,0,Which one is more efficient NHibernate or Entity framework?????,Can any one tell me that which one is more efficient NHibernate or Entity framework?????,nhibernate,entity-framework,entity,,,06/23/2011 22:42:03,not constructive,1,15,9,Which one is more efficient NHibernate or Entity framework????? Can any one tell me that which one is more efficient NHibernate or Entity framework?????,3
3196892,07/07/2010 16:35:24,342610,05/16/2010 22:11:44,16,1,Get property value of any entity in NHibernate in a generic way,"I need to create a method like this:

    object GetPropertyValue(object entity, string databaseColumnName, int index);

that will take any entity, a column name which is represented as a property in entity class and an optional index that is used if DB column is located inside collection property by some index.

For example: 

Field entity has a property - Wells, that is a set of Well entities.
and I need to get a Well Name of the second well from Wells collection.
The point is that I don't know anything about Field entity, I only have an interface - IEntity and I know that it is a field object (not a Field instance, but a business object Field recognised by an end user).
So I call GetPropertyValue(IEntity, ""WELL_NAME"", 1) to get needed value.
----------

With reflection I'm able to get a Field instance, go through all its properties, relationships properties and find my WellName property, after which I could get a Wells property and call Field.Wells[1].WellName - all via reflection....
The approach sucks :( 

Please help me writing down this method better that won't affect performance.

PS: I need use this method, because we have to deal with very old legacy domain model across same legacy UI :(

Thanks, Alex ",nhibernate,properties,generics,,,,open,0,203,12,"Get property value of any entity in NHibernate in a generic way I need to create a method like this:

    object GetPropertyValue(object entity, string databaseColumnName, int index);

that will take any entity, a column name which is represented as a property in entity class and an optional index that is used if DB column is located inside collection property by some index.

For example: 

Field entity has a property - Wells, that is a set of Well entities.
and I need to get a Well Name of the second well from Wells collection.
The point is that I don't know anything about Field entity, I only have an interface - IEntity and I know that it is a field object (not a Field instance, but a business object Field recognised by an end user).
So I call GetPropertyValue(IEntity, ""WELL_NAME"", 1) to get needed value.
----------

With reflection I'm able to get a Field instance, go through all its properties, relationships properties and find my WellName property, after which I could get a Wells property and call Field.Wells[1].WellName - all via reflection....
The approach sucks :( 

Please help me writing down this method better that won't affect performance.

PS: I need use this method, because we have to deal with very old legacy domain model across same legacy UI :(

Thanks, Alex ",3
6219175,06/02/2011 19:08:42,511041,11/17/2010 16:44:22,93,1,NHibernate and loading,Can I use NHibernate for web applications with 100-300 or 300-1000 (may be in future) users online? How can I know whether NHibernate suitable for my application or not?,nhibernate,,,,,06/05/2011 01:42:11,not a real question,1,29,3,NHibernate and loading Can I use NHibernate for web applications with 100-300 or 300-1000 (may be in future) users online? How can I know whether NHibernate suitable for my application or not?,1
3100757,06/23/2010 10:20:58,226285,12/07/2009 11:16:24,1,1,nhibernate generate left outer join on many-to-one entity,"i'm using nHibernate 2.1.2 and relized that nhibernate will generate left outer join on nested many-to-one entities. it seems start generate left-outer-join on 3rd nested note onwards which start from entity Organization. i have set following in the mapping file to force use inner-join, has anything i missed out in the mapping file? really hope somebody could give me a hint on this. appreciate any helps!

    lazy=""false"" fetch=""join""

**Example Entites and Relationships:**
Sales Record - Employee - Organization

nhibernate generate:

    select...
    from sales 
    inner join employee
    left outer join organization

**Sales.hbm.xml**

    <many-to-one name=""Employee"" insert=""true"" update=""true"" access=""field.pascalcase-underscore"" not-null=""true"" lazy=""false"" fetch=""join""/>
    <column name=""EmployeeId"" not-null=""true""/>
    </many-to-one>

**Employee.hbm.xml**

    <many-to-one name=""Organization"" insert=""true"" update=""true"" access=""field.pascalcase-underscore"" not-null=""true"" lazy=""false"" fetch=""join""/>
    <column name=""OrgId"" not-null=""true""/>
    </many-to-one>




",nhibernate,outer-join,,,,,open,0,145,8,"nhibernate generate left outer join on many-to-one entity i'm using nHibernate 2.1.2 and relized that nhibernate will generate left outer join on nested many-to-one entities. it seems start generate left-outer-join on 3rd nested note onwards which start from entity Organization. i have set following in the mapping file to force use inner-join, has anything i missed out in the mapping file? really hope somebody could give me a hint on this. appreciate any helps!

    lazy=""false"" fetch=""join""

**Example Entites and Relationships:**
Sales Record - Employee - Organization

nhibernate generate:

    select...
    from sales 
    inner join employee
    left outer join organization

**Sales.hbm.xml**

    <many-to-one name=""Employee"" insert=""true"" update=""true"" access=""field.pascalcase-underscore"" not-null=""true"" lazy=""false"" fetch=""join""/>
    <column name=""EmployeeId"" not-null=""true""/>
    </many-to-one>

**Employee.hbm.xml**

    <many-to-one name=""Organization"" insert=""true"" update=""true"" access=""field.pascalcase-underscore"" not-null=""true"" lazy=""false"" fetch=""join""/>
    <column name=""OrgId"" not-null=""true""/>
    </many-to-one>




",2
5557915,04/05/2011 20:14:59,9604,09/15/2008 19:19:07,2383,124,Nhibernate QueryOver Enum Flags,"Trying to use QueryOver and a flagged enum query. This works in Nhibernate.Linq:

    var results = repo.Query()
      .Where(x => (x.Classification & LineItemClassification.Shipping) == LineItemClassification.Shipping);

This throws `Could not determine member from (Convert(x.Classification) & 2)` using QueryOver:

     var results = repo.QueryOver()
       .Where(x => (x.Classification & LineItemClassification.Shipping) == LineItemClassification.Shipping);

Any ideas? Suggestions?

Enum:

    [Flags]
    public enum LineItemClassification
    {
            Foo,
            Widget,
            Shipping
    }

Mapping: 

    Map(x => x.Classification)
      .CustomType<LineItemClassification>();

",nhibernate,queryover,nhibernate-queryover,,,,open,0,133,4,"Nhibernate QueryOver Enum Flags Trying to use QueryOver and a flagged enum query. This works in Nhibernate.Linq:

    var results = repo.Query()
      .Where(x => (x.Classification & LineItemClassification.Shipping) == LineItemClassification.Shipping);

This throws `Could not determine member from (Convert(x.Classification) & 2)` using QueryOver:

     var results = repo.QueryOver()
       .Where(x => (x.Classification & LineItemClassification.Shipping) == LineItemClassification.Shipping);

Any ideas? Suggestions?

Enum:

    [Flags]
    public enum LineItemClassification
    {
            Foo,
            Widget,
            Shipping
    }

Mapping: 

    Map(x => x.Classification)
      .CustomType<LineItemClassification>();

",3
7566009,09/27/2011 08:11:52,531984,12/06/2010 08:29:33,307,8,Fluent nHibernate required files and linux,"I've downloaded the fluent hibernate 1.2 zip file from the website.
It contains various files, amongst them

NHibernate.dll  
FluentNHibernate.dll  
Castle.Core.dll  
Remotion.Data.Linq.dll  
Antlr3.Runtime.dll  
Iesi.Collections.dll  
NHibernate.ByteCode.Castle.dll  

Q1) Are all these files required for doing a simple application?. By simple I mean that the db contains a few tables that doesn't need complicated queries and has limited levels/amounts of reference keys and joins.

Q2) Does fluent nHibernate run on mono on linux?",nhibernate,fluent,,,,,open,0,73,6,"Fluent nHibernate required files and linux I've downloaded the fluent hibernate 1.2 zip file from the website.
It contains various files, amongst them

NHibernate.dll  
FluentNHibernate.dll  
Castle.Core.dll  
Remotion.Data.Linq.dll  
Antlr3.Runtime.dll  
Iesi.Collections.dll  
NHibernate.ByteCode.Castle.dll  

Q1) Are all these files required for doing a simple application?. By simple I mean that the db contains a few tables that doesn't need complicated queries and has limited levels/amounts of reference keys and joins.

Q2) Does fluent nHibernate run on mono on linux?",2
53417,09/10/2008 04:38:19,2847,08/25/2008 14:12:52,595,45,NHibernate or LINQ to SQL,"If starting a new project what would you use for your ORM NHibernate or LINQ and why.  What are the pros and cons of each.

edit: LINQ to SQL not just LINQ (thanks @Jon Limjap)",nhibernate,linq,c#,.net,,07/22/2012 02:42:19,not constructive,1,35,5,"NHibernate or LINQ to SQL If starting a new project what would you use for your ORM NHibernate or LINQ and why.  What are the pros and cons of each.

edit: LINQ to SQL not just LINQ (thanks @Jon Limjap)",4
2714947,04/26/2010 16:06:55,113247,05/27/2009 15:31:29,850,8,Nhibernate: building a List<string> through <component>,"If I have a field in the db which stores a set of comma separated strings (says tags), how can I instruct fluent Nhibernate to pick it up at `List<string>()`  
e.g.   

    Public IList<string> Tags {get; set;}

Db field values:  

    Mvc, .net, FNH 

",nhibernate,fluent-nhibernate,.net,c#,nhibernate-mapping,,open,0,54,6,"Nhibernate: building a List<string> through <component> If I have a field in the db which stores a set of comma separated strings (says tags), how can I instruct fluent Nhibernate to pick it up at `List<string>()`  
e.g.   

    Public IList<string> Tags {get; set;}

Db field values:  

    Mvc, .net, FNH 

",5
2851924,05/17/2010 19:01:40,548862,02/18/2010 19:31:02,13,1,How do I phrase this query in NHibernate with Lambda Extensions?,"I'm using NHibernate with Lambda Extensions and I can't figure out how to phrase a specific kind of query.

My application lets users tag other users in pictures. So there are Picture objects, and each Picture has one or more Tag objects, and each Tag object has one User object.

I'm implementing a search feature. Given a search string, I want to return all Pictures whose Name contains the string *or* which have any Tags with a User whose Name contains the string.

I don't know how to assemble this query, or whether I need to do it with subqueries or aliases. What would be the proper way to do this?

",nhibernate,criteria,alias,subquery,,,open,0,108,11,"How do I phrase this query in NHibernate with Lambda Extensions? I'm using NHibernate with Lambda Extensions and I can't figure out how to phrase a specific kind of query.

My application lets users tag other users in pictures. So there are Picture objects, and each Picture has one or more Tag objects, and each Tag object has one User object.

I'm implementing a search feature. Given a search string, I want to return all Pictures whose Name contains the string *or* which have any Tags with a User whose Name contains the string.

I don't know how to assemble this query, or whether I need to do it with subqueries or aliases. What would be the proper way to do this?

",4
6066957,05/20/2011 02:43:50,762057,05/20/2011 02:43:50,1,0,Fluent NHibnerate mapping question (one to one or none),"I am confused with how to do the following. I have 

    Table A
    datetime AsOfDate PK
    varchar Id PK
    other irrelevant fields

    Table B
    datetime AsOfDate PK
    varchar Id PK
    other irrelevant fields

The relationship from A to B is (AsOfDate, Id) -> (AsOfDate, Id)

Every A has one or none B. Every B has one A.

In the mapping for A -> B is this HasMany, HasOne, References?
In the mapping for B -> A is this HasOne?

    ",nhibernate,fluent-nhibernate,,,,,open,0,104,9,"Fluent NHibnerate mapping question (one to one or none) I am confused with how to do the following. I have 

    Table A
    datetime AsOfDate PK
    varchar Id PK
    other irrelevant fields

    Table B
    datetime AsOfDate PK
    varchar Id PK
    other irrelevant fields

The relationship from A to B is (AsOfDate, Id) -> (AsOfDate, Id)

Every A has one or none B. Every B has one A.

In the mapping for A -> B is this HasMany, HasOne, References?
In the mapping for B -> A is this HasOne?

    ",2
9992478,04/03/2012 11:39:35,1222911,02/21/2012 08:47:48,1,0,What actually use of ISession in nhibernate,I am new  to nhibernate and want to know about the work of Isession. Please clear my basics.,nhibernate,,,,,,open,0,19,7,What actually use of ISession in nhibernate I am new  to nhibernate and want to know about the work of Isession. Please clear my basics.,1
9020586,01/26/2012 15:34:12,217603,11/24/2009 07:13:49,704,28,can i do lazy loading in Nhibernate at runtime using c#,"I am new in implement Nhibernete.
 
If i use XML documents (.hbm.xml files) in Nhibernete, i enable/disable lazy loading in that xml.

Is there any way in Nhibernete where i can set lazy loading at run time? ",nhibernate,,,,,,open,0,37,11,"can i do lazy loading in Nhibernate at runtime using c# I am new in implement Nhibernete.
 
If i use XML documents (.hbm.xml files) in Nhibernete, i enable/disable lazy loading in that xml.

Is there any way in Nhibernete where i can set lazy loading at run time? ",1
3500948,08/17/2010 09:13:42,411571,08/05/2010 05:42:19,3,0,please suggest for a beginner in hibernate,"which is the best ebook for a beginner in Hibernate.

please suggest.",nhibernate,hibernate,fluent-nhibernate,,,06/09/2012 15:31:46,not constructive,1,11,7,"please suggest for a beginner in hibernate which is the best ebook for a beginner in Hibernate.

please suggest.",3
6190242,05/31/2011 15:53:55,584448,01/21/2011 12:45:53,68,3,Nhibernate 3 : Retrieve a list in a n-n relation,"I have three table : Tool, Color and ColorTool.
ColorTool has 3 columns : the id (auto increment) and IdTool + IdColor.

I have a List < Tool > and my goal is to retrieve a List < Color > or a List < int > (just the IdColor).

My last try :

    var colorList = (from res in toolList select res.ToolColor.ToList()).ToList();

In this case colorList is a List of List of ToolColor.

I don't know how retrieve that data. Can someone help me ? I use nhibernate 3.1 ?

Regards",nhibernate,linq-to-nhibernate,,,,,open,0,88,10,"Nhibernate 3 : Retrieve a list in a n-n relation I have three table : Tool, Color and ColorTool.
ColorTool has 3 columns : the id (auto increment) and IdTool + IdColor.

I have a List < Tool > and my goal is to retrieve a List < Color > or a List < int > (just the IdColor).

My last try :

    var colorList = (from res in toolList select res.ToolColor.ToList()).ToList();

In this case colorList is a List of List of ToolColor.

I don't know how retrieve that data. Can someone help me ? I use nhibernate 3.1 ?

Regards",2
11694480,07/27/2012 19:29:48,369350,06/17/2010 13:28:56,890,28,NHibernate Fetch Returning Wrong Row Count,"I have an API set up in my project for a grid to call to get audit records to display to an admin. The grid has infinite scrolling set up and uses oData built into mvc4. So, it will make a call to the api with $top equal to the number of rows it is supposed to get and $skip set to get to the proper page.

Inside the API, I make this call to nhibernate to get an IQueryable to return for MVC4 to do it's dark oData magic:

`m_session.Query<AuditInfo>().FetchMany(x => x.Parameters).Fetch(x => x.AuditType).Fetch(x => x.Status)`

In this, AuditInfo has a collection of parameters hanging off it, as well as lookup tables for the type and status.

My issue is that if I ask for 30 rows, it will return some number <= 30. I've been able to trace this a little bit, and the problem seems to be that nhibernate has the `TOP` and `JOIN` statements in the same query, so when an audit has more than one parameter on it, it creates a copy of the audit to hold the second parameter for returning it. Doing this takes up a space in the TOP(30) that the query allows for. Then, when it gets back to nhibernate, it appears that it merges these rows, leaving me with a collection that has less records than I wanted.

My question here is: **How can I set this call up so I can get an accurate number of records without resorting to fetching the parameters separately and having n+1 queries?**",nhibernate,,,,,,open,0,254,6,"NHibernate Fetch Returning Wrong Row Count I have an API set up in my project for a grid to call to get audit records to display to an admin. The grid has infinite scrolling set up and uses oData built into mvc4. So, it will make a call to the api with $top equal to the number of rows it is supposed to get and $skip set to get to the proper page.

Inside the API, I make this call to nhibernate to get an IQueryable to return for MVC4 to do it's dark oData magic:

`m_session.Query<AuditInfo>().FetchMany(x => x.Parameters).Fetch(x => x.AuditType).Fetch(x => x.Status)`

In this, AuditInfo has a collection of parameters hanging off it, as well as lookup tables for the type and status.

My issue is that if I ask for 30 rows, it will return some number <= 30. I've been able to trace this a little bit, and the problem seems to be that nhibernate has the `TOP` and `JOIN` statements in the same query, so when an audit has more than one parameter on it, it creates a copy of the audit to hold the second parameter for returning it. Doing this takes up a space in the TOP(30) that the query allows for. Then, when it gets back to nhibernate, it appears that it merges these rows, leaving me with a collection that has less records than I wanted.

My question here is: **How can I set this call up so I can get an accurate number of records without resorting to fetching the parameters separately and having n+1 queries?**",1
6552219,07/01/2011 19:04:26,384853,09/18/2008 23:20:12,65,5,"Using NHibernate session load method, is there a way to access an entity's id without initializing the proxy?","According to the docs, session.Load(id) 

> returns an object that is an uninitialized proxy and does not actually hit the database ...

This is great as I have a scenario where I want to load an object (that I know exists in the db) and later (within the same session) access the entity's id and usually only the id AND not have the proxy initialized.  It seems to me that if I only access the id of the proxy, it shouldn't have to be initialized.  At least that is what I was hoping but I can't seem to get it to work that way.

Essentially I'm trying to get the following test to pass:

    [Test]
    public void Accessing_loaded_entity_id_should_not_initialize_the_proxy()
    {
        // Arrange
        var repo = new NHRepository<Order>();
        var order = new OrderBuilder().Build();

        repo.Save(order);
        repo.Flush();
        repo.Clear();

        // Act
        var fromDb = repo.Load(order.ID);

        // Assert
        Assert.AreEqual(order.ID, fromDb.ID);
        Assert.IsFalse(NHibernateUtil.IsInitialized(fromDb));
    } 

This test fails here:

> Assert.IsFalse(NHibernateUtil.IsInitialized(fromDb));",nhibernate,,,,,,open,0,240,18,"Using NHibernate session load method, is there a way to access an entity's id without initializing the proxy? According to the docs, session.Load(id) 

> returns an object that is an uninitialized proxy and does not actually hit the database ...

This is great as I have a scenario where I want to load an object (that I know exists in the db) and later (within the same session) access the entity's id and usually only the id AND not have the proxy initialized.  It seems to me that if I only access the id of the proxy, it shouldn't have to be initialized.  At least that is what I was hoping but I can't seem to get it to work that way.

Essentially I'm trying to get the following test to pass:

    [Test]
    public void Accessing_loaded_entity_id_should_not_initialize_the_proxy()
    {
        // Arrange
        var repo = new NHRepository<Order>();
        var order = new OrderBuilder().Build();

        repo.Save(order);
        repo.Flush();
        repo.Clear();

        // Act
        var fromDb = repo.Load(order.ID);

        // Assert
        Assert.AreEqual(order.ID, fromDb.ID);
        Assert.IsFalse(NHibernateUtil.IsInitialized(fromDb));
    } 

This test fails here:

> Assert.IsFalse(NHibernateUtil.IsInitialized(fromDb));",1
5686674,04/16/2011 13:00:51,307046,04/01/2010 15:45:10,25,2,One-to-many / many-to-one NHibernate mappings,"I have an application with a handful of entities and a variety of relationships between them. However, something is wrong with my one-to-many relationships and I can't figure out what. When I try to navigate from the 'one' side of the relationship to the 'many' side I get 'illegal access to loading collection'. This happens for all the one-to-many relationships in my application. 

For example, a Customer has many Accounts

From Customer.hbm.xml:

    <bag name=""Accounts"" mutable=""true"" inverse=""true"" cascade=""save-update"">
      <key>
        <column name=""Customer_Id"" />
      </key>
      <one-to-many class=""Account"" />
    </bag>

From Account.hbm.xml:

    <many-to-one class=""Customer"" name=""Customer"" not-null=""true"">
      <column name=""Customer_Id"" />
    </many-to-one>


In code, if I say:

    var accounts = customer.Accounts.AsEnumerable();0);

I get ""illegal access to loading collection"".

Likewise, an Account has many BillingDetails:

From Account.hbm.xml:

    <bag name=""BillingDetails"" mutable=""true"" inverse=""true"" cascade=""save-update"">
      <key>
        <column name=""Account_Id"" />
      </key>
      <one-to-many class=""BillingDetail"" />
    </bag>

From BillingDetails.hbm.xml:

    <many-to-one class=""Account"" name=""Account"" not-null=""true"">
      <column name=""Account_Id"" />
    </many-to-one>

I cannot understand why a customers accounts are not lazy-loaded when I try to access them. Likewise, an Accounts billing details are not loaded when I try to access them. This is supposed to be the simplest type of relationship in NHibernate and I can't get it right. I have a tonne of many-to-many relationships without seeing this problem. ",nhibernate,orm,hbm,,,,open,0,277,5,"One-to-many / many-to-one NHibernate mappings I have an application with a handful of entities and a variety of relationships between them. However, something is wrong with my one-to-many relationships and I can't figure out what. When I try to navigate from the 'one' side of the relationship to the 'many' side I get 'illegal access to loading collection'. This happens for all the one-to-many relationships in my application. 

For example, a Customer has many Accounts

From Customer.hbm.xml:

    <bag name=""Accounts"" mutable=""true"" inverse=""true"" cascade=""save-update"">
      <key>
        <column name=""Customer_Id"" />
      </key>
      <one-to-many class=""Account"" />
    </bag>

From Account.hbm.xml:

    <many-to-one class=""Customer"" name=""Customer"" not-null=""true"">
      <column name=""Customer_Id"" />
    </many-to-one>


In code, if I say:

    var accounts = customer.Accounts.AsEnumerable();0);

I get ""illegal access to loading collection"".

Likewise, an Account has many BillingDetails:

From Account.hbm.xml:

    <bag name=""BillingDetails"" mutable=""true"" inverse=""true"" cascade=""save-update"">
      <key>
        <column name=""Account_Id"" />
      </key>
      <one-to-many class=""BillingDetail"" />
    </bag>

From BillingDetails.hbm.xml:

    <many-to-one class=""Account"" name=""Account"" not-null=""true"">
      <column name=""Account_Id"" />
    </many-to-one>

I cannot understand why a customers accounts are not lazy-loaded when I try to access them. Likewise, an Accounts billing details are not loaded when I try to access them. This is supposed to be the simplest type of relationship in NHibernate and I can't get it right. I have a tonne of many-to-many relationships without seeing this problem. ",3
9551158,03/04/2012 00:23:26,1247523,03/04/2012 00:15:34,1,0,Is it possible to distribute NHibernate-by-Code-Mappings over several classes?,"Is it possible to distribute a NHibernate-by-Code-Mapping over several classes?

E.g.

    public class EntityMap1 : ClassMapping<Entity> {
      Id(x => x.Id);
      Property(x => x.PropertyOne);
    }

    public class EntityMap2 : ClassMapping<Entity> {
      Property(x => x.PropertyTwo);
    }


I tried it but the mapping of `PropertyTwo` was missing in the generated HBML. Is there some way to achieve this?",nhibernate,nhibernate-mapping,,,,,open,0,80,9,"Is it possible to distribute NHibernate-by-Code-Mappings over several classes? Is it possible to distribute a NHibernate-by-Code-Mapping over several classes?

E.g.

    public class EntityMap1 : ClassMapping<Entity> {
      Id(x => x.Id);
      Property(x => x.PropertyOne);
    }

    public class EntityMap2 : ClassMapping<Entity> {
      Property(x => x.PropertyTwo);
    }


I tried it but the mapping of `PropertyTwo` was missing in the generated HBML. Is there some way to achieve this?",2
11237869,06/28/2012 03:56:36,330093,04/30/2010 21:16:07,11,0,NHibernate Version with Sql Timestamp Update Deleted Record,"The issue is more from Concurrency perspective. We are using Fluent NHibernate with Sql Timestamp based versioning for optimistic concurrency, now here is the scenario where I expect NHibernate to throw an exception, but it actually works.

1) Record with ID 1 is listed by User1
2) Record with ID 1 is selected by User2 for edit
3) Record with ID 1 is deleted by User1
4) User2 not saves the record.
5) Record is saved successfully with new ID.

We are using the Merge method to let NHibernate figure out inserts/updates/deletes. The entity  for scenario above actually has the ID value set to the primary key of the table, NHibernate actually fires a Query to get data for that key, it dosent get any, so it decides to insert.",nhibernate,fluent-nhibernate,optimistic-concurrency,,,,open,0,125,8,"NHibernate Version with Sql Timestamp Update Deleted Record The issue is more from Concurrency perspective. We are using Fluent NHibernate with Sql Timestamp based versioning for optimistic concurrency, now here is the scenario where I expect NHibernate to throw an exception, but it actually works.

1) Record with ID 1 is listed by User1
2) Record with ID 1 is selected by User2 for edit
3) Record with ID 1 is deleted by User1
4) User2 not saves the record.
5) Record is saved successfully with new ID.

We are using the Merge method to let NHibernate figure out inserts/updates/deletes. The entity  for scenario above actually has the ID value set to the primary key of the table, NHibernate actually fires a Query to get data for that key, it dosent get any, so it decides to insert.",3
453498,01/17/2009 16:02:36,832,08/09/2008 06:51:40,6950,341,What Good Tutorials/Guides Are There For Getting Started with NHibernate?,"I have finally decided to spend some time looking at using NHibernate for helping TDD my DAL code.

I came across this excellent ""[foundations of programming][1]"" eBook from [Karl Seguin][1] and he gave some small examples on using NHibernate, and how it improves the testability of your DAL.

Can anyone here offer any good resources for a geek like me to get started with?


[1]:http://www.google.com/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fcodebetter.com%2Ffiles%2Ffolders%2Fcodebetter_downloads%2Fentry179694.aspx&ei=lABySd25GZiq-gaekbCGBw&usg=AFQjCNFbnAWlSDqf76YBI12ODD9CHQhCbQ&sig2=PDGV3TMbBAeED2E1EG3LXw",nhibernate,tutorials,guidelines,,,11/22/2011 16:34:05,not constructive,1,62,10,"What Good Tutorials/Guides Are There For Getting Started with NHibernate? I have finally decided to spend some time looking at using NHibernate for helping TDD my DAL code.

I came across this excellent ""[foundations of programming][1]"" eBook from [Karl Seguin][1] and he gave some small examples on using NHibernate, and how it improves the testability of your DAL.

Can anyone here offer any good resources for a geek like me to get started with?


[1]:http://www.google.com/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fcodebetter.com%2Ffiles%2Ffolders%2Fcodebetter_downloads%2Fentry179694.aspx&ei=lABySd25GZiq-gaekbCGBw&usg=AFQjCNFbnAWlSDqf76YBI12ODD9CHQhCbQ&sig2=PDGV3TMbBAeED2E1EG3LXw",3
3083512,06/21/2010 09:39:23,461880,10/18/2008 10:53:27,315,12,NHibernate. get singleOrDefault,"I have the following method. This returns a single unqiue order. However i just want the first result. What is the best way to achieve this. Of course i could return a List<T> and then get the first result from that. 

ie `.List<Order>().SingleOrDefault();`

Surely there is away through the criteria api to acheive this?


        Model.Order order = _session
                .CreateCriteria(typeof(Model.Order))
                .Add(Restrictions.Eq(""UserName"", user.UserName))
                .Add(Restrictions.Eq(""CompanyId"", companyId))
                .Add(Restrictions.Eq(""OrderStatus"", OrderStatusHelper.OrderOpen()))
                .AddOrder(sortOrder)
                .UniqueResult<Model.Order>(); // results not always unique

",nhibernate,,,,,,open,0,168,3,"NHibernate. get singleOrDefault I have the following method. This returns a single unqiue order. However i just want the first result. What is the best way to achieve this. Of course i could return a List<T> and then get the first result from that. 

ie `.List<Order>().SingleOrDefault();`

Surely there is away through the criteria api to acheive this?


        Model.Order order = _session
                .CreateCriteria(typeof(Model.Order))
                .Add(Restrictions.Eq(""UserName"", user.UserName))
                .Add(Restrictions.Eq(""CompanyId"", companyId))
                .Add(Restrictions.Eq(""OrderStatus"", OrderStatusHelper.OrderOpen()))
                .AddOrder(sortOrder)
                .UniqueResult<Model.Order>(); // results not always unique

",1
4184816,11/15/2010 13:28:45,183201,10/02/2009 15:47:56,28,0,NHibernate: cannot append items to map element,"I have map element in my mapping - 

    		<component name=""Resources"">
			<map name=""Inner"" table=""SomeTable"" lazy=""false"" fetch=""join"" access=""field.lowercase-underscore"">
				<key column=""Id""/>
				<index column=""IndexId"" type=""String""/>
				<composite-element class=""SomeResource"">
					<property name=""Name""/>
				</composite-element>
			</map>
    		</component>

I want to append items in the SomeTable in the following way -  

    			var ent = new Entity();
			ent.Resources.Add(""key1"", new SomeResource());

			var saved = Session.SaveOrUpdate(ent);
			Session.Session.Flush();
			Session.Session.Clear();

			var newEntity = new Entity {Id = saved.Id};
			ent.Resources.Add(""key2"", new SomeResource());

			Session.SaveOrUpdate(newEntity);  // here nHib generates DELETE FROM SomeTable WHERE Id = saved.Id
			Session.Session.Flush();
			Session.Session.Clear();

I want to have elements ""key1"" & ""key2"" in the SomeTable after the run, how can this be done?.. Currently nHib deletes all elements with the specified id from the SomeTable before second save.
",nhibernate,map,mapping,,,,open,0,109,7,"NHibernate: cannot append items to map element I have map element in my mapping - 

    		<component name=""Resources"">
			<map name=""Inner"" table=""SomeTable"" lazy=""false"" fetch=""join"" access=""field.lowercase-underscore"">
				<key column=""Id""/>
				<index column=""IndexId"" type=""String""/>
				<composite-element class=""SomeResource"">
					<property name=""Name""/>
				</composite-element>
			</map>
    		</component>

I want to append items in the SomeTable in the following way -  

    			var ent = new Entity();
			ent.Resources.Add(""key1"", new SomeResource());

			var saved = Session.SaveOrUpdate(ent);
			Session.Session.Flush();
			Session.Session.Clear();

			var newEntity = new Entity {Id = saved.Id};
			ent.Resources.Add(""key2"", new SomeResource());

			Session.SaveOrUpdate(newEntity);  // here nHib generates DELETE FROM SomeTable WHERE Id = saved.Id
			Session.Session.Flush();
			Session.Session.Clear();

I want to have elements ""key1"" & ""key2"" in the SomeTable after the run, how can this be done?.. Currently nHib deletes all elements with the specified id from the SomeTable before second save.
",3
1761584,11/19/2009 07:46:41,80002,03/19/2009 12:22:39,300,10,"How to insert a detached object, which may already exist in the database using NHibernate?","I have the following code snippet:

    using (var scope = DataAccessPortal.DataContext(DB.Main).OpenStatementScope())
    using (var transaction = scope.BeginTransaction())
    {
      // Several other database operations.
      if (scope.ExistsById(obj.GetType(), obj.Id))
      {
        scope.Update(obj);
      }
      else
      {
        scope.Insert(obj);
      }
      transaction.Commit();
    }

Where `scope` and `transaction` are thin abstract layers around NHibernate session and transaction objects respectively, `ExistsById` maps to the HQL query to check if the given ID is found in the database, `Update` and `Insert` map to the respective session operations.

The purpose of the code is to update several objects in the database and then update some object in the database, which may or may not be already found there - the update-or-insert code. 

I dislike the update-or-insert code, because it yields two round trips to the database. Is it possible to accomplish the same task with just one round trip using NHibernate?

My constraints are:

 - The database comes with no predefined stored procedures. If NHibernate allows to create one dynamically in a DB independent manner, then fine (how???), otherwise using a stored procedure is not an option.
 - Chances are that the object already exists in the database, so I could just do an Update, catch the exception if the object does not exist and then retry with Insert. However, the update-or-insert code is part of a larger transaction. So, failing it also fails the transaction, which means I will have to retry the whole transaction and not just the update-or-insert piece of code. I am not sure it is more preferable than the way it is now.

",nhibernate,.net,,,,,open,0,318,15,"How to insert a detached object, which may already exist in the database using NHibernate? I have the following code snippet:

    using (var scope = DataAccessPortal.DataContext(DB.Main).OpenStatementScope())
    using (var transaction = scope.BeginTransaction())
    {
      // Several other database operations.
      if (scope.ExistsById(obj.GetType(), obj.Id))
      {
        scope.Update(obj);
      }
      else
      {
        scope.Insert(obj);
      }
      transaction.Commit();
    }

Where `scope` and `transaction` are thin abstract layers around NHibernate session and transaction objects respectively, `ExistsById` maps to the HQL query to check if the given ID is found in the database, `Update` and `Insert` map to the respective session operations.

The purpose of the code is to update several objects in the database and then update some object in the database, which may or may not be already found there - the update-or-insert code. 

I dislike the update-or-insert code, because it yields two round trips to the database. Is it possible to accomplish the same task with just one round trip using NHibernate?

My constraints are:

 - The database comes with no predefined stored procedures. If NHibernate allows to create one dynamically in a DB independent manner, then fine (how???), otherwise using a stored procedure is not an option.
 - Chances are that the object already exists in the database, so I could just do an Update, catch the exception if the object does not exist and then retry with Insert. However, the update-or-insert code is part of a larger transaction. So, failing it also fails the transaction, which means I will have to retry the whole transaction and not just the update-or-insert piece of code. I am not sure it is more preferable than the way it is now.

",2
